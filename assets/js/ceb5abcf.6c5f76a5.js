(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{104:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return o})),a.d(t,"metadata",(function(){return p})),a.d(t,"toc",(function(){return c})),a.d(t,"default",(function(){return b}));var n=a(3),r=a(8),i=(a(0),a(112)),l=["components"],o={title:"datapackage-pipelines-py"},p={unversionedId:"other-libraries/data-package-pipelines",id:"other-libraries/data-package-pipelines",isDocsHomePage:!1,title:"datapackage-pipelines-py",description:"Travis",source:"@site/docs/other-libraries/data-package-pipelines.md",slug:"/other-libraries/data-package-pipelines",permalink:"/docs/other-libraries/data-package-pipelines",editUrl:"https://github.com/frictionlessdata/libraries/edit/master/docs/docs/other-libraries/data-package-pipelines.md",version:"current",lastUpdatedBy:"roll",lastUpdatedAt:1624378318,formattedLastUpdatedAt:"6/22/2021",sidebar:"other-libraries",previous:{title:"frictionless-ckan-mapper-py",permalink:"/docs/other-libraries/frictionless-ckan-mapper"},next:{title:"datapackage-render-js",permalink:"/docs/other-libraries/data-package-render"}},c=[{value:"The Basics",id:"the-basics",children:[{value:"What is it?",id:"what-is-it",children:[]},{value:"Pipelines",id:"pipelines",children:[]},{value:"<code>pipeline-spec.yaml</code> file",id:"pipeline-specyaml-file",children:[]},{value:"Mechanics",id:"mechanics",children:[]},{value:"Quick Start",id:"quick-start",children:[]},{value:"The Command Line Interface - <code>dpp</code>",id:"the-command-line-interface---dpp",children:[]}]},{value:"Deeper look into pipelines",id:"deeper-look-into-pipelines",children:[{value:"Processor Resolution",id:"processor-resolution",children:[]},{value:"Excluding directories form scanning for pipeline specs",id:"excluding-directories-form-scanning-for-pipeline-specs",children:[]},{value:"Caching",id:"caching",children:[]},{value:"Dirty tasks and keeping state",id:"dirty-tasks-and-keeping-state",children:[]},{value:"Pipeline Dependencies",id:"pipeline-dependencies",children:[]},{value:"Validating",id:"validating",children:[]},{value:"Dataflows integration",id:"dataflows-integration",children:[]}]},{value:"The Standard Processor Library",id:"the-standard-processor-library",children:[{value:"<strong><em><code>update_package</code></em></strong>",id:"update_package",children:[]},{value:"<strong><em><code>update_resource</code></em></strong>",id:"update_resource",children:[]},{value:"<strong><em><code>load</code></em></strong>",id:"load",children:[]},{value:"<strong><em><code>printer</code></em></strong>",id:"printer",children:[]},{value:"<strong><em><code>set_types</code></em></strong>",id:"set_types",children:[]},{value:"<strong><em><code>load_metadata</code></em></strong>",id:"load_metadata",children:[]},{value:"<strong><em><code>load_resource</code></em></strong>",id:"load_resource",children:[]},{value:"<strong><em><code>concatenate</code></em></strong>",id:"concatenate",children:[]},{value:"<strong><em><code>join</code></em></strong>",id:"join",children:[]},{value:"<strong><em><code>filter</code></em></strong>",id:"filter",children:[]},{value:"<strong><em><code>sort</code></em></strong>",id:"sort",children:[]},{value:"<strong><em><code>deduplicate</code></em></strong>",id:"deduplicate",children:[]},{value:"<strong><em><code>duplicate</code></em></strong>",id:"duplicate",children:[]},{value:"<strong><em><code>delete_fields</code></em></strong>",id:"delete_fields",children:[]},{value:"<strong><em><code>add_computed_field</code></em></strong>",id:"add_computed_field",children:[]},{value:"<strong><em><code>find_replace</code></em></strong>",id:"find_replace",children:[]},{value:"<strong><em><code>unpivot</code></em></strong>",id:"unpivot",children:[]},{value:"<strong><em><code>dump_to_sql</code></em></strong>",id:"dump_to_sql",children:[]},{value:"<strong><em><code>dump_to_path</code></em></strong>",id:"dump_to_path",children:[]},{value:"<strong><em><code>dump_to_zip</code></em></strong>",id:"dump_to_zip",children:[]}]},{value:"Deprecated Processors",id:"deprecated-processors",children:[{value:"<strong><em><code>add_metadata</code></em></strong>",id:"add_metadata",children:[]},{value:"<strong><em><code>add_resource</code></em></strong>",id:"add_resource",children:[]},{value:"<strong><em><code>stream_remote_resources</code></em></strong>",id:"stream_remote_resources",children:[]},{value:"<strong><em><code>dump.to_sql</code></em></strong>",id:"dumpto_sql",children:[]},{value:"<strong><em><code>dump.to_path</code></em></strong>",id:"dumpto_path",children:[]},{value:"<strong><em><code>dump.to_zip</code></em></strong>",id:"dumpto_zip",children:[]}]},{value:"Custom Processors",id:"custom-processors",children:[{value:"High Level Processor API",id:"high-level-processor-api",children:[]},{value:"Low Level Processor API",id:"low-level-processor-api",children:[]}]},{value:"Plugins and Source Descriptors",id:"plugins-and-source-descriptors",children:[{value:"Source Descriptors",id:"source-descriptors",children:[]}]},{value:"Running on a schedule",id:"running-on-a-schedule",children:[]},{value:"Pipeline Dashboard &amp; Status Badges",id:"pipeline-dashboard--status-badges",children:[]},{value:"Integrating with other services",id:"integrating-with-other-services",children:[]},{value:"Known Issues",id:"known-issues",children:[]}],s={toc:c};function b(e){var t=e.components,a=Object(r.a)(e,l);return Object(i.b)("wrapper",Object(n.a)({},s,a,{components:t,mdxType:"MDXLayout"}),Object(i.b)("p",null,Object(i.b)("a",{parentName:"p",href:"https://travis-ci.org/frictionlessdata/datapackage-pipelines"},Object(i.b)("img",{parentName:"a",src:"https://img.shields.io/travis/frictionlessdata/datapackage-pipelines/master.svg",alt:"Travis"})),"\n",Object(i.b)("a",{parentName:"p",href:"https://coveralls.io/r/frictionlessdata/datapackage-pipelines?branch=master"},Object(i.b)("img",{parentName:"a",src:"http://img.shields.io/coveralls/frictionlessdata/datapackage-pipelines.svg?branch=master",alt:"Coveralls"})),"\n",Object(i.b)("img",{parentName:"p",src:"https://img.shields.io/pypi/pyversions/datapackage-pipelines.svg",alt:"PyPI - Python Version"})),Object(i.b)("h2",{id:"the-basics"},"The Basics"),Object(i.b)("h3",{id:"what-is-it"},"What is it?"),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"datapackage-pipelines")," is a framework for declarative stream-processing of tabular data. It is built upon the concepts and tooling of the Frictionless Data project."),Object(i.b)("h3",{id:"pipelines"},"Pipelines"),Object(i.b)("p",null,"The basic concept in this framework is the pipeline."),Object(i.b)("p",null,"A pipeline has a list of processing steps, and it generates a single ",Object(i.b)("em",{parentName:"p"},"data package")," as its output. Each step is executed in a ",Object(i.b)("em",{parentName:"p"},"processor")," and consists of the following stages:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"Modify the data package descriptor")," - For example: add metadata, add or remove resources, change resources' data schema etc."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"Process resources")," - Each row of each resource is processed sequentially. The processor can drop rows, add new ones or modify their contents."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"Return stats")," - If necessary, the processor can report a dictionary of data which will be returned to the user when the pipeline execution terminates. This can be used, for example, for calculating quality measures for the processed data.")),Object(i.b)("p",null,"Not every processor needs to do all of these. In fact, you would often find each processing step doing only one of these."),Object(i.b)("h3",{id:"pipeline-specyaml-file"},Object(i.b)("inlineCode",{parentName:"h3"},"pipeline-spec.yaml")," file"),Object(i.b)("p",null,"Pipelines are defined in a declarative way, and not in code. One or more pipelines can be defined in a ",Object(i.b)("inlineCode",{parentName:"p"},"pipeline-spec.yaml")," file. This file specifies the list of processors (referenced by name) and the execution parameters for each of the processors."),Object(i.b)("p",null,"Here's an example of a ",Object(i.b)("inlineCode",{parentName:"p"},"pipeline-spec.yaml")," file:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-yaml"},"worldbank-co2-emissions:\n  title: CO2 emission data from the World Bank\n  description: Data per year, provided in metric tons per capita.\n  environment:\n    DEBUG: true\n  pipeline:\n    -\n      run: update_package\n      parameters:\n        name: 'co2-emissions'\n        title: 'CO2 emissions (metric tons per capita)'\n        homepage: 'http://worldbank.org/'\n    -\n      run: load\n      parameters:\n        from: \"http://api.worldbank.org/v2/en/indicator/EN.ATM.CO2E.PC?downloadformat=excel\"\n        name: 'global-data'\n        format: xls\n        headers: 4\n    -\n      run: set_types\n      parameters:\n         resources: global-data\n         types:\n           \"[12][0-9]{3}\":\n              type: number\n    -\n      run: dump_to_zip\n      parameters:\n          out-file: co2-emissions-wb.zip\n")),Object(i.b)("p",null,"In this example we see one pipeline called ",Object(i.b)("inlineCode",{parentName:"p"},"worldbank-co2-emissions"),". Its pipeline consists of 4 steps:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"update_package"),": This is a library processor  (see below), which modifies the data-package's descriptor (in our case: the initial, empty descriptor) - adding ",Object(i.b)("inlineCode",{parentName:"li"},"name"),", ",Object(i.b)("inlineCode",{parentName:"li"},"title")," and other properties to the datapackage."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"load"),": This is another library processor, which loads data into the data-package.\nThis resource has a ",Object(i.b)("inlineCode",{parentName:"li"},"name")," and a ",Object(i.b)("inlineCode",{parentName:"li"},"from")," property, pointing to the remote location of the data."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"set_types"),": This processor assigns data types to fields in the data. In this example, field headers looking like years will be assigned the ",Object(i.b)("inlineCode",{parentName:"li"},"number")," type."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"dump_to_zip"),": Create a zipped and validated datapackage with the provided file name.")),Object(i.b)("p",null,"Also, we have provided some metadata:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"title"),": Title of a pipeline"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"description"),": Description of a pipeline"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"environment"),": Dictionary of environment variables to be set for all the pipeline's steps. For examples, it can be used to change the behaviour of the underlaying ",Object(i.b)("inlineCode",{parentName:"li"},"requests")," library - ",Object(i.b)("a",{parentName:"li",href:"https://requests.readthedocs.io/en/master/user/advanced/#ssl-cert-verification"},"https://requests.readthedocs.io/en/master/user/advanced/#ssl-cert-verification"))),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},"Full JSONSchema of the ",Object(i.b)("inlineCode",{parentName:"p"},"pipeline-spec.yaml")," file can be found ",Object(i.b)("a",{parentName:"p",href:"https://github.com/frictionlessdata/datapackage-pipelines/blob/master/datapackage_pipelines/specs/schemas/pipeline-spec.schema.json"},"here"))),Object(i.b)("h3",{id:"mechanics"},"Mechanics"),Object(i.b)("p",null,'An important aspect of how the pipelines are run is the fact that data is passed in streams from one processor to another. If we get "technical" here, then each processor is run in its own dedicated process, where the datapackage is read from its ',Object(i.b)("inlineCode",{parentName:"p"},"stdin")," and output to its ",Object(i.b)("inlineCode",{parentName:"p"},"stdout"),". The important thing to note here is that no processor holds the entire data set at any point."),Object(i.b)("p",null,"This limitation is by design - to keep the memory and disk requirements of each processor limited and independent of the dataset size."),Object(i.b)("h3",{id:"quick-start"},"Quick Start"),Object(i.b)("p",null,"First off, create a ",Object(i.b)("inlineCode",{parentName:"p"},"pipeline-spec.yaml")," file in your current directory. You can take the above file if you just want to try it out."),Object(i.b)("p",null,"Then, you can either install ",Object(i.b)("inlineCode",{parentName:"p"},"datapackage-pipelines")," locally - note that ",Object(i.b)("em",{parentName:"p"},"Python 3.6")," or higher is required due to use of ",Object(i.b)("a",{parentName:"p",href:"https://www.python.org/dev/peps/pep-0484/"},"Type Hinting")," and advanced ",Object(i.b)("inlineCode",{parentName:"p"},"asyncio")," use:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell"},"$ pip install datapackage-pipelines\n")),Object(i.b)("p",null,"You should now be able to use the ",Object(i.b)("inlineCode",{parentName:"p"},"dpp")," command:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell"},"$ dpp\nAvailable Pipelines:\n- ./worldbank-co2-emissions (*)\n\n$ $ dpp run --verbose ./worldbank-co2-emissions\nRUNNING ./worldbank-co2-emissions\nCollecting dependencies\nRunning async task\nWaiting for completion\nAsync task starting\nSearching for existing caches\nBuilding process chain:\n- update_package\n- load\n- set_types\n- dump_to_zip\n- (sink)\nDONE /Users/adam/code/dhq/specstore/dpp_repo/datapackage_pipelines/specs/../lib/update_package.py\nload: DEBUG   :Starting new HTTP connection (1): api.worldbank.org:80\nload: DEBUG   :http://api.worldbank.org:80 \"GET /v2/en/indicator/EN.ATM.CO2E.PC?downloadformat=excel HTTP/1.1\" 200 308736\nload: DEBUG   :http://api.worldbank.org:80 \"GET /v2/en/indicator/EN.ATM.CO2E.PC?downloadformat=excel HTTP/1.1\" 200 308736\nload: DEBUG   :Starting new HTTP connection (1): api.worldbank.org:80\nload: DEBUG   :http://api.worldbank.org:80 \"GET /v2/en/indicator/EN.ATM.CO2E.PC?downloadformat=excel HTTP/1.1\" 200 308736\nload: DEBUG   :http://api.worldbank.org:80 \"GET /v2/en/indicator/EN.ATM.CO2E.PC?downloadformat=excel HTTP/1.1\" 200 308736\nset_types: INFO    :(<dataflows.processors.set_type.set_type object at 0x10a5c79b0>,)\nload: INFO    :Processed 264 rows\nset_types: INFO    :Processed 264 rows\nDONE /Users/adam/code/dhq/specstore/dpp_repo/datapackage_pipelines/specs/../lib/load.py\nDONE /Users/adam/code/dhq/specstore/dpp_repo/datapackage_pipelines/specs/../lib/set_types.py\ndump_to_zip: INFO    :Processed 264 rows\nDONE /Users/adam/code/dhq/specstore/dpp_repo/datapackage_pipelines/manager/../lib/internal/sink.py\nDONE /Users/adam/code/dhq/specstore/dpp_repo/datapackage_pipelines/specs/../lib/dump_to_zip.py\nDONE V ./worldbank-co2-emissions {'bytes': 692741, 'count_of_rows': 264, 'dataset_name': 'co2-emissions', 'hash': '4dd18effcdfbf5fc267221b4ffc28fa4'}\nINFO    :RESULTS:\nINFO    :SUCCESS: ./worldbank-co2-emissions {'bytes': 692741, 'count_of_rows': 264, 'dataset_name': 'co2-emissions', 'hash': '4dd18effcdfbf5fc267221b4ffc28fa4'}\n")),Object(i.b)("p",null,"Alternatively, you could use our ",Object(i.b)("a",{parentName:"p",href:"https://www.docker.com/"},"Docker")," image:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell"},"$ docker run -it -v `pwd`:/pipelines:rw \\\n        frictionlessdata/datapackage-pipelines\n<available-pipelines>\n\n$ docker run -it -v `pwd`:/pipelines:rw \\\n       frictionlessdata/datapackage-pipelines run ./worldbank-co2-emissions\n<execution-logs>\n")),Object(i.b)("h3",{id:"the-command-line-interface---dpp"},"The Command Line Interface - ",Object(i.b)("inlineCode",{parentName:"h3"},"dpp")),Object(i.b)("p",null,"Running a pipeline from the command line is done using the ",Object(i.b)("inlineCode",{parentName:"p"},"dpp")," tool."),Object(i.b)("p",null,"Running ",Object(i.b)("inlineCode",{parentName:"p"},"dpp")," without any argument, will show the list of available pipelines. This is done by scanning the current directory and its subdirectories, searching for ",Object(i.b)("inlineCode",{parentName:"p"},"pipeline-spec.yaml")," files and extracting the list of pipeline specifications described within."),Object(i.b)("p",null,"Each pipeline has an identifier, composed of the path to the ",Object(i.b)("inlineCode",{parentName:"p"},"pipeline-spec.yaml")," file and the name of the pipeline, as defined within that description file."),Object(i.b)("p",null,"In order to run a pipeline, you use ",Object(i.b)("inlineCode",{parentName:"p"},"dpp run <pipeline-id>"),"."),Object(i.b)("p",null,"You can also use ",Object(i.b)("inlineCode",{parentName:"p"},"dpp run all")," for running all pipelines and ",Object(i.b)("inlineCode",{parentName:"p"},"dpp run dirty")," to run the just the ",Object(i.b)("em",{parentName:"p"},"dirty")," pipelines (more on that later on)."),Object(i.b)("h2",{id:"deeper-look-into-pipelines"},"Deeper look into pipelines"),Object(i.b)("h3",{id:"processor-resolution"},"Processor Resolution"),Object(i.b)("p",null,"As previously seen, processors are referenced by name."),Object(i.b)("p",null,"This name is, in fact, the name of a Python script containing the processing code (minus the ",Object(i.b)("inlineCode",{parentName:"p"},".py")," extension). When trying to find where is the actual code that needs to be executed, the processor resolver will search in these predefined locations:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"First of all, it will try to find a custom processor with that name in the directory of the ",Object(i.b)("inlineCode",{parentName:"li"},"pipeline-spec.yaml")," file.\nProcessor names support the dot notation, so you could write ",Object(i.b)("inlineCode",{parentName:"li"},"mycode.custom_processor")," and it will try to find a processor named ",Object(i.b)("inlineCode",{parentName:"li"},"custom_processor.py")," in the ",Object(i.b)("inlineCode",{parentName:"li"},"mycode")," directory, in the same path as the pipeline spec file.\nFor this specific resolving phase, if you would write ",Object(i.b)("inlineCode",{parentName:"li"},"..custom_processor")," it will try to find that processor in the parent directory of the pipeline spec file.\n(read on for instructions on how to write custom processors)"),Object(i.b)("li",{parentName:"ul"},"In case the processor name looks like ",Object(i.b)("inlineCode",{parentName:"li"},"myplugin.somename"),", it will try to find a processor named ",Object(i.b)("inlineCode",{parentName:"li"},"somename")," in the ",Object(i.b)("inlineCode",{parentName:"li"},"myplugin")," plugin. That is - it will see if there's an installed plugin which is called ",Object(i.b)("inlineCode",{parentName:"li"},"myplugin"),", and if so, whether that plugin publishes a processor called ",Object(i.b)("inlineCode",{parentName:"li"},"somename")," (more on plugins below)."),Object(i.b)("li",{parentName:"ul"},"If no processor was found until this point, it will try to search for this processor in the processor search path. The processor search path is taken from the environment variable ",Object(i.b)("inlineCode",{parentName:"li"},"DPP_PROCESSOR_PATH"),". Each of the ",Object(i.b)("inlineCode",{parentName:"li"},":")," separated paths in the path is considered as a possible starting point for resolving the processor."),Object(i.b)("li",{parentName:"ul"},"Finally, it will try to find that processor in the Standard Processor Library which is bundled with this package.")),Object(i.b)("h3",{id:"excluding-directories-form-scanning-for-pipeline-specs"},"Excluding directories form scanning for pipeline specs"),Object(i.b)("p",null,"By default ",Object(i.b)("inlineCode",{parentName:"p"},".*")," directories are excluded from scanning, you can add additional directory patterns for\nexclusion by creating a ",Object(i.b)("inlineCode",{parentName:"p"},".dpp_spec_ignore")," file at the project root. This file has similar syntax\nto .gitignore and will exclude directories from scanning based on glob pattern matching."),Object(i.b)("p",null,"For example, the following file will ignore ",Object(i.b)("inlineCode",{parentName:"p"},"test*")," directories including inside subdirectories\nand ",Object(i.b)("inlineCode",{parentName:"p"},"/docs")," directory will only be ignored at the project root directory"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"test*\n/docs\n")),Object(i.b)("h3",{id:"caching"},"Caching"),Object(i.b)("p",null,"By setting the ",Object(i.b)("inlineCode",{parentName:"p"},"cached")," property on a specific pipeline step to ",Object(i.b)("inlineCode",{parentName:"p"},"True"),", this step's output will be stored on disk (in the ",Object(i.b)("inlineCode",{parentName:"p"},".cache")," directory, in the same location as the ",Object(i.b)("inlineCode",{parentName:"p"},"pipeline-spec.yaml")," file)."),Object(i.b)("p",null,"Rerunning the pipeline will make use of that cache, thus avoiding the execution of the cached step and its precursors."),Object(i.b)("p",null,"Internally, a hash is calculated for each step in the pipeline - which is based on the processor's code, it parameters and the hash of its predecessor. If a cache file exists with exactly the same hash as a specific step, then we can remove it (and its predecessors) and use that cache file as an input to the pipeline"),Object(i.b)("p",null,"This way, the cache becomes invalid in case the code or execution parameters changed (either for the cached processor or in any of the preceding processors)."),Object(i.b)("h3",{id:"dirty-tasks-and-keeping-state"},"Dirty tasks and keeping state"),Object(i.b)("p",null,'The cache hash is also used for seeing if a pipeline is "dirty". When a pipeline completes executing successfully, ',Object(i.b)("inlineCode",{parentName:"p"},"dpp")," stores the cache hash along with the pipeline id. If the stored hash is different than the currently calculated hash, it means that either the code or the execution parameters were modified, and that the pipeline needs to be re-run."),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"dpp")," works with two storage backends. For running locally, it uses a python ",Object(i.b)("em",{parentName:"p"},"sqlite DB")," to store the current state of each running task, including the last result and cache hash. The state DB file is stored in a file named ",Object(i.b)("inlineCode",{parentName:"p"},".dpp.db")," in the same directory that ",Object(i.b)("inlineCode",{parentName:"p"},"dpp")," is being run from."),Object(i.b)("p",null,"For other installations, especially ones using the task scheduler, it is recommended to work with the ",Object(i.b)("em",{parentName:"p"},"Redis")," backend. In order to enable the Redis connection, simply set the ",Object(i.b)("inlineCode",{parentName:"p"},"DPP_REDIS_HOST")," environment variable to point to a running Redis instance."),Object(i.b)("h3",{id:"pipeline-dependencies"},"Pipeline Dependencies"),Object(i.b)("p",null,'You can declare that a pipeline is dependent on another pipeline or datapackage. This dependency is considered when calculating the cache hashes of a pipeline, which in turn affect the validity of cache files and the "dirty" state:'),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"For pipeline dependencies, the hash of that pipeline is used in the calculation"),Object(i.b)("li",{parentName:"ul"},"For datapackage dependencies, the ",Object(i.b)("inlineCode",{parentName:"li"},"hash")," property in the datapackage is used in the calculation")),Object(i.b)("p",null,"If the dependency is missing, then the pipeline is marked as 'unable to be executed'."),Object(i.b)("p",null,"Declaring dependencies is done by a ",Object(i.b)("inlineCode",{parentName:"p"},"dependencies")," property to a pipeline definition in the ",Object(i.b)("inlineCode",{parentName:"p"},"pipeline-spec.yaml")," file.\nThis property should contain a list of dependencies, each one is an object with the following formats:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"A single key named ",Object(i.b)("inlineCode",{parentName:"li"},"pipeline")," whose value is the pipeline id to depend on"),Object(i.b)("li",{parentName:"ul"},"A single key named ",Object(i.b)("inlineCode",{parentName:"li"},"datapackage")," whose value is the identifier (or URL) for the datapackage to depend on")),Object(i.b)("p",null,"Example:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-yaml"},"cat-vs-dog-populations:\n  dependencies:\n    -\n      pipeline: ./geo/region-areal\n    -\n      datapackage: http://pets.net/data/dogs-per-region/datapackage.json\n    -\n      datapackage: http://pets.net/data/dogs-per-region\n  ...\n")),Object(i.b)("h3",{id:"validating"},"Validating"),Object(i.b)("p",null,"Each processor's input is automatically validated for correctness:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"The datapackage is always validated before being passed to a processor, so there's no possibility for a processor to modify a datapackage in a way that renders it invalid.")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Data is not validated against its respective JSON Table Schema, unless explicitly requested by setting the ",Object(i.b)("inlineCode",{parentName:"p"},"validate")," flag to True in the step's info.\nThis is done for two main reasons:"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Performance wise, validating the data in every step is very CPU intensive"),Object(i.b)("li",{parentName:"ul"},"In some cases you modify the schema in one step and the data in another, so you would only like to validate the data once all the changes were made")),Object(i.b)("p",{parentName:"li"},"In any case, when using the ",Object(i.b)("inlineCode",{parentName:"p"},"set_types")," standard processor, it will validate and transform the input data with the new types.."))),Object(i.b)("h3",{id:"dataflows-integration"},"Dataflows integration"),Object(i.b)("p",null,Object(i.b)("a",{parentName:"p",href:"https://github.com/datahq/dataflows"},"Dataflows")," is the successor of datapackage-pipelines and provides a more\nPythonic interface to running pipelines. You can integrate dataflows within pipeline specs using the ",Object(i.b)("inlineCode",{parentName:"p"},"flow")," attribute\ninstead of ",Object(i.b)("inlineCode",{parentName:"p"},"run"),". For example, given the following flow file, saved under ",Object(i.b)("inlineCode",{parentName:"p"},"my-flow.py"),":"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"from dataflows import Flow, dump_to_path, load, update_package\n\ndef flow(parameters, datapackage, resources, stats):\n    stats['multiplied_fields'] = 0\n\n    def multiply(field, n):\n        def step(row):\n            row[field] = row[field] * n\n            stats['multiplied_fields'] += 1\n        return step\n\n    return Flow(update_package(name='my-datapackage'),\n                multiply('my-field', 2))\n")),Object(i.b)("p",null,"And a ",Object(i.b)("inlineCode",{parentName:"p"},"pipeline-spec.yaml")," in the same directory:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"my-flow:\n  pipeline:\n  - run: load_resource\n    parameters:\n      url: http://example.com/my-datapackage/datapackage.json\n      resource: my-resource\n  - flow: my-flow\n  - run: dump_to_path\n")),Object(i.b)("p",null,"You can run the pipeline using ",Object(i.b)("inlineCode",{parentName:"p"},"dpp run my-flow"),"."),Object(i.b)("h2",{id:"the-standard-processor-library"},"The Standard Processor Library"),Object(i.b)("p",null,"A few built in processors are provided with the library."),Object(i.b)("h3",{id:"update_package"},Object(i.b)("strong",{parentName:"h3"},Object(i.b)("em",{parentName:"strong"},Object(i.b)("inlineCode",{parentName:"em"},"update_package")))),Object(i.b)("p",null,"Adds meta-data to the data-package."),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Parameters"),":"),Object(i.b)("p",null,"Any allowed property (according to the ",Object(i.b)("a",{parentName:"p",href:"%5Bhttp://specs.frictionlessdata.io/data-packages/#metadata"},"spec"),") can be provided here."),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Example"),":"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-yaml"},"- run: update_package\n  parameters:\n    name: routes-to-mordor\n    license: CC-BY-SA-4\n    author: Frodo Baggins <frodo@shire.me>\n    contributors:\n      - samwise gamgee <samwise1992@yahoo.com>\n")),Object(i.b)("h3",{id:"update_resource"},Object(i.b)("strong",{parentName:"h3"},Object(i.b)("em",{parentName:"strong"},Object(i.b)("inlineCode",{parentName:"em"},"update_resource")))),Object(i.b)("p",null,"Adds meta-data to the resource."),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Parameters"),":"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"resources"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"A name of a resource to operate on"),Object(i.b)("li",{parentName:"ul"},"A regular expression matching resource names"),Object(i.b)("li",{parentName:"ul"},"A list of resource names"),Object(i.b)("li",{parentName:"ul"},"The index of the resource in the package"),Object(i.b)("li",{parentName:"ul"},"if omitted indicates operation should be done on all resources"))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"metadata")," - A dictionary containing any allowed property (according to the ",Object(i.b)("a",{parentName:"li",href:"%5Bhttps://frictionlessdata.io/specs/data-resource/#metadata"},"spec"),").")),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Example"),":"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-yaml"},"- run: update_resource\n  parameters:\n    resources: ['resource1']\n    metadata:\n      path: 'new-path.csv'\n")),Object(i.b)("h3",{id:"load"},Object(i.b)("strong",{parentName:"h3"},Object(i.b)("em",{parentName:"strong"},Object(i.b)("inlineCode",{parentName:"em"},"load")))),Object(i.b)("p",null,"Loads data into the package, infers the schema and optionally casts values."),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Parameters"),":"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"from")," - location of the data that is to be loaded. This can be either:",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"a local path (e.g. /path/to/the/data.csv)"),Object(i.b)("li",{parentName:"ul"},"a remote URL (e.g. ",Object(i.b)("a",{parentName:"li",href:"https://path.to/the/data.csv"},"https://path.to/the/data.csv"),")"),Object(i.b)("li",{parentName:"ul"},"Other supported links, based on the current support of schemes and formats in ",Object(i.b)("a",{parentName:"li",href:"https://github.com/frictionlessdata/tabulator-py#schemes"},"tabulator")),Object(i.b)("li",{parentName:"ul"},"a local path or remote URL to a datapackage.json file (e.g. ",Object(i.b)("a",{parentName:"li",href:"https://path.to/data_package/datapackage.json"},"https://path.to/data_package/datapackage.json"),")"),Object(i.b)("li",{parentName:"ul"},"a reference to an environment variable containing the source location, in the form of ",Object(i.b)("inlineCode",{parentName:"li"},"env://ENV_VAR")),Object(i.b)("li",{parentName:"ul"},"a tuple containing (datapackage_descriptor, resources_iterator)"))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"resources")," - optional, relevant only if source points to a datapackage.json file or datapackage/resource tuple. Value should be one of the following:",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Name of a single resource to load"),Object(i.b)("li",{parentName:"ul"},"A regular expression matching resource names to load"),Object(i.b)("li",{parentName:"ul"},"A list of resource names to load"),Object(i.b)("li",{parentName:"ul"},"'None' indicates to load all resources"),Object(i.b)("li",{parentName:"ul"},"The index of the resource in the package"))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"validate")," - Should data be casted to the inferred data-types or not. Relevant only when not loading data from datapackage."),Object(i.b)("li",{parentName:"ul"},"other options - based on the loaded file, extra options (e.g. sheet for Excel files etc., see the link to tabulator above)")),Object(i.b)("h3",{id:"printer"},Object(i.b)("strong",{parentName:"h3"},Object(i.b)("em",{parentName:"strong"},Object(i.b)("inlineCode",{parentName:"em"},"printer")))),Object(i.b)("p",null,"Just prints whatever it sees. Good for debugging."),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Parameters"),":"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"num_rows")," - modify the number of rows to preview, printer will print multiple samples of this number of rows from different places in the stream"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"last_rows")," - how many of the last rows in the stream to print. optional, defaults to the value of num_rows"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"fields")," - optional, list of field names to preview"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"resources")," - optional, allows to limit the printed resources, same semantics as load processor resources argument")),Object(i.b)("h3",{id:"set_types"},Object(i.b)("strong",{parentName:"h3"},Object(i.b)("em",{parentName:"strong"},Object(i.b)("inlineCode",{parentName:"em"},"set_types")))),Object(i.b)("p",null,"Sets data types and type options to fields in streamed resources, and make sure that the data still validates with the new types."),Object(i.b)("p",null,"This allows to make modifications to the existing table schema, and usually to the default schema from ",Object(i.b)("inlineCode",{parentName:"p"},"stream_remote_resources"),"."),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Parameters"),":"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"resources")," - Which resources to modify. Can be:"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"List of strings, interpreted as resource names to stream"),Object(i.b)("li",{parentName:"ul"},"String, interpreted as a regular expression to be used to match resource names")),Object(i.b)("p",{parentName:"li"},"If omitted, all resources in datapackage are streamed.")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"regex")," - if set to ",Object(i.b)("inlineCode",{parentName:"p"},"False")," field names will be interpreted as strings not as regular expressions (",Object(i.b)("inlineCode",{parentName:"p"},"True")," by default)")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"types")," - A map between field names and field definitions."),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("em",{parentName:"li"},"field name")," is either simply the name of a field, or a regular expression matching multiple fields."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("em",{parentName:"li"},"field definition")," is an object adhering to the ",Object(i.b)("a",{parentName:"li",href:"http://specs.frictionlessdata.io/table-schema/"},"JSON Table Schema spec"),". You can use ",Object(i.b)("inlineCode",{parentName:"li"},"null")," instead of an object to remove a field from the schema.")))),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Example"),":"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-yaml"},'- run: add_resources\n  parameters:\n    name: example-resource\n    url: http://example.com/my-csv-file.csv\n    encoding: "iso-8859-2"\n- run: stream_remote_resources\n- run: set_types\n  parameters:\n    resources: example-resource\n    types:\n      age:\n        type: integer\n      "yearly_score_[0-9]{4}":\n        type: number\n      "date of birth":\n        type: date\n        format: "%d/%m/%Y"\n      "social security number": null\n')),Object(i.b)("h3",{id:"load_metadata"},Object(i.b)("strong",{parentName:"h3"},Object(i.b)("em",{parentName:"strong"},Object(i.b)("inlineCode",{parentName:"em"},"load_metadata")))),Object(i.b)("p",null,"Loads metadata from an existing data-package."),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Parameters"),":"),Object(i.b)("p",null,"Loads the metadata from the data package located at ",Object(i.b)("inlineCode",{parentName:"p"},"url"),"."),Object(i.b)("p",null,"All properties of the loaded datapackage will be copied (except the ",Object(i.b)("inlineCode",{parentName:"p"},"resources"),")"),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Example"),":"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-yaml"},"- run: load_metadata\n  parameters:\n    url: http://example.com/my-datapackage/datapackage.json\n")),Object(i.b)("h3",{id:"load_resource"},Object(i.b)("strong",{parentName:"h3"},Object(i.b)("em",{parentName:"strong"},Object(i.b)("inlineCode",{parentName:"em"},"load_resource")))),Object(i.b)("p",null,"Loads a tabular resource from an existing data-package."),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Parameters"),":"),Object(i.b)("p",null,"Loads the resource specified in the ",Object(i.b)("inlineCode",{parentName:"p"},"resource")," parameter from the data package located at ",Object(i.b)("inlineCode",{parentName:"p"},"url"),".\nAll properties of the loaded resource will be copied - ",Object(i.b)("inlineCode",{parentName:"p"},"path")," and ",Object(i.b)("inlineCode",{parentName:"p"},"schema")," included."),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"url")," - a URL pointing to the datapackage in which the required resource resides")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"resource")," - can be"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"List of strings, interpreted as resource names to load"),Object(i.b)("li",{parentName:"ul"},"String, interpreted as a regular expression to be used to match resource names"),Object(i.b)("li",{parentName:"ul"},"an integer, indicating the index of the resource in the data package (0-based)"))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"limit-rows")," - if provided, will limit the number of rows fetched from the source. Takes an integer value which specifies how many rows of the source to stream.")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"log-progress-rows")," - if provided, will log the loading progress. Takes an integer value which specifies the number of rows interval at which to log the progress.")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"stream")," - if provided and is set to false, then the resource will be added to the datapackage but not streamed.")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"resources")," - can be used instead of ",Object(i.b)("inlineCode",{parentName:"p"},"resource")," property to support loading resources and modify the output resource metadata"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Value is a dict containing mapping between source resource name to load and dict containing descriptor updates to apply to the loaded resource"))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"required")," - if provided and set to false, will not fail if datapackage is not available or resource is missing"))),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Example"),":"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-yaml"},"- run: load_resource\n  parameters:\n    url: http://example.com/my-datapackage/datapackage.json\n    resource: my-resource\n- run: load_resource\n  parameters:\n    url: http://example.com/my-other-datapackage/datapackage.json\n    resource: 1\n- run: load_resource\n  parameters:\n    url: http://example.com/my-datapackage/datapackage.json\n    resources:\n      my-resource:\n        name: my-renamed-resource\n        path: my-renamed-resource.csv\n")),Object(i.b)("h3",{id:"concatenate"},Object(i.b)("strong",{parentName:"h3"},Object(i.b)("em",{parentName:"strong"},Object(i.b)("inlineCode",{parentName:"em"},"concatenate")))),Object(i.b)("p",null,"Concatenates a number of streamed resources and converts them to a single resource."),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Parameters"),":"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"sources")," - Which resources to concatenate. Same semantics as ",Object(i.b)("inlineCode",{parentName:"p"},"resources")," in ",Object(i.b)("inlineCode",{parentName:"p"},"stream_remote_resources"),"."),Object(i.b)("p",{parentName:"li"},"If omitted, all resources in datapackage are concatenated."),Object(i.b)("p",{parentName:"li"},"Resources to concatenate must appear in consecutive order within the data-package.")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"target")," - Target resource to hold the concatenated data. Should define at least the following properties:"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"name")," - name of the resource"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"path")," - path in the data-package for this file.")),Object(i.b)("p",{parentName:"li"},"If omitted, the target resource will receive the name ",Object(i.b)("inlineCode",{parentName:"p"},"concat")," and will be saved at ",Object(i.b)("inlineCode",{parentName:"p"},"data/concat.csv")," in the datapackage.")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"fields")," - Mapping of fields between the sources and the target, so that the keys are the ",Object(i.b)("em",{parentName:"p"},"target")," field names, and values are lists of ",Object(i.b)("em",{parentName:"p"},"source")," field names."),Object(i.b)("p",{parentName:"li"},"This mapping is used to create the target resources schema."),Object(i.b)("p",{parentName:"li"},"Note that the target field name is ",Object(i.b)("em",{parentName:"p"},"always")," assumed to be mapped to itself."))),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Example"),":"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-yaml"},"- run: concatenate\n  parameters:\n    target:\n      name: multi-year-report\n      path: data/multi-year-report.csv\n    sources: 'report-year-20[0-9]{2}'\n    fields:\n      activity: []\n      amount: ['2009_amount', 'Amount', 'AMOUNT [USD]', '$$$']\n")),Object(i.b)("p",null,"In this example we concatenate all resources that look like ",Object(i.b)("inlineCode",{parentName:"p"},"report-year-<year>"),", and output them to the ",Object(i.b)("inlineCode",{parentName:"p"},"multi-year-report")," resource."),Object(i.b)("p",null,"The output contains two fields:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"activity")," , which is called ",Object(i.b)("inlineCode",{parentName:"li"},"activity")," in all sources"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"amount"),", which has varying names in different resources (e.g. ",Object(i.b)("inlineCode",{parentName:"li"},"Amount"),", ",Object(i.b)("inlineCode",{parentName:"li"},"2009_amount"),", ",Object(i.b)("inlineCode",{parentName:"li"},"amount")," etc.)")),Object(i.b)("h3",{id:"join"},Object(i.b)("strong",{parentName:"h3"},Object(i.b)("em",{parentName:"strong"},Object(i.b)("inlineCode",{parentName:"em"},"join")))),Object(i.b)("p",null,"Joins two streamed resources."),Object(i.b)("p",null,'"Joining" in our case means taking the ',Object(i.b)("em",{parentName:"p"},"target")," resource, and adding fields to each of its rows by looking up data in the ",Object(i.b)("em",{parentName:"p"},"source")," resource."),Object(i.b)("p",null,"A special case for the join operation is when there is no target stream, and all unique rows from the source are used to create it.\nThis mode is called ",Object(i.b)("em",{parentName:"p"},"deduplication")," mode - The target resource will be created and  deduplicated rows from the source will be added to it."),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Parameters"),":"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"source")," - information regarding the ",Object(i.b)("em",{parentName:"p"},"source")," resource"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"name")," - name of the resource"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"key")," - One of",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"List of field names which should be used as the lookup key"),Object(i.b)("li",{parentName:"ul"},"String, which would be interpreted as a Python format string used to form the key (e.g. ",Object(i.b)("inlineCode",{parentName:"li"},"{<field_name_1>}:{field_name_2}"),")"))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"delete")," - delete from data-package after joining (",Object(i.b)("inlineCode",{parentName:"li"},"False")," by default)"))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"target")," - Target resource to hold the joined data. Should define at least the following properties:"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"name")," - as in ",Object(i.b)("inlineCode",{parentName:"li"},"source")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"key")," - as in ",Object(i.b)("inlineCode",{parentName:"li"},"source"),", or ",Object(i.b)("inlineCode",{parentName:"li"},"null")," for creating the target resource and performing ",Object(i.b)("em",{parentName:"li"},"deduplication"),"."))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"fields")," - mapping of fields from the source resource to the target resource.\nKeys should be field names in the target resource.\nValues can define two attributes:"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"name")," - field name in the source (by default is the same as the target field name)")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"aggregate")," - aggregation strategy (how to handle multiple ",Object(i.b)("em",{parentName:"p"},"source")," rows with the same key). Can take the following options:"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"sum")," - summarise aggregated values.\nFor numeric values it's the arithmetic sum, for strings the concatenation of strings and for other types will error.")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"avg")," - calculate the average of aggregated values."),Object(i.b)("p",{parentName:"li"},"For numeric values it's the arithmetic average and for other types will err.")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"max")," - calculate the maximum of aggregated values."),Object(i.b)("p",{parentName:"li"},"For numeric values it's the arithmetic maximum, for strings the dictionary maximum and for other types will error.")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"min")," - calculate the minimum of aggregated values."),Object(i.b)("p",{parentName:"li"},"For numeric values it's the arithmetic minimum, for strings the dictionary minimum and for other types will error.")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"first")," - take the first value encountered")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"last")," - take the last value encountered")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"count")," - count the number of occurrences of a specific key\nFor this method, specifying ",Object(i.b)("inlineCode",{parentName:"p"},"name")," is not required. In case it is specified, ",Object(i.b)("inlineCode",{parentName:"p"},"count")," will count the number of non-null values for that source field.")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"counters")," - count the number of occurrences of distinct values\nWill return an array of 2-tuples of the form ",Object(i.b)("inlineCode",{parentName:"p"},"[value, count-of-value]"),".")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"set")," - collect all distinct values of the aggregated field, unordered")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"array")," - collect all values of the aggregated field, in order of appearance")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"any")," - pick any value."))),Object(i.b)("p",{parentName:"li"},"By default, ",Object(i.b)("inlineCode",{parentName:"p"},"aggregate")," takes the ",Object(i.b)("inlineCode",{parentName:"p"},"any")," value."))),Object(i.b)("p",{parentName:"li"},"If neither ",Object(i.b)("inlineCode",{parentName:"p"},"name")," or ",Object(i.b)("inlineCode",{parentName:"p"},"aggregate")," need to be specified, the mapping can map to the empty object ",Object(i.b)("inlineCode",{parentName:"p"},"{}")," or to ",Object(i.b)("inlineCode",{parentName:"p"},"null"),".")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"full"),"  - Boolean,"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"If ",Object(i.b)("inlineCode",{parentName:"li"},"True"),' (the default), failed lookups in the source will result in "null" values at the source.'),Object(i.b)("li",{parentName:"ul"},"if ",Object(i.b)("inlineCode",{parentName:"li"},"False"),", failed lookups in the source will result in dropping the row from the target.")))),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},'Important: the "source" resource ',Object(i.b)("strong",{parentName:"em"},"must"),' appear before the "target" resource in the data-package.')),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Examples"),":"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-yaml"},'- run: join\n  parameters:\n    source:\n      name: world_population\n      key: ["country_code"]\n      delete: yes\n    target:\n      name: country_gdp_2015\n      key: ["CC"]\n    fields:\n      population:\n        name: "census_2015"\n    full: true\n')),Object(i.b)("p",null,"The above example aims to create a package containing the GDP and Population of each country in the world."),Object(i.b)("p",null,"We have one resource (",Object(i.b)("inlineCode",{parentName:"p"},"world_population"),") with data that looks like:"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",{parentName:"tr",align:null},"country_code"),Object(i.b)("th",{parentName:"tr",align:null},"country_name"),Object(i.b)("th",{parentName:"tr",align:null},"census_2000"),Object(i.b)("th",{parentName:"tr",align:null},"census_2015"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"UK"),Object(i.b)("td",{parentName:"tr",align:null},"United Kingdom"),Object(i.b)("td",{parentName:"tr",align:null},"58857004"),Object(i.b)("td",{parentName:"tr",align:null},"64715810")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"..."),Object(i.b)("td",{parentName:"tr",align:null}),Object(i.b)("td",{parentName:"tr",align:null}),Object(i.b)("td",{parentName:"tr",align:null})))),Object(i.b)("p",null,"And another resource (",Object(i.b)("inlineCode",{parentName:"p"},"country_gdp_2015"),") with data that looks like:"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",{parentName:"tr",align:null},"CC"),Object(i.b)("th",{parentName:"tr",align:null},"GDP (\xa3m)"),Object(i.b)("th",{parentName:"tr",align:null},"Net Debt (\xa3m)"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"UK"),Object(i.b)("td",{parentName:"tr",align:null},"1832318"),Object(i.b)("td",{parentName:"tr",align:null},"1606600")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"..."),Object(i.b)("td",{parentName:"tr",align:null}),Object(i.b)("td",{parentName:"tr",align:null})))),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"join")," command will match rows in both datasets based on the ",Object(i.b)("inlineCode",{parentName:"p"},"country_code")," / ",Object(i.b)("inlineCode",{parentName:"p"},"CC")," fields, and then copying the value in the ",Object(i.b)("inlineCode",{parentName:"p"},"census_2015")," field into a new ",Object(i.b)("inlineCode",{parentName:"p"},"population")," field."),Object(i.b)("p",null,"The resulting data package will have the ",Object(i.b)("inlineCode",{parentName:"p"},"world_population")," resource removed and the ",Object(i.b)("inlineCode",{parentName:"p"},"country_gdp_2015")," resource looking like:"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",{parentName:"tr",align:null},"CC"),Object(i.b)("th",{parentName:"tr",align:null},"GDP (\xa3m)"),Object(i.b)("th",{parentName:"tr",align:null},"Net Debt (\xa3m)"),Object(i.b)("th",{parentName:"tr",align:null},"population"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"UK"),Object(i.b)("td",{parentName:"tr",align:null},"1832318"),Object(i.b)("td",{parentName:"tr",align:null},"1606600"),Object(i.b)("td",{parentName:"tr",align:null},"64715810")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"..."),Object(i.b)("td",{parentName:"tr",align:null}),Object(i.b)("td",{parentName:"tr",align:null}),Object(i.b)("td",{parentName:"tr",align:null})))),Object(i.b)("p",null,"A more complex example:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-yaml"},"- run: join\n  parameters:\n    source:\n      name: screen_actor_salaries\n      key: \"{production} ({year})\"\n    target:\n      name: mgm_movies\n      key: \"{title}\"\n    fields:\n      num_actors:\n        aggregate: 'count'\n      average_salary:\n        name: salary\n        aggregate: 'avg'\n      total_salaries:\n        name: salary\n        aggregate: 'sum'\n    full: false\n")),Object(i.b)("p",null,"This example aims to analyse salaries for screen actors in the MGM studios."),Object(i.b)("p",null,"Once more, we have one resource (",Object(i.b)("inlineCode",{parentName:"p"},"screen_actor_salaries"),") with data that looks like:"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",{parentName:"tr",align:null},"year"),Object(i.b)("th",{parentName:"tr",align:null},"production"),Object(i.b)("th",{parentName:"tr",align:null},"actor"),Object(i.b)("th",{parentName:"tr",align:null},"salary"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"2016"),Object(i.b)("td",{parentName:"tr",align:null},"Vertigo 2"),Object(i.b)("td",{parentName:"tr",align:null},"Mr. T"),Object(i.b)("td",{parentName:"tr",align:null},"15000000")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"2016"),Object(i.b)("td",{parentName:"tr",align:null},"Vertigo 2"),Object(i.b)("td",{parentName:"tr",align:null},"Robert Downey Jr."),Object(i.b)("td",{parentName:"tr",align:null},"7000000")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"2015"),Object(i.b)("td",{parentName:"tr",align:null},"The Fall - Resurrection"),Object(i.b)("td",{parentName:"tr",align:null},"Jeniffer Lawrence"),Object(i.b)("td",{parentName:"tr",align:null},"18000000")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"2015"),Object(i.b)("td",{parentName:"tr",align:null},"Alf - The Return to Melmack"),Object(i.b)("td",{parentName:"tr",align:null},"The Rock"),Object(i.b)("td",{parentName:"tr",align:null},"12000000")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"..."),Object(i.b)("td",{parentName:"tr",align:null}),Object(i.b)("td",{parentName:"tr",align:null}),Object(i.b)("td",{parentName:"tr",align:null})))),Object(i.b)("p",null,"And another resource (",Object(i.b)("inlineCode",{parentName:"p"},"mgm_movies"),") with data that looks like:"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",{parentName:"tr",align:null},"title"),Object(i.b)("th",{parentName:"tr",align:null},"director"),Object(i.b)("th",{parentName:"tr",align:null},"producer"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"Vertigo 2 (2016)"),Object(i.b)("td",{parentName:"tr",align:null},"Lindsay Lohan"),Object(i.b)("td",{parentName:"tr",align:null},"Lee Ka Shing")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"iRobot - The Movie (2018)"),Object(i.b)("td",{parentName:"tr",align:null},"Mr. T"),Object(i.b)("td",{parentName:"tr",align:null},"Mr. T")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"..."),Object(i.b)("td",{parentName:"tr",align:null}),Object(i.b)("td",{parentName:"tr",align:null})))),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"join")," command will match rows in both datasets based on the movie name and production year. Notice how we overcome incompatible fields by using different key patterns."),Object(i.b)("p",null,"The resulting dataset could look like:"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",{parentName:"tr",align:null},"title"),Object(i.b)("th",{parentName:"tr",align:null},"director"),Object(i.b)("th",{parentName:"tr",align:null},"producer"),Object(i.b)("th",{parentName:"tr",align:null},"num_actors"),Object(i.b)("th",{parentName:"tr",align:null},"average_salary"),Object(i.b)("th",{parentName:"tr",align:null},"total_salaries"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"Vertigo 2 (2016)"),Object(i.b)("td",{parentName:"tr",align:null},"Lindsay Lohan"),Object(i.b)("td",{parentName:"tr",align:null},"Lee Ka Shing"),Object(i.b)("td",{parentName:"tr",align:null},"2"),Object(i.b)("td",{parentName:"tr",align:null},"11000000"),Object(i.b)("td",{parentName:"tr",align:null},"22000000")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"..."),Object(i.b)("td",{parentName:"tr",align:null}),Object(i.b)("td",{parentName:"tr",align:null}),Object(i.b)("td",{parentName:"tr",align:null}),Object(i.b)("td",{parentName:"tr",align:null}),Object(i.b)("td",{parentName:"tr",align:null})))),Object(i.b)("h3",{id:"filter"},Object(i.b)("strong",{parentName:"h3"},Object(i.b)("em",{parentName:"strong"},Object(i.b)("inlineCode",{parentName:"em"},"filter")))),Object(i.b)("p",null,"Filter streamed resources."),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"filter")," accepts equality and inequality conditions and tests each row in the selected resources. If none of the conditions validate, the row will be discarded."),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Parameters"),":"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"resources")," - Which resources to apply the filter on. Same semantics as ",Object(i.b)("inlineCode",{parentName:"li"},"resources")," in ",Object(i.b)("inlineCode",{parentName:"li"},"stream_remote_resources"),"."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"in")," - Mapping of keys to values which translate to ",Object(i.b)("inlineCode",{parentName:"li"},"row[key] == value")," conditions"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"out")," - Mapping of keys to values which translate to ",Object(i.b)("inlineCode",{parentName:"li"},"row[key] != value")," conditions")),Object(i.b)("p",null,"Both ",Object(i.b)("inlineCode",{parentName:"p"},"in")," and ",Object(i.b)("inlineCode",{parentName:"p"},"out")," should be a list of objects. However, ",Object(i.b)("inlineCode",{parentName:"p"},"out")," should only ever have one element."),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Examples"),":"),Object(i.b)("p",null,"Filtering just American and European countries, leaving out countries whose main language is English:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-yaml"},"- run: filter\n  parameters:\n    resources: world_population\n    in:\n      - continent: america\n      - continent: europe\n- run: filter\n  parameters:\n    resources: world_population\n    out:\n      - language: english\n")),Object(i.b)("p",null,"To filter ",Object(i.b)("inlineCode",{parentName:"p"},"out")," by multiple values, you need multiple filter processors, not multiple ",Object(i.b)("inlineCode",{parentName:"p"},"out")," elements. Otherwise some condition will always validate and no rows will be discareded:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"- run: filter\n  parameters:\n    resources: world_population\n    out:\n      - language: english\n- run: filter\n  parameters:\n    resources: world_population\n    out:\n      - language: swedish\n")),Object(i.b)("h3",{id:"sort"},Object(i.b)("strong",{parentName:"h3"},Object(i.b)("em",{parentName:"strong"},Object(i.b)("inlineCode",{parentName:"em"},"sort")))),Object(i.b)("p",null,"Sort streamed resources by key."),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"sort")," accepts a list of resources and a key (as a Python format string on row fields).\nIt will output the rows for each resource, sorted according to the key (in ascending order by default)."),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Parameters"),":"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"resources")," - Which resources to sort. Same semantics as ",Object(i.b)("inlineCode",{parentName:"li"},"resources")," in ",Object(i.b)("inlineCode",{parentName:"li"},"stream_remote_resources"),"."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"sort-by")," - String, which would be interpreted as a Python format string used to form the key (e.g. ",Object(i.b)("inlineCode",{parentName:"li"},"{<field_name_1>}:{field_name_2}"),")"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"reverse")," - Optional boolean, if set to true - sorts in reverse order")),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Examples"),":"),Object(i.b)("p",null,"Filtering just American and European countries, leaving out countries whose main language is English:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-yaml"},'- run: sort\n  parameters:\n    resources: world_population\n    sort-by: "{country_name}"\n')),Object(i.b)("h3",{id:"deduplicate"},Object(i.b)("strong",{parentName:"h3"},Object(i.b)("em",{parentName:"strong"},Object(i.b)("inlineCode",{parentName:"em"},"deduplicate")))),Object(i.b)("p",null,"Deduplicates rows in resources based on the resources' primary key"),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"deduplicate")," accepts a resource specifier - for each resource, it will output only unique rows (based on the values in the primary key fields). Rows with duplicate primary keys will be ignored."),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Parameters"),":"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"resources")," - Which resources to sort. Same semantics as ",Object(i.b)("inlineCode",{parentName:"li"},"resources")," in ",Object(i.b)("inlineCode",{parentName:"li"},"stream_remote_resources"),".")),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Examples"),":"),Object(i.b)("p",null,"Deduplicating rows in the ",Object(i.b)("inlineCode",{parentName:"p"},"world-population")," resource."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-yaml"},"- run: deduplicate\n  parameters:\n    resources: world_population\n")),Object(i.b)("h3",{id:"duplicate"},Object(i.b)("strong",{parentName:"h3"},Object(i.b)("em",{parentName:"strong"},Object(i.b)("inlineCode",{parentName:"em"},"duplicate")))),Object(i.b)("p",null,"Duplicate a resource."),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"duplicate")," accepts the name of a single resource in the datapackage.\nIt will then duplicate it in the output datapackage, with a different name and path.\nThe duplicated resource will appear immediately after its original."),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Parameters"),":"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"source")," - Which resources to duplicate. The name of the resource."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"target-name")," - Name of the new, duplicated resource."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"target-path")," - Path for the new, duplicated resource."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"duplicate_to_end")," - Make the duplicate resource appear at the end, rather than immediately after its original.")),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Examples"),":"),Object(i.b)("p",null,"Filtering just American and European countries, leaving out countries whose main language is English:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-yaml"},"- run: duplicate\n  parameters:\n    source: original-resource\n    target-name: copy-of-resource\n    target-path: data/duplicate.csv\n")),Object(i.b)("h3",{id:"delete_fields"},Object(i.b)("strong",{parentName:"h3"},Object(i.b)("em",{parentName:"strong"},Object(i.b)("inlineCode",{parentName:"em"},"delete_fields")))),Object(i.b)("p",null,"Delete fields (columns) from streamed resources"),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"delete_fields")," accepts a list of resources and list of fields to remove"),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Note: if multiple resources provided, all of them should contain all fields to delete")),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Parameters"),":"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"resources")," - Which resources to delete columns from. Same semantics as ",Object(i.b)("inlineCode",{parentName:"li"},"resources")," in ",Object(i.b)("inlineCode",{parentName:"li"},"stream_remote_resources"),"."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"fields")," - List of field (column) names to be removed (exact names or regular expressions for matching field names)"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"regex")," - if set to ",Object(i.b)("inlineCode",{parentName:"li"},"False")," field names will be interpreted as strings not as regular expressions (",Object(i.b)("inlineCode",{parentName:"li"},"True")," by default)")),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Examples"),":"),Object(i.b)("p",null,"Deleting ",Object(i.b)("inlineCode",{parentName:"p"},"country_name")," and ",Object(i.b)("inlineCode",{parentName:"p"},"census_2000")," columns from ",Object(i.b)("inlineCode",{parentName:"p"},"world_population")," resource:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-yaml"},"- run: delete_fields\n  parameters:\n    resources: world_population\n    fields:\n      - country_name\n      - census_2000\n")),Object(i.b)("h3",{id:"add_computed_field"},Object(i.b)("strong",{parentName:"h3"},Object(i.b)("em",{parentName:"strong"},Object(i.b)("inlineCode",{parentName:"em"},"add_computed_field")))),Object(i.b)("p",null,"Add field(s) to streamed resources"),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"add_computed_field")," accepts a list of resources and fields to add to existing resource. It will output the rows for each resource with new field(s) (columns) in it. ",Object(i.b)("inlineCode",{parentName:"p"},"add_computed_field")," allows to perform various operations before inserting value into targeted field."),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Parameters"),":"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"resources")," - Resources to add field. Same semantics as ",Object(i.b)("inlineCode",{parentName:"li"},"resources")," in ",Object(i.b)("inlineCode",{parentName:"li"},"stream_remote_resources"),"."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"fields")," - List of operations to be performed on the targeted fields.",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"operation"),": operation to perform on values of pre-defined columns of the same row. available operation:",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"constant")," - add a constant value"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"sum")," - summed value for given columns in a row."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"avg")," - average value from given columns in a row."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"min")," - minimum value among given columns in a row."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"max")," - maximum value among given columns in a row."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"multiply")," - product of given columns in a row."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"join")," - joins two or more column values in a row."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"format")," - Python format string used to form the value Eg:  ",Object(i.b)("inlineCode",{parentName:"li"},"my name is {first_name}"),"."))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"target")," - name of the new field."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"source")," - list of columns the operations should be performed on (Not required in case of ",Object(i.b)("inlineCode",{parentName:"li"},"format")," and ",Object(i.b)("inlineCode",{parentName:"li"},"constant"),")."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"with")," - String passed to ",Object(i.b)("inlineCode",{parentName:"li"},"constant"),", ",Object(i.b)("inlineCode",{parentName:"li"},"format")," or ",Object(i.b)("inlineCode",{parentName:"li"},"join")," operations",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"in ",Object(i.b)("inlineCode",{parentName:"li"},"constant")," - used as constant value"),Object(i.b)("li",{parentName:"ul"},"in ",Object(i.b)("inlineCode",{parentName:"li"},"format")," - used as Python format string with existing column values Eg: ",Object(i.b)("inlineCode",{parentName:"li"},"{first_name} {last_name}")),Object(i.b)("li",{parentName:"ul"},"in ",Object(i.b)("inlineCode",{parentName:"li"},"join")," - used as delimiter")))))),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Examples"),":"),Object(i.b)("p",null,"Following example adds 4 new field to ",Object(i.b)("inlineCode",{parentName:"p"},"salaries")," resource"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-yaml"},"run: add_computed_field\nparameters:\n  resources: salaries\n  fields:\n    -\n      operation: sum\n      target: total\n      source:\n        - jan\n        - feb\n        - may\n    -\n      operation: avg\n      target: average\n      source:\n        - jan\n        - feb\n        - may\n    -\n      operation: format\n      target: full_name\n      with: '{first_name} {last_name}'\n    -\n      operation: constant\n      target: status\n      with: single\n")),Object(i.b)("p",null,"We have one resource (",Object(i.b)("inlineCode",{parentName:"p"},"salaries"),") with data that looks like:"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",{parentName:"tr",align:null},"first_name"),Object(i.b)("th",{parentName:"tr",align:null},"last_name"),Object(i.b)("th",{parentName:"tr",align:null},"jan"),Object(i.b)("th",{parentName:"tr",align:null},"feb"),Object(i.b)("th",{parentName:"tr",align:null},"mar"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"John"),Object(i.b)("td",{parentName:"tr",align:null},"Doe"),Object(i.b)("td",{parentName:"tr",align:null},"100"),Object(i.b)("td",{parentName:"tr",align:null},"200"),Object(i.b)("td",{parentName:"tr",align:null},"300")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"..."),Object(i.b)("td",{parentName:"tr",align:null}),Object(i.b)("td",{parentName:"tr",align:null}),Object(i.b)("td",{parentName:"tr",align:null}),Object(i.b)("td",{parentName:"tr",align:null})))),Object(i.b)("p",null,"The resulting dataset could look like:"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",{parentName:"tr",align:null},"first_name"),Object(i.b)("th",{parentName:"tr",align:null},"last_name"),Object(i.b)("th",{parentName:"tr",align:null},"last_name"),Object(i.b)("th",{parentName:"tr",align:null},"jan"),Object(i.b)("th",{parentName:"tr",align:null},"feb"),Object(i.b)("th",{parentName:"tr",align:null},"mar"),Object(i.b)("th",{parentName:"tr",align:null},"average"),Object(i.b)("th",{parentName:"tr",align:null},"total"),Object(i.b)("th",{parentName:"tr",align:null},"status"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"John"),Object(i.b)("td",{parentName:"tr",align:null},"Doe"),Object(i.b)("td",{parentName:"tr",align:null},"John Doe"),Object(i.b)("td",{parentName:"tr",align:null},"100"),Object(i.b)("td",{parentName:"tr",align:null},"200"),Object(i.b)("td",{parentName:"tr",align:null},"300"),Object(i.b)("td",{parentName:"tr",align:null},"200"),Object(i.b)("td",{parentName:"tr",align:null},"600"),Object(i.b)("td",{parentName:"tr",align:null},"single")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"..."),Object(i.b)("td",{parentName:"tr",align:null}),Object(i.b)("td",{parentName:"tr",align:null}),Object(i.b)("td",{parentName:"tr",align:null}),Object(i.b)("td",{parentName:"tr",align:null}),Object(i.b)("td",{parentName:"tr",align:null}),Object(i.b)("td",{parentName:"tr",align:null}),Object(i.b)("td",{parentName:"tr",align:null}),Object(i.b)("td",{parentName:"tr",align:null})))),Object(i.b)("h3",{id:"find_replace"},Object(i.b)("strong",{parentName:"h3"},Object(i.b)("em",{parentName:"strong"},Object(i.b)("inlineCode",{parentName:"em"},"find_replace")))),Object(i.b)("p",null,"find and replace string or pattern from field(s) values"),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Parameters"),":"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"resources")," - Resources to clean the field values. Same semantics as ",Object(i.b)("inlineCode",{parentName:"p"},"resources")," in ",Object(i.b)("inlineCode",{parentName:"p"},"stream_remote_resources"))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"fields"),"- list of fields to replace values"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"name")," - name of the field to replace value"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"patterns")," - list of patterns to find and replace from field",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"find")," - String, interpreted as a regular expression to match field value"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"replace")," - String, interpreted as a regular expression to replace matched pattern")))))),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Examples"),":"),Object(i.b)("p",null,"Following example replaces field values using regular expression and exact string patterns"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-yaml"},"run: find_replace\nparameters:\n  resources: dates\n  fields:\n    -\n      name: year\n      patterns:\n        -\n          find: ([0-9]{4})( \\(\\w+\\))\n          replace: \\1\n    -\n      name: quarter\n      patterns:\n        -\n          find: Q1\n          replace: '03-31'\n        -\n          find: Q2\n          replace: '06-31'\n        -\n          find: Q3\n          replace: '09-30'\n        -\n          find: Q4\n          replace: '12-31'\n")),Object(i.b)("p",null,"We have one resource (",Object(i.b)("inlineCode",{parentName:"p"},"dates"),") with data that looks like:"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",{parentName:"tr",align:null},"year"),Object(i.b)("th",{parentName:"tr",align:null},"quarter"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"2000 (1)"),Object(i.b)("td",{parentName:"tr",align:null},"2000-Q1")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"..."),Object(i.b)("td",{parentName:"tr",align:null})))),Object(i.b)("p",null,"The resulting dataset could look like:"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",{parentName:"tr",align:null},"year"),Object(i.b)("th",{parentName:"tr",align:null},"quarter"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"2000"),Object(i.b)("td",{parentName:"tr",align:null},"2000-03-31")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"..."),Object(i.b)("td",{parentName:"tr",align:null})))),Object(i.b)("h3",{id:"unpivot"},Object(i.b)("strong",{parentName:"h3"},Object(i.b)("em",{parentName:"strong"},Object(i.b)("inlineCode",{parentName:"em"},"unpivot")))),Object(i.b)("p",null,"Unpivots, transposes tabular data so that there's only one record per row."),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Parameters"),":"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"resources")," - Resources to unpivot. Same semantics as ",Object(i.b)("inlineCode",{parentName:"li"},"resources")," in ",Object(i.b)("inlineCode",{parentName:"li"},"stream_remote_resources"),"."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"extraKeyFields")," - List of target field definitions, each definition is an object containing at least these properties (unpivoted column values will go here)",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"name")," - Name of the target field"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"type")," - Type of the target field"))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"extraValueField")," - Target field definition - an object containing at least these properties (unpivoted cell values will go here)",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"name")," - Name of the target field"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"type")," - Type of the target field"))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"unpivot")," - List of source field definitions, each definition is an object containing at least these properties",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"name")," - Either simply the name, or a regular expression matching the name of original field to unpivot."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"keys")," - A Map between target field name and values for original field",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Keys should be target field names from ",Object(i.b)("inlineCode",{parentName:"li"},"extraKeyFields")),Object(i.b)("li",{parentName:"ul"},"Values may be either simply the constant value to insert, or a regular expression matching the ",Object(i.b)("inlineCode",{parentName:"li"},"name"),".")))))),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Examples"),":"),Object(i.b)("p",null,"Following example will unpivot data into 3 new fields: ",Object(i.b)("inlineCode",{parentName:"p"},"year"),", ",Object(i.b)("inlineCode",{parentName:"p"},"direction")," and ",Object(i.b)("inlineCode",{parentName:"p"},"amount")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-yaml"},"parameters:\n  resources: balance\n  extraKeyFields:\n    -\n      name: year\n      type: integer\n    -\n      name: direction\n      type: string\n      constraints:\n        enum:\n          - In\n          - Out\n  extraValueField:\n      name: amount\n      type: number\n  unpivot:\n    -\n      name: 2015 incomes\n      keys:\n        year: 2015\n        direction: In\n    -\n      name: 2015 expenses\n      keys:\n        year: 2015\n        direction: Out\n    -\n      name: 2016 incomes\n      keys:\n        year: 2016\n        direction: In\n    -\n      name: 2016 expenses\n      keys:\n        year: 2016\n        direction: Out\n")),Object(i.b)("p",null,"We have one resource (",Object(i.b)("inlineCode",{parentName:"p"},"balance"),") with data that looks like:"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",{parentName:"tr",align:null},"company"),Object(i.b)("th",{parentName:"tr",align:null},"2015 incomes"),Object(i.b)("th",{parentName:"tr",align:null},"2015 expenses"),Object(i.b)("th",{parentName:"tr",align:null},"2016 incomes"),Object(i.b)("th",{parentName:"tr",align:null},"2016 expenses"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"Inc"),Object(i.b)("td",{parentName:"tr",align:null},"1000"),Object(i.b)("td",{parentName:"tr",align:null},"900"),Object(i.b)("td",{parentName:"tr",align:null},"2000"),Object(i.b)("td",{parentName:"tr",align:null},"1700")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"Org"),Object(i.b)("td",{parentName:"tr",align:null},"2000"),Object(i.b)("td",{parentName:"tr",align:null},"800"),Object(i.b)("td",{parentName:"tr",align:null},"3000"),Object(i.b)("td",{parentName:"tr",align:null},"2000")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"..."),Object(i.b)("td",{parentName:"tr",align:null}),Object(i.b)("td",{parentName:"tr",align:null}),Object(i.b)("td",{parentName:"tr",align:null}),Object(i.b)("td",{parentName:"tr",align:null})))),Object(i.b)("p",null,"The resulting dataset could look like:"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",{parentName:"tr",align:null},"company"),Object(i.b)("th",{parentName:"tr",align:null},"year"),Object(i.b)("th",{parentName:"tr",align:null},"direction"),Object(i.b)("th",{parentName:"tr",align:null},"amount"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"Inc"),Object(i.b)("td",{parentName:"tr",align:null},"2015"),Object(i.b)("td",{parentName:"tr",align:null},"In"),Object(i.b)("td",{parentName:"tr",align:null},"1000")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"Inc"),Object(i.b)("td",{parentName:"tr",align:null},"2015"),Object(i.b)("td",{parentName:"tr",align:null},"Out"),Object(i.b)("td",{parentName:"tr",align:null},"900")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"Inc"),Object(i.b)("td",{parentName:"tr",align:null},"2016"),Object(i.b)("td",{parentName:"tr",align:null},"In"),Object(i.b)("td",{parentName:"tr",align:null},"2000")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"Inc"),Object(i.b)("td",{parentName:"tr",align:null},"2016"),Object(i.b)("td",{parentName:"tr",align:null},"Out"),Object(i.b)("td",{parentName:"tr",align:null},"1700")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"Org"),Object(i.b)("td",{parentName:"tr",align:null},"2015"),Object(i.b)("td",{parentName:"tr",align:null},"In"),Object(i.b)("td",{parentName:"tr",align:null},"2000")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"Org"),Object(i.b)("td",{parentName:"tr",align:null},"2015"),Object(i.b)("td",{parentName:"tr",align:null},"Out"),Object(i.b)("td",{parentName:"tr",align:null},"800")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"Org"),Object(i.b)("td",{parentName:"tr",align:null},"2016"),Object(i.b)("td",{parentName:"tr",align:null},"In"),Object(i.b)("td",{parentName:"tr",align:null},"3000")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"Org"),Object(i.b)("td",{parentName:"tr",align:null},"2016"),Object(i.b)("td",{parentName:"tr",align:null},"Out"),Object(i.b)("td",{parentName:"tr",align:null},"2000")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"..."),Object(i.b)("td",{parentName:"tr",align:null}),Object(i.b)("td",{parentName:"tr",align:null}),Object(i.b)("td",{parentName:"tr",align:null})))),Object(i.b)("p",null,"Similar result can be accomplished by defining regular expressions instead of constant values"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-yaml"},"parameters:\n  resources: balance\n  extraKeyFields:\n    -\n      name: year\n      type: integer\n    -\n      name: direction\n      type: string\n      constraints:\n        enum:\n          - In\n          - Out\n  extraValueField:\n      name: amount\n      type: number\n  unpivot:\n    -\n      name: ([0-9]{4}) (\\\\w+)  # regex for original column\n      keys:\n        year: \\\\1  # First member of group from above\n        direction: \\\\2  # Second member of group from above\n")),Object(i.b)("h3",{id:"dump_to_sql"},Object(i.b)("strong",{parentName:"h3"},Object(i.b)("em",{parentName:"strong"},Object(i.b)("inlineCode",{parentName:"em"},"dump_to_sql")))),Object(i.b)("p",null,"Saves the datapackage to an SQL database."),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Parameters"),":"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"engine")," - Connection string for connecting to the SQL Database (URL syntax)\nAlso supports ",Object(i.b)("inlineCode",{parentName:"li"},"env://<environment-variable>"),", which indicates that the connection string should be fetched from the indicated environment variable.\nIf not specified, assumes a default of ",Object(i.b)("inlineCode",{parentName:"li"},"env://DPP_DB_ENGINE")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"tables")," - Mapping between resources and DB tables. Keys are table names, values are objects with the following attributes:",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"resource-name")," - name of the resource that should be dumped to the table"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"mode")," - How data should be written to the DB.\nPossible values:",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"rewrite")," (the default) - rewrite the table, all previous data (if any) will be deleted."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"append")," - write new rows without changing already existing data."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"update"),' - update the table based on a set of "update keys".\nFor each new row, see if there already an existing row in the DB which can be updated (that is, an existing row\nwith the same values in all of the update keys).\nIf so - update the rest of the columns in the existing row. Otherwise - insert a new row to the DB.'))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"update_keys")," - Only applicable for the ",Object(i.b)("inlineCode",{parentName:"li"},"update")," mode. A list of field names that should be used to check for row existence.\nIf left unspecified, will use the schema's ",Object(i.b)("inlineCode",{parentName:"li"},"primaryKey")," as default."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"indexes")," - TBD"))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"updated_column")," - Optional name of a column that will be added to the spewed data with boolean value",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"true")," - row was updated"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"false")," - row was inserted"))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"updated_id_column")," - Optional name of a column that will be added to the spewed data and contain the id of the updated row in DB.")),Object(i.b)("h3",{id:"dump_to_path"},Object(i.b)("strong",{parentName:"h3"},Object(i.b)("em",{parentName:"strong"},Object(i.b)("inlineCode",{parentName:"em"},"dump_to_path")))),Object(i.b)("p",null,"Saves the datapackage to a filesystem path."),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Parameters"),":"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"out-path")," - Name of the output path where ",Object(i.b)("inlineCode",{parentName:"p"},"datapackage.json")," will be stored."),Object(i.b)("p",{parentName:"li"},"This path will be created if it doesn't exist, as well as internal data-package paths."),Object(i.b)("p",{parentName:"li"},"If omitted, then ",Object(i.b)("inlineCode",{parentName:"p"},".")," (the current directory) will be assumed.")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"force-format")," - Specifies whether to force all output files to be generated with the same format"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"if ",Object(i.b)("inlineCode",{parentName:"li"},"True")," (the default), all resources will use the same format"),Object(i.b)("li",{parentName:"ul"},"if ",Object(i.b)("inlineCode",{parentName:"li"},"False"),", format will be deduced from the file extension. Resources with unknown extensions will be discarded."))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"format")," - Specifies the type of output files to be generated (if ",Object(i.b)("inlineCode",{parentName:"p"},"force-format")," is true): ",Object(i.b)("inlineCode",{parentName:"p"},"csv")," (the default) or ",Object(i.b)("inlineCode",{parentName:"p"},"json"))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"add-filehash-to-path"),": Specifies whether to include file md5 hash into the resource path. Defaults to ",Object(i.b)("inlineCode",{parentName:"p"},"False"),". If ",Object(i.b)("inlineCode",{parentName:"p"},"True")," Embeds hash in path like so:"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"If original path is ",Object(i.b)("inlineCode",{parentName:"li"},"path/to/the/file.ext")),Object(i.b)("li",{parentName:"ul"},"Modified path will be ",Object(i.b)("inlineCode",{parentName:"li"},"path/to/the/HASH/file.ext")))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"counters")," - Specifies whether to count rows, bytes or md5 hash of the data and where it should be stored. An object with the following properties:"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"datapackage-rowcount"),": Where should a total row count of the datapackage be stored (default: ",Object(i.b)("inlineCode",{parentName:"li"},"count_of_rows"),")"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"datapackage-bytes"),": Where should a total byte count of the datapackage be stored (default: ",Object(i.b)("inlineCode",{parentName:"li"},"bytes"),")"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"datapackage-hash"),": Where should an md5 hash of the datapackage be stored (default: ",Object(i.b)("inlineCode",{parentName:"li"},"hash"),")"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"resource-rowcount"),": Where should a total row count of each resource be stored (default: ",Object(i.b)("inlineCode",{parentName:"li"},"count_of_rows"),")"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"resource-bytes"),": Where should a total byte count of each resource be stored (default: ",Object(i.b)("inlineCode",{parentName:"li"},"bytes"),")"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"resource-hash"),": Where should an md5 hash of each resource be stored (default: ",Object(i.b)("inlineCode",{parentName:"li"},"hash"),")\nEach of these attributes could be set to null in order to prevent the counting.\nEach property could be a dot-separated string, for storing the data inside a nested object (e.g. ",Object(i.b)("inlineCode",{parentName:"li"},"stats.rowcount"),")"))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"pretty-descriptor"),": Specifies how datapackage descriptor (",Object(i.b)("inlineCode",{parentName:"p"},"datapackage.json"),") file will look like:"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"False")," (default) - descriptor will be written in one line."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"True")," - descriptor will have indents and new lines for each key, so it becomes more human-readable.")))),Object(i.b)("h3",{id:"dump_to_zip"},Object(i.b)("strong",{parentName:"h3"},Object(i.b)("em",{parentName:"strong"},Object(i.b)("inlineCode",{parentName:"em"},"dump_to_zip")))),Object(i.b)("p",null,"Saves the datapackage to a zipped archive."),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Parameters"),":"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"out-file")," - Name of the output file where the zipped data will be stored"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"force-format")," and ",Object(i.b)("inlineCode",{parentName:"li"},"format")," - Same as in ",Object(i.b)("inlineCode",{parentName:"li"},"dump_to_path")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"add-filehash-to-path")," - Same as in ",Object(i.b)("inlineCode",{parentName:"li"},"dump_to_path")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"counters")," - Same as in ",Object(i.b)("inlineCode",{parentName:"li"},"dump_to_path")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"pretty-descriptor")," - Same as in ",Object(i.b)("inlineCode",{parentName:"li"},"dump_to_path"))),Object(i.b)("h2",{id:"deprecated-processors"},"Deprecated Processors"),Object(i.b)("p",null,"These processors will be removed in the next major version."),Object(i.b)("h3",{id:"add_metadata"},Object(i.b)("strong",{parentName:"h3"},Object(i.b)("em",{parentName:"strong"},Object(i.b)("inlineCode",{parentName:"em"},"add_metadata")))),Object(i.b)("p",null,"Alias for ",Object(i.b)("inlineCode",{parentName:"p"},"update_package"),", is kept for backward compatibility reasons."),Object(i.b)("h3",{id:"add_resource"},Object(i.b)("strong",{parentName:"h3"},Object(i.b)("em",{parentName:"strong"},Object(i.b)("inlineCode",{parentName:"em"},"add_resource")))),Object(i.b)("p",null,"Adds a new external tabular resource to the data-package."),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Parameters"),":"),Object(i.b)("p",null,"You should provide a ",Object(i.b)("inlineCode",{parentName:"p"},"name")," and ",Object(i.b)("inlineCode",{parentName:"p"},"url")," attributes, and other optional attributes as defined in the ",Object(i.b)("a",{parentName:"p",href:"%5Bhttp://specs.frictionlessdata.io/data-packages/#resource-information"},"spec"),"."),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"url")," indicates where the data for this resource resides. Later on, when ",Object(i.b)("inlineCode",{parentName:"p"},"stream_remote_resources")," runs, it will use the ",Object(i.b)("inlineCode",{parentName:"p"},"url")," (which is stored in the resource in the ",Object(i.b)("inlineCode",{parentName:"p"},"dpp:streamedFrom")," property) to read the data rows and push them into the pipeline."),Object(i.b)("p",null,"Note that ",Object(i.b)("inlineCode",{parentName:"p"},"url")," also supports ",Object(i.b)("inlineCode",{parentName:"p"},"env://<environment-variable>"),", which indicates that the resource url should be fetched from the indicated environment variable.  This is useful in case you are supplying a string with sensitive information (such as an SQL connection string for streaming from a database table)."),Object(i.b)("p",null,"Parameters are basically arguments that are passed to a ",Object(i.b)("inlineCode",{parentName:"p"},"tabulator.Stream")," instance (see the ",Object(i.b)("a",{parentName:"p",href:"https://github.com/frictionlessdata/tabulator-py#api-reference"},"API"),").\nOther than those, you can pass a ",Object(i.b)("inlineCode",{parentName:"p"},"constants")," parameter which should be a mapping of headers to string values.\nWhen used in conjunction with ",Object(i.b)("inlineCode",{parentName:"p"},"stream_remote_resources"),", these constant values will be added to each generated row\n(as well as to the default schema)."),Object(i.b)("p",null,"You may also provide a schema here, or use the default schema generated by the ",Object(i.b)("inlineCode",{parentName:"p"},"stream_remote_resources")," processor.\nIn case ",Object(i.b)("inlineCode",{parentName:"p"},"path")," is specified, it will be used. If not, the ",Object(i.b)("inlineCode",{parentName:"p"},"stream_remote_resources")," processor will assign a ",Object(i.b)("inlineCode",{parentName:"p"},"path")," for you with a ",Object(i.b)("inlineCode",{parentName:"p"},"csv")," extension."),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Example"),":"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-yaml"},'- run: add_resource\n  parameters:\n    url: http://example.com/my-excel-file.xlsx\n    sheet: 1\n    headers: 2\n- run: add_resource\n  parameters:\n    url: http://example.com/my-csv-file.csv\n    encoding: "iso-8859-2"\n')),Object(i.b)("h3",{id:"stream_remote_resources"},Object(i.b)("strong",{parentName:"h3"},Object(i.b)("em",{parentName:"strong"},Object(i.b)("inlineCode",{parentName:"em"},"stream_remote_resources")))),Object(i.b)("p",null,"Converts external resources to streamed resources."),Object(i.b)("p",null,"External resources are ones that link to a remote data source (url or file path), but are not processed by the pipeline and are kept as-is."),Object(i.b)("p",null,"Streamed resources are ones that can be processed by the pipeline, and their output is saved as part of the resulting datapackage."),Object(i.b)("p",null,"In case a resource has no schema, a default one is generated automatically here by creating a ",Object(i.b)("inlineCode",{parentName:"p"},"string")," field from each column in the data source."),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Parameters"),":"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"resources")," - Which resources to stream. Can be:"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"List of strings, interpreted as resource names to stream"),Object(i.b)("li",{parentName:"ul"},"String, interpreted as a regular expression to be used to match resource names")),Object(i.b)("p",{parentName:"li"},"If omitted, all resources in datapackage are streamed.")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"ignore-missing")," - if true, then missing resources won't raise an error but will be treated as 'empty' (i.e. with zero rows).\nResources with empty URLs will be treated the same (i.e. will generate an 'empty' resource).")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"limit-rows")," - if provided, will limit the number of rows fetched from the source. Takes an integer value which specifies how many rows of the source to stream."))),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Example"),":"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-yaml"},"- run: stream_remote_resources\n  parameters:\n    resources: ['2014-data', '2015-data']\n- run: stream_remote_resources\n  parameters:\n    resources: '201[67]-data'\n")),Object(i.b)("p",null,'This processor also supports loading plain-text resources (e.g. html pages) and handling them as tabular data - split into rows with a single "data" column.\nTo enable this behavior, add the following attribute to the resource: ',Object(i.b)("inlineCode",{parentName:"p"},'"format": "txt"'),"."),Object(i.b)("h3",{id:"dumpto_sql"},Object(i.b)("strong",{parentName:"h3"},Object(i.b)("em",{parentName:"strong"},Object(i.b)("inlineCode",{parentName:"em"},"dump.to_sql")))),Object(i.b)("p",null,"Alias for ",Object(i.b)("inlineCode",{parentName:"p"},"dump_to_sql"),", is kept for backward compatibility reasons."),Object(i.b)("h3",{id:"dumpto_path"},Object(i.b)("strong",{parentName:"h3"},Object(i.b)("em",{parentName:"strong"},Object(i.b)("inlineCode",{parentName:"em"},"dump.to_path")))),Object(i.b)("p",null,"Saves the datapackage to a filesystem path."),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Parameters"),":"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"out-path")," - Name of the output path where ",Object(i.b)("inlineCode",{parentName:"p"},"datapackage.json")," will be stored."),Object(i.b)("p",{parentName:"li"},"This path will be created if it doesn't exist, as well as internal data-package paths."),Object(i.b)("p",{parentName:"li"},"If omitted, then ",Object(i.b)("inlineCode",{parentName:"p"},".")," (the current directory) will be assumed.")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"force-format")," - Specifies whether to force all output files to be generated with the same format"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"if ",Object(i.b)("inlineCode",{parentName:"li"},"True")," (the default), all resources will use the same format"),Object(i.b)("li",{parentName:"ul"},"if ",Object(i.b)("inlineCode",{parentName:"li"},"False"),", format will be deduced from the file extension. Resources with unknown extensions will be discarded."))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"format")," - Specifies the type of output files to be generated (if ",Object(i.b)("inlineCode",{parentName:"p"},"force-format")," is true): ",Object(i.b)("inlineCode",{parentName:"p"},"csv")," (the default) or ",Object(i.b)("inlineCode",{parentName:"p"},"json"))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"handle-non-tabular")," - Specifies whether non tabular resources (i.e. resources without a ",Object(i.b)("inlineCode",{parentName:"p"},"schema"),") should be dumped as well to the resulting datapackage.\n(See note below for more details)")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"add-filehash-to-path"),": Specifies whether to include file md5 hash into the resource path. Defaults to ",Object(i.b)("inlineCode",{parentName:"p"},"False"),". If ",Object(i.b)("inlineCode",{parentName:"p"},"True")," Embeds hash in path like so:"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"If original path is ",Object(i.b)("inlineCode",{parentName:"li"},"path/to/the/file.ext")),Object(i.b)("li",{parentName:"ul"},"Modified path will be ",Object(i.b)("inlineCode",{parentName:"li"},"path/to/the/HASH/file.ext")))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"counters")," - Specifies whether to count rows, bytes or md5 hash of the data and where it should be stored. An object with the following properties:"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"datapackage-rowcount"),": Where should a total row count of the datapackage be stored (default: ",Object(i.b)("inlineCode",{parentName:"li"},"count_of_rows"),")"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"datapackage-bytes"),": Where should a total byte count of the datapackage be stored (default: ",Object(i.b)("inlineCode",{parentName:"li"},"bytes"),")"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"datapackage-hash"),": Where should an md5 hash of the datapackage be stored (default: ",Object(i.b)("inlineCode",{parentName:"li"},"hash"),")"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"resource-rowcount"),": Where should a total row count of each resource be stored (default: ",Object(i.b)("inlineCode",{parentName:"li"},"count_of_rows"),")"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"resource-bytes"),": Where should a total byte count of each resource be stored (default: ",Object(i.b)("inlineCode",{parentName:"li"},"bytes"),")"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"resource-hash"),": Where should an md5 hash of each resource be stored (default: ",Object(i.b)("inlineCode",{parentName:"li"},"hash"),")\nEach of these attributes could be set to null in order to prevent the counting.\nEach property could be a dot-separated string, for storing the data inside a nested object (e.g. ",Object(i.b)("inlineCode",{parentName:"li"},"stats.rowcount"),")"))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"pretty-descriptor"),": Specifies how datapackage descriptor (",Object(i.b)("inlineCode",{parentName:"p"},"datapackage.json"),") file will look like:"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"False")," (default) - descriptor will be written in one line."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"True")," - descriptor will have indents and new lines for each key, so it becomes more human-readable."))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"file-formatters"),": Specifies custom file format handlers. An object with mapping of format name to Python module and class name."),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Allows to override the existing ",Object(i.b)("inlineCode",{parentName:"li"},"csv")," and ",Object(i.b)("inlineCode",{parentName:"li"},"json")," format handlers or add support for new formats."),Object(i.b)("li",{parentName:"ul"},"Note that such changes may make the resulting datapackage incompatible with the frictionlessdata specs and may cause interoperability problems."),Object(i.b)("li",{parentName:"ul"},"Example usage: ",Object(i.b)("a",{parentName:"li",href:"tests/cli/pipeline-spec.yaml"},"pipeline-spec.yaml")," (under the ",Object(i.b)("inlineCode",{parentName:"li"},"custom-formatters")," pipeline), ",Object(i.b)("a",{parentName:"li",href:"tests/cli/custom_formatters/xlsx_format.py"},"XLSXFormat class"))))),Object(i.b)("h3",{id:"dumpto_zip"},Object(i.b)("strong",{parentName:"h3"},Object(i.b)("em",{parentName:"strong"},Object(i.b)("inlineCode",{parentName:"em"},"dump.to_zip")))),Object(i.b)("p",null,"Saves the datapackage to a zipped archive."),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Parameters"),":"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"out-file")," - Name of the output file where the zipped data will be stored"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"force-format")," and ",Object(i.b)("inlineCode",{parentName:"li"},"format")," - Same as in ",Object(i.b)("inlineCode",{parentName:"li"},"dump_to_path")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"handle-non-tabular")," - Same as in ",Object(i.b)("inlineCode",{parentName:"li"},"dump_to_path")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"add-filehash-to-path")," - Same as in ",Object(i.b)("inlineCode",{parentName:"li"},"dump_to_path")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"counters")," - Same as in ",Object(i.b)("inlineCode",{parentName:"li"},"dump_to_path")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"pretty-descriptor")," - Same as in ",Object(i.b)("inlineCode",{parentName:"li"},"dump_to_path")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"file-formatters")," - Same as in ",Object(i.b)("inlineCode",{parentName:"li"},"dump_to_path"))),Object(i.b)("h4",{id:"note"},Object(i.b)("em",{parentName:"h4"},"Note")),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"dump.to_path")," and ",Object(i.b)("inlineCode",{parentName:"p"},"dump.to_zip")," processors will handle non-tabular resources as well.\nThese resources must have both a ",Object(i.b)("inlineCode",{parentName:"p"},"url")," and ",Object(i.b)("inlineCode",{parentName:"p"},"path")," properties, and ",Object(i.b)("em",{parentName:"p"},"must not")," contain a ",Object(i.b)("inlineCode",{parentName:"p"},"schema")," property.\nIn such cases, the file will be downloaded from the ",Object(i.b)("inlineCode",{parentName:"p"},"url")," and placed in the provided ",Object(i.b)("inlineCode",{parentName:"p"},"path"),"."),Object(i.b)("h2",{id:"custom-processors"},"Custom Processors"),Object(i.b)("p",null,"It's quite reasonable that for any non-trivial processing task, you might encounter a problem that cannot be solved using the standard library processors."),Object(i.b)("p",null,"For that you might need to write your own processor - here's how it's done."),Object(i.b)("p",null,"There are two APIs for writing processors - the high level API and the low level API."),Object(i.b)("h3",{id:"high-level-processor-api"},"High Level Processor API"),Object(i.b)("p",null,"The high-level API is quite useful for most processor kinds:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-python"},"from datapackage_pipelines.wrapper import process\n\ndef modify_datapackage(datapackage, parameters, stats):\n    # Do something with datapackage\n    return datapackage\n\ndef process_row(row, row_index,\n                resource_descriptor, resource_index,\n                parameters, stats):\n    # Do something with row\n    return row\n\nprocess(modify_datapackage=modify_datapackage,\n        process_row=process_row)\n")),Object(i.b)("p",null,"The high level API consists of one method, ",Object(i.b)("inlineCode",{parentName:"p"},"process")," which takes two functions:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"modify_datapackage")," - which makes changes (if necessary) to the data-package descriptor, e.g. adds metadata, adds resources, modifies resources' schema etc."),Object(i.b)("p",{parentName:"li"},"Can also be used for initialization code when needed."),Object(i.b)("p",{parentName:"li"},"It has these arguments:"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"datapackage")," is the current data-package descriptor that needs to be modified.\nThe modified data-package descriptor needs to be returned."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"parameters")," is a dict containing the processor's parameters, as provided in the ",Object(i.b)("inlineCode",{parentName:"li"},"pipeline-spec.yaml")," file."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"stats")," is a dict which should be modified in order to collect metrics and measurements in the process (e.g. validation checks, row count etc.)"))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"process_row")," - which modifies a single row in the stream. It receives these arguments:"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"row")," is a dictionary containing the row to process"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"row_index")," is the index of the row in the resource"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"resource_descriptor")," is the descriptor object of the current resource being processed"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"resource_index")," is the index of the resource in the data-package"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"parameters")," is a dict containing the processor's parameters, as provided in the ",Object(i.b)("inlineCode",{parentName:"li"},"pipeline-spec.yaml")," file."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"stats")," is a dict which should be modified in order to collect metrics and measurements in the process (e.g. validation checks, row count etc.)")),Object(i.b)("p",{parentName:"li"},"and yields zero or more processed rows."))),Object(i.b)("h4",{id:"a-few-examples"},"A few examples"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-python"},"# Add license information\nfrom datapackage_pipelines.wrapper import process\n\ndef modify_datapackage(datapackage, parameters, stats):\n    datapackage['license'] = 'CC-BY-SA'\n    return datapackage\n\nprocess(modify_datapackage=modify_datapackage)\n")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-python"},"# Add new column with constant value to first resource\n# Column name and value are taken from the processor's parameters\nfrom datapackage_pipelines.wrapper import process\n\ndef modify_datapackage(datapackage, parameters, stats):\n    datapackage['resources'][0]['schema']['fields'].append({\n      'name': parameters['column-name'],\n      'type': 'string'\n    })\n    return datapackage\n\ndef process_row(row, row_index, resource_descriptor, resource_index, parameters, stats):\n    if resource_index == 0:\n        row[parameters['column-name']] = parameters['value']\n    return row\n\nprocess(modify_datapackage=modify_datapackage,\n        process_row=process_row)\n")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-python"},"# Row counter\nfrom datapackage_pipelines.wrapper import process\n\ndef modify_datapackage(datapackage, parameters, stats):\n    stats['row-count'] = 0\n    return datapackage\n\ndef process_row(row, row_index, resource_descriptor, resource_index, parameters, stats):\n    stats['row-count'] += 1\n    return row\n\nprocess(modify_datapackage=modify_datapackage,\n        process_row=process_row)\n")),Object(i.b)("h3",{id:"low-level-processor-api"},"Low Level Processor API"),Object(i.b)("p",null,"In some cases, the high-level API might be too restricting. In these cases you should consider using the low-level API."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-python"},"from datapackage_pipelines.wrapper import ingest, spew\n\nif __name__ == '__main__':\n  with ingest() as ctx:\n\n    # Initialisation code, if needed\n\n    # Do stuff with datapackage\n    # ...\n\n    stats = {}\n\n    # and resources:\n    def new_resource_iterator(resource_iterator_):\n        def resource_processor(resource_):\n            # resource_.spec is the resource descriptor\n            for row in resource_:\n                # Do something with row\n                # Perhaps collect some stats here as well\n                yield row\n        for resource in resource_iterator_:\n            yield resource_processor(resource)\n\n    spew(ctx.datapackage,\n         new_resource_iterator(ctx.resource_iterator),\n         ctx.stats)\n")),Object(i.b)("p",null,"The above code snippet shows the structure of most low-level processors."),Object(i.b)("p",null,"We always start with calling ",Object(i.b)("inlineCode",{parentName:"p"},"ingest()")," - this method gives us the context, containing the execution parameters, the data-package descriptor (as outputed from the previous step) and an iterator on all streamed resources' rows."),Object(i.b)("p",null,"We finish the processing by calling ",Object(i.b)("inlineCode",{parentName:"p"},"spew()"),", which sends the processed data to the next processor in the pipeline. ",Object(i.b)("inlineCode",{parentName:"p"},"spew")," receives:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"A modified data-package descriptor;"),Object(i.b)("li",{parentName:"ul"},"A (possibly new) iterator on the resources;"),Object(i.b)("li",{parentName:"ul"},"A stats object which will be added to stats from previous steps and returned to the user upon completion of the pipeline, and;"),Object(i.b)("li",{parentName:"ul"},"Optionally, a ",Object(i.b)("inlineCode",{parentName:"li"},"finalizer")," function that will be called after it has finished iterating on the resources, but before signalling to other processors that it's finished. You could use it to close any open files, for example.")),Object(i.b)("h4",{id:"a-more-in-depth-explanation"},"A more in-depth explanation"),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"spew")," writes the data it receives in the following order:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"First, the ",Object(i.b)("inlineCode",{parentName:"li"},"datapackage")," parameter is written to the stream.\nThis means that all modifications to the data-package descriptor must be done ",Object(i.b)("em",{parentName:"li"},"before")," ",Object(i.b)("inlineCode",{parentName:"li"},"spew")," is called.\nOne common pitfall is to modify the data-package descriptor inside the resource iterator - try to avoid that, as the descriptor that the next processor will receive will be wrong."),Object(i.b)("li",{parentName:"ul"},"Then it starts iterating on the resources. For each resource, it iterates on its rows and writes each row to the stream.\nThis iteration process eventually causes an iteration on the original resource iterator (the one that's returned from ",Object(i.b)("inlineCode",{parentName:"li"},"ingest"),'). In turn, this causes the process\' input stream to be read. Because of the way buffering in operating systems work, "slow" processors will read their input slowly, causing the ones before them to sleep on IO while their more CPU intensive counterparts finish their processing. "quick" processors will not work aimlessly, but instead will either sleep while waiting for incoming data or while waiting for their output buffer to drain.\nWhat is achieved here is that all rows in the data are processed more or less at the same time, and that no processor works too "far ahead" on rows that might fail in subsequent processing steps.'),Object(i.b)("li",{parentName:"ul"},"Then the stats are written to the stream. This means that stats can be modified during the iteration, and only the value after the iteration finishes will be used."),Object(i.b)("li",{parentName:"ul"},"Finally, the ",Object(i.b)("inlineCode",{parentName:"li"},"finalizer")," method is called (if we received one).")),Object(i.b)("h4",{id:"a-few-examples-1"},"A few examples"),Object(i.b)("p",null,"We'll start with the same processors from above, now implemented with the low level API."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-python"},"# Add license information\nfrom datapackage_pipelines.wrapper import ingest, spew\n\nif __name__ == '__main__':\n  with ingest() as ctx:\n    ctx.datapackage['license'] = 'MIT'\n    spew(ctx.datapackage, ctx.resource_iterator)\n")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-python"},"# Add new column with constant value to first resource\n# Column name and value are taken from the processor's parameters\nfrom datapackage_pipelines.wrapper import ingest, spew\n\nparameters, datapackage, resource_iterator = ingest()\n\ndatapackage['resources'][0]['schema']['fields'].append({\n   'name': parameters['column-name'],\n   'type': 'string'\n})\n\ndef new_resource_iterator(resource_iterator_):\n    def resource_processor(resource_):\n        for row in resource_:\n            row[parameters['column-name']] = parameters['value']\n            yield row\n\n    first_resource = next(resource_iterator_)\n    yield(resource_processor(first_resource))\n\n    for resource in resource_iterator_:\n        yield resource\n\nspew(datapackage, new_resource_iterator(resource_iterator))\n")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-python"},"# Row counter\nfrom datapackage_pipelines.wrapper import ingest, spew\n\n_, datapackage, resource_iterator = ingest()\n\nstats = {'row-count': 0}\n\ndef new_resource_iterator(resource_iterator_):\n    def resource_processor(resource_):\n        for row in resource_:\n            stats['row-count'] += 1\n            yield row\n\n    for resource in resource_iterator_:\n        yield resource_processor(resource)\n\nspew(datapackage, new_resource_iterator(resource_iterator), stats)\n")),Object(i.b)("p",null,"This next example shows how to implement a simple web scraper. Although not strictly required, web scrapers are usually the first processor in a pipeline. Therefore, they can ignore the incoming data-package and resource iterator, as there's no previous processor generating data:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-python"},"# Web Scraper\nimport requests\nfrom datapackage_pipelines.wrapper import ingest, spew\nfrom datapackage_pipelines.utilities.resources import PROP_STREAMING\n\nparameters, _, _ = ingest()\n\nhost = parameters['ckan-instance']\npackage_list_api = 'https://{host}/api/3/action/package_list'\npackage_show_api = 'https://{host}/api/3/action/package_show'\n\ndef scrape_ckan(host_):\n    all_packages = requests.get(package_list_api.format(host=host_))\\\n                           .json()\\\n                           .get('result', [])\n    for package_id in all_packages:\n      params = dict(id=package_id)\n      package_info = requests.get(package_show_api.format(host=host_),\n                                  params=params)\\\n                             .json()\\\n                             .get('result')\n      if result is not None:\n        yield dict(\n            package_id=package_id,\n            author=package_info.get('author'),\n            title=package_info.get('title'),\n        )\n\ndatapackage = {\n  'resources': [\n    {\n      PROP_STREAMING: True,   # You must set this property for resources being streamed in the pipeline!\n      'name': 'package-list',\n      'schema': {\n        'fields': [\n          {'name': 'package_id', 'type': 'string'},\n          {'name': 'author',     'type': 'string'},\n          {'name': 'title',      'type': 'string'},\n        ]\n      }\n    }\n  ]\n}\n\nspew(datapackage, [scrape_ckan(host)])\n")),Object(i.b)("p",null,"In this example we can see that the initial datapackage is generated from scratch, and the resource iterator is in fact a scraper, yielding rows as they are received from the CKAN instance API."),Object(i.b)("h2",{id:"plugins-and-source-descriptors"},"Plugins and Source Descriptors"),Object(i.b)("p",null,"When writing pipelines in a specific problem domain, one might discover that the processing pipelines that are developed follow a certain pattern. Scraping, or fetching source data tends to be similar to one another. Processing, data cleaning, validation are often the same."),Object(i.b)("p",null,"In order to ease maintenance and avoid boilerplate, a ",Object(i.b)("em",{parentName:"p"},Object(i.b)("inlineCode",{parentName:"em"},"datapackage-pipelines")," ",Object(i.b)("strong",{parentName:"em"},"plugin"))," can be written."),Object(i.b)("p",null,"Plugins are Python modules named ",Object(i.b)("inlineCode",{parentName:"p"},"datapackage_pipelines_<plugin-name>"),". Plugins can provide two facilities:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Processor packs - you can pack processors revolving a certain theme or for a specific purpose in a plugin. Any processor ",Object(i.b)("inlineCode",{parentName:"li"},"foo")," residing under the ",Object(i.b)("inlineCode",{parentName:"li"},"datapackage_pipelines_<plugin-name>.processors")," module can be used from within a pipeline as ",Object(i.b)("inlineCode",{parentName:"li"},"<plugin-name>.foo"),"."),Object(i.b)("li",{parentName:"ul"},"Pipeline templates - if the class ",Object(i.b)("inlineCode",{parentName:"li"},"Generator")," exists in the ",Object(i.b)("inlineCode",{parentName:"li"},"datapackage_pipelines_<plugin-name>"),' module, it will be used to generate pipeline based on templates - which we call "source descriptors".')),Object(i.b)("h3",{id:"source-descriptors"},"Source Descriptors"),Object(i.b)("p",null,"A source descriptor is a yaml file containing information which is used to create a full pipeline."),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"dpp")," will look for files named ",Object(i.b)("inlineCode",{parentName:"p"},"<plugin-name>.source-spec.yaml")," , and will treat them as input for the pipeline generating code - which should be implemented in a class called ",Object(i.b)("inlineCode",{parentName:"p"},"Generator")," in the ",Object(i.b)("inlineCode",{parentName:"p"},"datapackage_pipelines_<plugin-name>")," module."),Object(i.b)("p",null,"This class should inherit from ",Object(i.b)("inlineCode",{parentName:"p"},"GeneratorBase")," and should implement two methods:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"generate_pipeline")," -\nwhich receives the source description and returns an iterator of tuples of the form ",Object(i.b)("inlineCode",{parentName:"li"},"(id, details)"),".\n",Object(i.b)("inlineCode",{parentName:"li"},"id")," might be a pipeline id, in which case details would be an object containing the pipeline definition.\nIf ",Object(i.b)("inlineCode",{parentName:"li"},"id")," is of the form ",Object(i.b)("inlineCode",{parentName:"li"},":module:"),", then the details are treated as a source spec from the specified module. This way a generator might generate other source specs."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"get_schema")," - which should return a JSON Schema for validating the source description's structure")),Object(i.b)("h4",{id:"example"},"Example"),Object(i.b)("p",null,"Let's assume we write a ",Object(i.b)("inlineCode",{parentName:"p"},"datapackage_pipelines_ckan")," plugin, used to pull data out of ",Object(i.b)("a",{parentName:"p",href:"https://ckan.org"},"CKAN")," instances."),Object(i.b)("p",null,"Here's how such a hypothetical generator would look like:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-python"},"import os\nimport json\n\nfrom datapackage_pipelines.generators import \\\n    GeneratorBase, slugify, steps, SCHEDULE_MONTHLY\n\nSCHEMA_FILE = os.path.join(os.path.dirname(__file__), 'schema.json')\n\n\nclass Generator(GeneratorBase):\n\n    @classmethod\n    def get_schema(cls):\n        return json.load(open(SCHEMA_FILE))\n\n    @classmethod\n    def generate_pipeline(cls, source):\n        pipeline_id = dataset_name = slugify(source['name'])\n        host = source['ckan-instance']\n        action = source['data-kind']\n\n        if action == 'package-list':\n            schedule = SCHEDULE_MONTHLY\n            pipeline_steps = steps(*[\n                ('ckan.scraper', {\n                   'ckan-instance': host\n                }),\n                ('metadata', {\n                  'name': dataset_name\n                }),\n                ('dump_to_zip', {\n                   'out-file': 'ckan-datapackage.zip'\n                })])\n            pipeline_details = {\n                'pipeline': pipeline_steps,\n                'schedule': {'crontab': schedule}\n            }\n            yield pipeline_id, pipeline_details\n")),Object(i.b)("p",null,"In this case, if we store a ",Object(i.b)("inlineCode",{parentName:"p"},"ckan.source-spec.yaml")," file looking like this:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-yaml"},"ckan-instance: example.com\nname: example-com-list-of-packages\ndata-kind: package-list\n")),Object(i.b)("p",null,"Then when running ",Object(i.b)("inlineCode",{parentName:"p"},"dpp")," we will see an available pipeline named ",Object(i.b)("inlineCode",{parentName:"p"},"./example-com-list-of-packages")),Object(i.b)("p",null,"This pipeline would internally be composed of 3 steps: ",Object(i.b)("inlineCode",{parentName:"p"},"ckan.scraper"),", ",Object(i.b)("inlineCode",{parentName:"p"},"metadata")," and ",Object(i.b)("inlineCode",{parentName:"p"},"dump_to_zip"),"."),Object(i.b)("h4",{id:"validating-source-descriptors"},"Validating Source Descriptors"),Object(i.b)("p",null,"Source descriptors can have any structure that best matches the parameter domain of the output pipelines. However, it must have a consistent structure, backed by a JSON Schema file. In our case, the Schema might look like this:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-json"},'{\n  "$schema": "http://json-schema.org/draft-04/schema#",\n  "type": "object",\n  "properties": {\n    "name":          { "type": "string" },\n    "ckan-instance": { "type": "string" },\n    "data-kind":     { "type": "string" }\n  },\n  "required": [ "name", "ckan-instance", "data-kind" ]\n}\n')),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"dpp")," will ensure that source descriptor files conform to that schema before attempting to convert them into pipelines using the ",Object(i.b)("inlineCode",{parentName:"p"},"Generator")," class."),Object(i.b)("h4",{id:"providing-processor-code"},"Providing Processor Code"),Object(i.b)("p",null,"In some cases, a generator would prefer to provide the processor code as well (alongside the pipeline definition).\nIn order to to that, the generator can add a ",Object(i.b)("inlineCode",{parentName:"p"},"code")," attribute to any step containing the processor's code. When executed, this step won't try to resolve the processor as usual but will the provided code instead."),Object(i.b)("h2",{id:"running-on-a-schedule"},"Running on a schedule"),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"datapackage-pipelines")," comes with a celery integration, allowing for pipelines to be run at specific times via a ",Object(i.b)("inlineCode",{parentName:"p"},"crontab")," like syntax."),Object(i.b)("p",null,"In order to enable that, you simply add a ",Object(i.b)("inlineCode",{parentName:"p"},"schedule")," section to your ",Object(i.b)("inlineCode",{parentName:"p"},"pipeline-spec.yaml")," file (or return a schedule from the generator class, see above), like so:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-yaml"},"co2-information-cdiac:\n  pipeline:\n    -\n        ...\n  schedule:\n    # minute hour day_of_week day_of_month month_of_year\n    crontab: '0 * * * *'\n")),Object(i.b)("p",null,"In this example, this pipeline is set to run every hour, on the hour."),Object(i.b)("p",null,"To run the celery daemon, use ",Object(i.b)("inlineCode",{parentName:"p"},"celery"),"'s command line interface to run ",Object(i.b)("inlineCode",{parentName:"p"},"datapackage_pipelines.app"),". Here's one way to do it:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell"},"$ python -m celery worker -B -A datapackage_pipelines.app\n")),Object(i.b)("p",null,'Running this server will start by executing all "dirty" tasks, and continue by executing tasks based on their schedules.'),Object(i.b)("p",null,"As a shortcut for starting the scheduler and the dashboard (see below), you can use a prebuilt ",Object(i.b)("em",{parentName:"p"},"Docker")," image:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"$ docker run -v `pwd`:/pipelines:rw -p 5000:5000 \\\n        frictionlessdata/datapackage-pipelines server\n")),Object(i.b)("p",null,"And then browse to ",Object(i.b)("inlineCode",{parentName:"p"},"http://<docker machine's IP address>:5000/")," to see the current execution status dashboard."),Object(i.b)("h2",{id:"pipeline-dashboard--status-badges"},"Pipeline Dashboard & Status Badges"),Object(i.b)("p",null,"When installed on a server or running using the task scheduler, it's often very hard to know exactly what's running and what the status is of each pipeline."),Object(i.b)("p",null,"To make things easier, you can spin up the web dashboard to provide an overview of each pipeline's status, its basic info and the result of it latest execution."),Object(i.b)("p",null,"To start the web server run ",Object(i.b)("inlineCode",{parentName:"p"},"dpp serve")," from the command line and browse to http://localhost:5000"),Object(i.b)("p",null,"The environment variable ",Object(i.b)("inlineCode",{parentName:"p"},"DPP_BASE_PATH")," will determine whether dashboard will be served from root or from another base path (example value: ",Object(i.b)("inlineCode",{parentName:"p"},"/pipelines/"),")."),Object(i.b)("p",null,"The dashboard endpoints can be made to require authentication by adding a username and password with the environment variables ",Object(i.b)("inlineCode",{parentName:"p"},"DPP_BASIC_AUTH_USERNAME")," and ",Object(i.b)("inlineCode",{parentName:"p"},"DPP_BASIC_AUTH_PASSWORD"),"."),Object(i.b)("p",null,"Even simpler pipeline status is available with a status badge, both for individual pipelines, and for pipeline collections. For a single pipeline, add the full pipeline id to the badge endpoint:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"http://localhost:5000/badge/path_to/pipelines/my-pipeline-id\n")),Object(i.b)("p",null,Object(i.b)("img",{parentName:"p",src:"https://img.shields.io/badge/pipeline-succeeded%20(30756%20records)-brightgreen.svg",alt:null})),Object(i.b)("p",null,Object(i.b)("img",{parentName:"p",src:"https://img.shields.io/badge/pipeline-invalid-lightgrey.svg",alt:null})),Object(i.b)("p",null,Object(i.b)("img",{parentName:"p",src:"https://img.shields.io/badge/pipeline-failed-red.svg",alt:null})),Object(i.b)("p",null,Object(i.b)("img",{parentName:"p",src:"https://img.shields.io/badge/pipeline-not%20found-lightgray.svg",alt:null})),Object(i.b)("p",null,"Or for a collection of pipelines:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"http://localhost:5000/badge/collection/path_to/pipelines/\n")),Object(i.b)("p",null,Object(i.b)("img",{parentName:"p",src:"https://img.shields.io/badge/pipelines-22%20succeeded-brightgreen.svg",alt:null})),Object(i.b)("p",null,Object(i.b)("img",{parentName:"p",src:"https://img.shields.io/badge/pipelines-4%20running%2C%20%201%20succeeded%2C%205%20queued-yellow.svg",alt:null})),Object(i.b)("p",null,Object(i.b)("img",{parentName:"p",src:"https://img.shields.io/badge/pipelines-11%20succeeded%2C%207%20failed%2C%201%20invalid-red.svg",alt:null})),Object(i.b)("p",null,Object(i.b)("img",{parentName:"p",src:"https://img.shields.io/badge/pipelines-not%20found-lightgray.svg",alt:null})),Object(i.b)("p",null,"Note that these badge endpoints will always be exposed regardless of ",Object(i.b)("inlineCode",{parentName:"p"},"DPP_BASIC_AUTH_PASSWORD")," and ",Object(i.b)("inlineCode",{parentName:"p"},"DPP_BASIC_AUTH_USERNAME")," settings."),Object(i.b)("h2",{id:"integrating-with-other-services"},"Integrating with other services"),Object(i.b)("p",null,"Datapackage-pipelines can call a predefined webhook on any pipeline event. This might allow for potential integrations with other applications."),Object(i.b)("p",null,"In order to add a webhook in a specific pipeline, add a ",Object(i.b)("inlineCode",{parentName:"p"},"hooks")," property in the pipeline definition, which should be a list of URLs.\nWhenever that pipeline is queued, starts running or finishes running, all the urls will be POSTed with this payload:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-json"},'{\n  "pipeline": "<pipeline-id>",\n  "event": "queue/start/progress/finish",\n  "success": true/false (when applicable),\n  "errors": [list-of-errors, when applicable]\n}\n')),Object(i.b)("h2",{id:"known-issues"},"Known Issues"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"loading a resource which has a lot of data in a single cell raises an exception (",Object(i.b)("a",{parentName:"li",href:"https://github.com/frictionlessdata/datapackage-pipelines/pull/112#issue-160766294"},"#112"),")")))}b.isMDXComponent=!0},112:function(e,t,a){"use strict";a.d(t,"a",(function(){return b})),a.d(t,"b",(function(){return u}));var n=a(0),r=a.n(n);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function p(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var c=r.a.createContext({}),s=function(e){var t=r.a.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},b=function(e){var t=s(e.components);return r.a.createElement(c.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},m=r.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,i=e.originalType,l=e.parentName,c=p(e,["components","mdxType","originalType","parentName"]),b=s(a),m=n,u=b["".concat(l,".").concat(m)]||b[m]||d[m]||i;return a?r.a.createElement(u,o(o({ref:t},c),{},{components:a})):r.a.createElement(u,o({ref:t},c))}));function u(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=a.length,l=new Array(i);l[0]=m;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o.mdxType="string"==typeof e?e:n,l[1]=o;for(var c=2;c<i;c++)l[c]=a[c];return r.a.createElement.apply(null,l)}return r.a.createElement.apply(null,a)}m.displayName="MDXCreateElement"}}]);