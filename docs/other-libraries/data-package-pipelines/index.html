<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.72">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Frictionless Libraries Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Frictionless Libraries Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WY2G1YK3M9"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-WY2G1YK3M9",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Frictionless Libraries" href="/opensearch.xml"><title data-react-helmet="true">datapackage-pipelines | Frictionless Libraries</title><meta data-react-helmet="true" property="og:image" content="https://libraries.frictionlessdata.io/img/docusaurus.png"><meta data-react-helmet="true" name="twitter:image" content="https://libraries.frictionlessdata.io/img/docusaurus.png"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://libraries.frictionlessdata.io/docs/other-libraries/data-package-pipelines"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="datapackage-pipelines | Frictionless Libraries"><meta data-react-helmet="true" name="description" content="Travis"><meta data-react-helmet="true" property="og:description" content="Travis"><link data-react-helmet="true" rel="shortcut icon" href="/img/logo.png"><link data-react-helmet="true" rel="canonical" href="https://libraries.frictionlessdata.io/docs/other-libraries/data-package-pipelines"><link data-react-helmet="true" rel="alternate" href="https://libraries.frictionlessdata.io/docs/other-libraries/data-package-pipelines" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://libraries.frictionlessdata.io/docs/other-libraries/data-package-pipelines" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.0796f5ba.css">
<link rel="preload" href="/assets/js/styles.983af374.js" as="script">
<link rel="preload" href="/assets/js/runtime~main.e908f028.js" as="script">
<link rel="preload" href="/assets/js/main.3ba2a6ed.js" as="script">
<link rel="preload" href="/assets/js/1.3c60d086.js" as="script">
<link rel="preload" href="/assets/js/2.5d9923d7.js" as="script">
<link rel="preload" href="/assets/js/36.2003ba02.js" as="script">
<link rel="preload" href="/assets/js/935f2afb.e2d480c1.js" as="script">
<link rel="preload" href="/assets/js/17896441.059d815c.js" as="script">
<link rel="preload" href="/assets/js/ceb5abcf.3d03dab8.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_2qcr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Frictionless Libraries Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="Frictionless Libraries Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Frictionless Libraries</strong></a><a class="navbar__item navbar__link" href="/docs/table-schema/python">Table Schema</a><a class="navbar__item navbar__link" href="/docs/data-package/python">Data Package</a><a class="navbar__item navbar__link" href="/docs/other-libraries/frictionless-ckan-mapper">Other Libraries</a><a class="navbar__item navbar__link" href="/docs/status">Status</a></div><div class="navbar__items navbar__items--right"><a href="https://frictionlessdata.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-mainsite-link">Back to the main site</a><a href="https://github.com/frictionlessdata/libraries" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_GrZ2"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Frictionless Libraries Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="Frictionless Libraries Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Frictionless Libraries</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/table-schema/python">Table Schema</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/data-package/python">Data Package</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/other-libraries/frictionless-ckan-mapper">Other Libraries</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/status">Status</a></li><li class="menu__list-item"><a href="https://frictionlessdata.io/" target="_blank" rel="noopener noreferrer" class="menu__link header-mainsite-link">Back to the main site</a></li><li class="menu__list-item"><a href="https://github.com/frictionlessdata/libraries" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link" aria-label="GitHub repository"></a></li></ul></div></div></div></nav><div class="main-wrapper main-docs-wrapper"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo sidebarWithHideableNavbar_267A"><a tabindex="-1" class="sidebarLogo_3h0W" href="/"><img src="/img/logo.png" alt="Frictionless Libraries Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo.png" alt="Frictionless Libraries Logo" class="themedImage_1VuW themedImage--dark_hz6m"><strong>Frictionless Libraries</strong></a><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/other-libraries/frictionless-ckan-mapper">frictionless-ckan-mapper</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" href="/docs/other-libraries/data-package-pipelines">datapackage-pipelines</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/other-libraries/data-package-render">datapackage-render-js</a></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">datapackage-pipelines</h1></header><div class="markdown"><p><a href="https://travis-ci.org/frictionlessdata/datapackage-pipelines" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/travis/frictionlessdata/datapackage-pipelines/master.svg" alt="Travis"></a>
<a href="https://coveralls.io/r/frictionlessdata/datapackage-pipelines?branch=master" target="_blank" rel="noopener noreferrer"><img src="http://img.shields.io/coveralls/frictionlessdata/datapackage-pipelines.svg?branch=master" alt="Coveralls"></a>
<img src="https://img.shields.io/pypi/pyversions/datapackage-pipelines.svg" alt="PyPI - Python Version"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="the-basics"></a>The Basics<a class="hash-link" href="#the-basics" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="what-is-it"></a>What is it?<a class="hash-link" href="#what-is-it" title="Direct link to heading">#</a></h3><p><code>datapackage-pipelines</code> is a framework for declarative stream-processing of tabular data. It is built upon the concepts and tooling of the Frictionless Data project.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="pipelines"></a>Pipelines<a class="hash-link" href="#pipelines" title="Direct link to heading">#</a></h3><p>The basic concept in this framework is the pipeline.</p><p>A pipeline has a list of processing steps, and it generates a single <em>data package</em> as its output. Each step is executed in a <em>processor</em> and consists of the following stages:</p><ul><li><strong>Modify the data package descriptor</strong> - For example: add metadata, add or remove resources, change resources&#x27; data schema etc.</li><li><strong>Process resources</strong> - Each row of each resource is processed sequentially. The processor can drop rows, add new ones or modify their contents.</li><li><strong>Return stats</strong> - If necessary, the processor can report a dictionary of data which will be returned to the user when the pipeline execution terminates. This can be used, for example, for calculating quality measures for the processed data.</li></ul><p>Not every processor needs to do all of these. In fact, you would often find each processing step doing only one of these.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="pipeline-specyaml-file"></a><code>pipeline-spec.yaml</code> file<a class="hash-link" href="#pipeline-specyaml-file" title="Direct link to heading">#</a></h3><p>Pipelines are defined in a declarative way, and not in code. One or more pipelines can be defined in a <code>pipeline-spec.yaml</code> file. This file specifies the list of processors (referenced by name) and the execution parameters for each of the processors.</p><p>Here&#x27;s an example of a <code>pipeline-spec.yaml</code> file:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">worldbank-co2-emissions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">title</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> CO2 emission data from the World Bank</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">description</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Data per year</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> provided in metric tons per capita.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">DEBUG</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">pipeline</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> update_package</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;co2-emissions&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">title</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;CO2 emissions (metric tons per capita)&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">homepage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;http://worldbank.org/&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> load</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">from</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;http://api.worldbank.org/v2/en/indicator/EN.ATM.CO2E.PC?downloadformat=excel&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;global-data&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">format</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> xls</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">headers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> set_types</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> global</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span></div><div class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token key atrule" style="color:#00a4db">types</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token key atrule" style="color:#00a4db">&quot;[12][0-9]{3}&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> number</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> dump_to_zip</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">out-file</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> co2</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">emissions</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">wb.zip</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>In this example we see one pipeline called <code>worldbank-co2-emissions</code>. Its pipeline consists of 4 steps:</p><ul><li><code>update_package</code>: This is a library processor  (see below), which modifies the data-package&#x27;s descriptor (in our case: the initial, empty descriptor) - adding <code>name</code>, <code>title</code> and other properties to the datapackage.</li><li><code>load</code>: This is another library processor, which loads data into the data-package.
This resource has a <code>name</code> and a <code>from</code> property, pointing to the remote location of the data.</li><li><code>set_types</code>: This processor assigns data types to fields in the data. In this example, field headers looking like years will be assigned the <code>number</code> type.</li><li><code>dump_to_zip</code>: Create a zipped and validated datapackage with the provided file name.</li></ul><p>Also, we have provided some metadata:</p><ul><li><code>title</code>: Title of a pipeline</li><li><code>description</code>: Description of a pipeline</li><li><code>environment</code>: Dictionary of environment variables to be set for all the pipeline&#x27;s steps. For examples, it can be used to change the behaviour of the underlaying <code>requests</code> library - <a href="https://requests.readthedocs.io/en/master/user/advanced/#ssl-cert-verification" target="_blank" rel="noopener noreferrer">https://requests.readthedocs.io/en/master/user/advanced/#ssl-cert-verification</a></li></ul><blockquote><p>Full JSONSchema of the <code>pipeline-spec.yaml</code> file can be found <a href="https://github.com/frictionlessdata/datapackage-pipelines/blob/master/datapackage_pipelines/specs/schemas/pipeline-spec.schema.json" target="_blank" rel="noopener noreferrer">here</a></p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="mechanics"></a>Mechanics<a class="hash-link" href="#mechanics" title="Direct link to heading">#</a></h3><p>An important aspect of how the pipelines are run is the fact that data is passed in streams from one processor to another. If we get &quot;technical&quot; here, then each processor is run in its own dedicated process, where the datapackage is read from its <code>stdin</code> and output to its <code>stdout</code>. The important thing to note here is that no processor holds the entire data set at any point.</p><p>This limitation is by design - to keep the memory and disk requirements of each processor limited and independent of the dataset size.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="quick-start"></a>Quick Start<a class="hash-link" href="#quick-start" title="Direct link to heading">#</a></h3><p>First off, create a <code>pipeline-spec.yaml</code> file in your current directory. You can take the above file if you just want to try it out.</p><p>Then, you can either install <code>datapackage-pipelines</code> locally - note that <em>Python 3.6</em> or higher is required due to use of <a href="https://www.python.org/dev/peps/pep-0484/" target="_blank" rel="noopener noreferrer">Type Hinting</a> and advanced <code>asyncio</code> use:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">$ pip </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> datapackage-pipelines</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>You should now be able to use the <code>dpp</code> command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">$ dpp</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Available Pipelines:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">- ./worldbank-co2-emissions </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">$ $ dpp run --verbose ./worldbank-co2-emissions</span></div><div class="token-line" style="color:#393A34"><span class="token plain">RUNNING ./worldbank-co2-emissions</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Collecting dependencies</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Running async task</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Waiting </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> completion</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Async task starting</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Searching </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> existing caches</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Building process chain:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">- update_package</span></div><div class="token-line" style="color:#393A34"><span class="token plain">- load</span></div><div class="token-line" style="color:#393A34"><span class="token plain">- set_types</span></div><div class="token-line" style="color:#393A34"><span class="token plain">- dump_to_zip</span></div><div class="token-line" style="color:#393A34"><span class="token plain">- </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sink</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">DONE /Users/adam/code/dhq/specstore/dpp_repo/datapackage_pipelines/specs/</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/lib/update_package.py</span></div><div class="token-line" style="color:#393A34"><span class="token plain">load: DEBUG   :Starting new HTTP connection </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">: api.worldbank.org:80</span></div><div class="token-line" style="color:#393A34"><span class="token plain">load: DEBUG   :http://api.worldbank.org:80 </span><span class="token string" style="color:#e3116c">&quot;GET /v2/en/indicator/EN.ATM.CO2E.PC?downloadformat=excel HTTP/1.1&quot;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">308736</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">load: DEBUG   :http://api.worldbank.org:80 </span><span class="token string" style="color:#e3116c">&quot;GET /v2/en/indicator/EN.ATM.CO2E.PC?downloadformat=excel HTTP/1.1&quot;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">308736</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">load: DEBUG   :Starting new HTTP connection </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">: api.worldbank.org:80</span></div><div class="token-line" style="color:#393A34"><span class="token plain">load: DEBUG   :http://api.worldbank.org:80 </span><span class="token string" style="color:#e3116c">&quot;GET /v2/en/indicator/EN.ATM.CO2E.PC?downloadformat=excel HTTP/1.1&quot;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">308736</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">load: DEBUG   :http://api.worldbank.org:80 </span><span class="token string" style="color:#e3116c">&quot;GET /v2/en/indicator/EN.ATM.CO2E.PC?downloadformat=excel HTTP/1.1&quot;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">308736</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">set_types: INFO    :</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">dataflows.processors.set_type.set_type object at 0x10a5c79b</span><span class="token operator file-descriptor important" style="color:#393A34">0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">,</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">load: INFO    :Processed </span><span class="token number" style="color:#36acaa">264</span><span class="token plain"> rows</span></div><div class="token-line" style="color:#393A34"><span class="token plain">set_types: INFO    :Processed </span><span class="token number" style="color:#36acaa">264</span><span class="token plain"> rows</span></div><div class="token-line" style="color:#393A34"><span class="token plain">DONE /Users/adam/code/dhq/specstore/dpp_repo/datapackage_pipelines/specs/</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/lib/load.py</span></div><div class="token-line" style="color:#393A34"><span class="token plain">DONE /Users/adam/code/dhq/specstore/dpp_repo/datapackage_pipelines/specs/</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/lib/set_types.py</span></div><div class="token-line" style="color:#393A34"><span class="token plain">dump_to_zip: INFO    :Processed </span><span class="token number" style="color:#36acaa">264</span><span class="token plain"> rows</span></div><div class="token-line" style="color:#393A34"><span class="token plain">DONE /Users/adam/code/dhq/specstore/dpp_repo/datapackage_pipelines/manager/</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/lib/internal/sink.py</span></div><div class="token-line" style="color:#393A34"><span class="token plain">DONE /Users/adam/code/dhq/specstore/dpp_repo/datapackage_pipelines/specs/</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/lib/dump_to_zip.py</span></div><div class="token-line" style="color:#393A34"><span class="token plain">DONE V ./worldbank-co2-emissions </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&#x27;bytes&#x27;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">692741</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&#x27;count_of_rows&#x27;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">264</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&#x27;dataset_name&#x27;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;co2-emissions&#x27;</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&#x27;hash&#x27;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;4dd18effcdfbf5fc267221b4ffc28fa4&#x27;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">INFO    :RESULTS:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">INFO    :SUCCESS: ./worldbank-co2-emissions </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&#x27;bytes&#x27;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">692741</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&#x27;count_of_rows&#x27;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">264</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&#x27;dataset_name&#x27;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;co2-emissions&#x27;</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&#x27;hash&#x27;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;4dd18effcdfbf5fc267221b4ffc28fa4&#x27;</span><span class="token punctuation" style="color:#393A34">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Alternatively, you could use our <a href="https://www.docker.com/" target="_blank" rel="noopener noreferrer">Docker</a> image:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">$ docker run -it -v </span><span class="token variable" style="color:#36acaa">`</span><span class="token variable builtin class-name" style="color:#36acaa">pwd</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain">:/pipelines:rw </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        frictionlessdata/datapackage-pipelines</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">available-pipelines</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">$ docker run -it -v </span><span class="token variable" style="color:#36acaa">`</span><span class="token variable builtin class-name" style="color:#36acaa">pwd</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain">:/pipelines:rw </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">       frictionlessdata/datapackage-pipelines run ./worldbank-co2-emissions</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">execution-logs</span><span class="token operator" style="color:#393A34">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="the-command-line-interface---dpp"></a>The Command Line Interface - <code>dpp</code><a class="hash-link" href="#the-command-line-interface---dpp" title="Direct link to heading">#</a></h3><p>Running a pipeline from the command line is done using the <code>dpp</code> tool.</p><p>Running <code>dpp</code> without any argument, will show the list of available pipelines. This is done by scanning the current directory and its subdirectories, searching for <code>pipeline-spec.yaml</code> files and extracting the list of pipeline specifications described within.</p><p>Each pipeline has an identifier, composed of the path to the <code>pipeline-spec.yaml</code> file and the name of the pipeline, as defined within that description file.</p><p>In order to run a pipeline, you use <code>dpp run &lt;pipeline-id&gt;</code>.</p><p>You can also use <code>dpp run all</code> for running all pipelines and <code>dpp run dirty</code> to run the just the <em>dirty</em> pipelines (more on that later on).</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="deeper-look-into-pipelines"></a>Deeper look into pipelines<a class="hash-link" href="#deeper-look-into-pipelines" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="processor-resolution"></a>Processor Resolution<a class="hash-link" href="#processor-resolution" title="Direct link to heading">#</a></h3><p>As previously seen, processors are referenced by name.</p><p>This name is, in fact, the name of a Python script containing the processing code (minus the <code>.py</code> extension). When trying to find where is the actual code that needs to be executed, the processor resolver will search in these predefined locations:</p><ul><li>First of all, it will try to find a custom processor with that name in the directory of the <code>pipeline-spec.yaml</code> file.
Processor names support the dot notation, so you could write <code>mycode.custom_processor</code> and it will try to find a processor named <code>custom_processor.py</code> in the <code>mycode</code> directory, in the same path as the pipeline spec file.
For this specific resolving phase, if you would write <code>..custom_processor</code> it will try to find that processor in the parent directory of the pipeline spec file.
(read on for instructions on how to write custom processors)</li><li>In case the processor name looks like <code>myplugin.somename</code>, it will try to find a processor named <code>somename</code> in the <code>myplugin</code> plugin. That is - it will see if there&#x27;s an installed plugin which is called <code>myplugin</code>, and if so, whether that plugin publishes a processor called <code>somename</code> (more on plugins below).</li><li>If no processor was found until this point, it will try to search for this processor in the processor search path. The processor search path is taken from the environment variable <code>DPP_PROCESSOR_PATH</code>. Each of the <code>:</code> separated paths in the path is considered as a possible starting point for resolving the processor.</li><li>Finally, it will try to find that processor in the Standard Processor Library which is bundled with this package.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="excluding-directories-form-scanning-for-pipeline-specs"></a>Excluding directories form scanning for pipeline specs<a class="hash-link" href="#excluding-directories-form-scanning-for-pipeline-specs" title="Direct link to heading">#</a></h3><p>By default <code>.*</code> directories are excluded from scanning, you can add additional directory patterns for
exclusion by creating a <code>.dpp_spec_ignore</code> file at the project root. This file has similar syntax
to .gitignore and will exclude directories from scanning based on glob pattern matching.</p><p>For example, the following file will ignore <code>test*</code> directories including inside subdirectories
and <code>/docs</code> directory will only be ignored at the project root directory</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">test*</span></div><div class="token-line" style="color:#393A34"><span class="token plain">/docs</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="caching"></a>Caching<a class="hash-link" href="#caching" title="Direct link to heading">#</a></h3><p>By setting the <code>cached</code> property on a specific pipeline step to <code>True</code>, this step&#x27;s output will be stored on disk (in the <code>.cache</code> directory, in the same location as the <code>pipeline-spec.yaml</code> file).</p><p>Rerunning the pipeline will make use of that cache, thus avoiding the execution of the cached step and its precursors.</p><p>Internally, a hash is calculated for each step in the pipeline - which is based on the processor&#x27;s code, it parameters and the hash of its predecessor. If a cache file exists with exactly the same hash as a specific step, then we can remove it (and its predecessors) and use that cache file as an input to the pipeline</p><p>This way, the cache becomes invalid in case the code or execution parameters changed (either for the cached processor or in any of the preceding processors).</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="dirty-tasks-and-keeping-state"></a>Dirty tasks and keeping state<a class="hash-link" href="#dirty-tasks-and-keeping-state" title="Direct link to heading">#</a></h3><p>The cache hash is also used for seeing if a pipeline is &quot;dirty&quot;. When a pipeline completes executing successfully, <code>dpp</code> stores the cache hash along with the pipeline id. If the stored hash is different than the currently calculated hash, it means that either the code or the execution parameters were modified, and that the pipeline needs to be re-run.</p><p><code>dpp</code> works with two storage backends. For running locally, it uses a python <em>sqlite DB</em> to store the current state of each running task, including the last result and cache hash. The state DB file is stored in a file named <code>.dpp.db</code> in the same directory that <code>dpp</code> is being run from.</p><p>For other installations, especially ones using the task scheduler, it is recommended to work with the <em>Redis</em> backend. In order to enable the Redis connection, simply set the <code>DPP_REDIS_HOST</code> environment variable to point to a running Redis instance.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="pipeline-dependencies"></a>Pipeline Dependencies<a class="hash-link" href="#pipeline-dependencies" title="Direct link to heading">#</a></h3><p>You can declare that a pipeline is dependent on another pipeline or datapackage. This dependency is considered when calculating the cache hashes of a pipeline, which in turn affect the validity of cache files and the &quot;dirty&quot; state:</p><ul><li>For pipeline dependencies, the hash of that pipeline is used in the calculation</li><li>For datapackage dependencies, the <code>hash</code> property in the datapackage is used in the calculation</li></ul><p>If the dependency is missing, then the pipeline is marked as &#x27;unable to be executed&#x27;.</p><p>Declaring dependencies is done by a <code>dependencies</code> property to a pipeline definition in the <code>pipeline-spec.yaml</code> file.
This property should contain a list of dependencies, each one is an object with the following formats:</p><ul><li>A single key named <code>pipeline</code> whose value is the pipeline id to depend on</li><li>A single key named <code>datapackage</code> whose value is the identifier (or URL) for the datapackage to depend on</li></ul><p>Example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">cat-vs-dog-populations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">dependencies</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">pipeline</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ./geo/region</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">areal</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">datapackage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//pets.net/data/dogs</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">per</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">region/datapackage.json</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">datapackage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//pets.net/data/dogs</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">per</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">region</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="validating"></a>Validating<a class="hash-link" href="#validating" title="Direct link to heading">#</a></h3><p>Each processor&#x27;s input is automatically validated for correctness:</p><ul><li><p>The datapackage is always validated before being passed to a processor, so there&#x27;s no possibility for a processor to modify a datapackage in a way that renders it invalid.</p></li><li><p>Data is not validated against its respective JSON Table Schema, unless explicitly requested by setting the <code>validate</code> flag to True in the step&#x27;s info.
This is done for two main reasons:</p><ul><li>Performance wise, validating the data in every step is very CPU intensive</li><li>In some cases you modify the schema in one step and the data in another, so you would only like to validate the data once all the changes were made</li></ul><p>In any case, when using the <code>set_types</code> standard processor, it will validate and transform the input data with the new types..</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="dataflows-integration"></a>Dataflows integration<a class="hash-link" href="#dataflows-integration" title="Direct link to heading">#</a></h3><p><a href="https://github.com/datahq/dataflows" target="_blank" rel="noopener noreferrer">Dataflows</a> is the successor of datapackage-pipelines and provides a more
Pythonic interface to running pipelines. You can integrate dataflows within pipeline specs using the <code>flow</code> attribute
instead of <code>run</code>. For example, given the following flow file, saved under <code>my-flow.py</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">from dataflows import Flow, dump_to_path, load, update_package</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">def flow(parameters, datapackage, resources, stats):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    stats[&#x27;multiplied_fields&#x27;] = 0</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    def multiply(field, n):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        def step(row):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            row[field] = row[field] * n</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            stats[&#x27;multiplied_fields&#x27;] += 1</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        return step</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return Flow(update_package(name=&#x27;my-datapackage&#x27;),</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                multiply(&#x27;my-field&#x27;, 2))</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>And a <code>pipeline-spec.yaml</code> in the same directory:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">my-flow:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  pipeline:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  - run: load_resource</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    parameters:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      url: http://example.com/my-datapackage/datapackage.json</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      resource: my-resource</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  - flow: my-flow</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  - run: dump_to_path</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>You can run the pipeline using <code>dpp run my-flow</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="the-standard-processor-library"></a>The Standard Processor Library<a class="hash-link" href="#the-standard-processor-library" title="Direct link to heading">#</a></h2><p>A few built in processors are provided with the library.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="update_package"></a><strong><em><code>update_package</code></em></strong><a class="hash-link" href="#update_package" title="Direct link to heading">#</a></h3><p>Adds meta-data to the data-package.</p><p><em>Parameters</em>:</p><p>Any allowed property (according to the <a href="/docs/other-libraries/[http://specs.frictionlessdata.io/data-packages/#metadata">spec</a>) can be provided here.</p><p><em>Example</em>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> update_package</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> routes</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">to</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">mordor</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">license</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> CC</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">BY</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">SA</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">author</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Frodo Baggins &lt;frodo@shire.me</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">contributors</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> samwise gamgee &lt;samwise1992@yahoo.com</span><span class="token punctuation" style="color:#393A34">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="update_resource"></a><strong><em><code>update_resource</code></em></strong><a class="hash-link" href="#update_resource" title="Direct link to heading">#</a></h3><p>Adds meta-data to the resource.</p><p><em>Parameters</em>:</p><ul><li><code>resources</code><ul><li>A name of a resource to operate on</li><li>A regular expression matching resource names</li><li>A list of resource names</li><li>The index of the resource in the package</li><li>if omitted indicates operation should be done on all resources</li></ul></li><li><code>metadata</code> - A dictionary containing any allowed property (according to the <a href="/docs/other-libraries/[https://frictionlessdata.io/specs/data-resource/#metadata">spec</a>).</li></ul><p><em>Example</em>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> update_resource</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;resource1&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;new-path.csv&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="load"></a><strong><em><code>load</code></em></strong><a class="hash-link" href="#load" title="Direct link to heading">#</a></h3><p>Loads data into the package, infers the schema and optionally casts values.</p><p><em>Parameters</em>:</p><ul><li><code>from</code> - location of the data that is to be loaded. This can be either:<ul><li>a local path (e.g. /path/to/the/data.csv)</li><li>a remote URL (e.g. <a href="https://path.to/the/data.csv" target="_blank" rel="noopener noreferrer">https://path.to/the/data.csv</a>)</li><li>Other supported links, based on the current support of schemes and formats in <a href="https://github.com/frictionlessdata/tabulator-py#schemes" target="_blank" rel="noopener noreferrer">tabulator</a></li><li>a local path or remote URL to a datapackage.json file (e.g. <a href="https://path.to/data_package/datapackage.json" target="_blank" rel="noopener noreferrer">https://path.to/data_package/datapackage.json</a>)</li><li>a reference to an environment variable containing the source location, in the form of <code>env://ENV_VAR</code></li><li>a tuple containing (datapackage_descriptor, resources_iterator)</li></ul></li><li><code>resources</code> - optional, relevant only if source points to a datapackage.json file or datapackage/resource tuple. Value should be one of the following:<ul><li>Name of a single resource to load</li><li>A regular expression matching resource names to load</li><li>A list of resource names to load</li><li>&#x27;None&#x27; indicates to load all resources</li><li>The index of the resource in the package</li></ul></li><li><code>validate</code> - Should data be casted to the inferred data-types or not. Relevant only when not loading data from datapackage.</li><li>other options - based on the loaded file, extra options (e.g. sheet for Excel files etc., see the link to tabulator above)</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="printer"></a><strong><em><code>printer</code></em></strong><a class="hash-link" href="#printer" title="Direct link to heading">#</a></h3><p>Just prints whatever it sees. Good for debugging.</p><p><em>Parameters</em>:</p><ul><li><code>num_rows</code> - modify the number of rows to preview, printer will print multiple samples of this number of rows from different places in the stream</li><li><code>last_rows</code> - how many of the last rows in the stream to print. optional, defaults to the value of num_rows</li><li><code>fields</code> - optional, list of field names to preview</li><li><code>resources</code> - optional, allows to limit the printed resources, same semantics as load processor resources argument</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="set_types"></a><strong><em><code>set_types</code></em></strong><a class="hash-link" href="#set_types" title="Direct link to heading">#</a></h3><p>Sets data types and type options to fields in streamed resources, and make sure that the data still validates with the new types.</p><p>This allows to make modifications to the existing table schema, and usually to the default schema from <code>stream_remote_resources</code>.</p><p><em>Parameters</em>:</p><ul><li><p><code>resources</code> - Which resources to modify. Can be:</p><ul><li>List of strings, interpreted as resource names to stream</li><li>String, interpreted as a regular expression to be used to match resource names</li></ul><p>If omitted, all resources in datapackage are streamed.</p></li><li><p><code>regex</code> - if set to <code>False</code> field names will be interpreted as strings not as regular expressions (<code>True</code> by default)</p></li><li><p><code>types</code> - A map between field names and field definitions.</p><ul><li><em>field name</em> is either simply the name of a field, or a regular expression matching multiple fields.</li><li><em>field definition</em> is an object adhering to the <a href="http://specs.frictionlessdata.io/table-schema/" target="_blank" rel="noopener noreferrer">JSON Table Schema spec</a>. You can use <code>null</code> instead of an object to remove a field from the schema.</li></ul></li></ul><p><em>Example</em>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> add_resources</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> example</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">resource</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//example.com/my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">csv</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">file.csv</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">encoding</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;iso-8859-2&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> stream_remote_resources</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> set_types</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> example</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">resource</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">types</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">age</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> integer</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">&quot;yearly_score_[0-9]{4}&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> number</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">&quot;date of birth&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> date</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">format</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;%d/%m/%Y&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">&quot;social security number&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token null important">null</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="load_metadata"></a><strong><em><code>load_metadata</code></em></strong><a class="hash-link" href="#load_metadata" title="Direct link to heading">#</a></h3><p>Loads metadata from an existing data-package.</p><p><em>Parameters</em>:</p><p>Loads the metadata from the data package located at <code>url</code>.</p><p>All properties of the loaded datapackage will be copied (except the <code>resources</code>)</p><p><em>Example</em>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> load_metadata</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//example.com/my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">datapackage/datapackage.json</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="load_resource"></a><strong><em><code>load_resource</code></em></strong><a class="hash-link" href="#load_resource" title="Direct link to heading">#</a></h3><p>Loads a tabular resource from an existing data-package.</p><p><em>Parameters</em>:</p><p>Loads the resource specified in the <code>resource</code> parameter from the data package located at <code>url</code>.
All properties of the loaded resource will be copied - <code>path</code> and <code>schema</code> included.</p><ul><li><p><code>url</code> - a URL pointing to the datapackage in which the required resource resides</p></li><li><p><code>resource</code> - can be</p><ul><li>List of strings, interpreted as resource names to load</li><li>String, interpreted as a regular expression to be used to match resource names</li><li>an integer, indicating the index of the resource in the data package (0-based)</li></ul></li><li><p><code>limit-rows</code> - if provided, will limit the number of rows fetched from the source. Takes an integer value which specifies how many rows of the source to stream.</p></li><li><p><code>log-progress-rows</code> - if provided, will log the loading progress. Takes an integer value which specifies the number of rows interval at which to log the progress.</p></li><li><p><code>stream</code> - if provided and is set to false, then the resource will be added to the datapackage but not streamed.</p></li><li><p><code>resources</code> - can be used instead of <code>resource</code> property to support loading resources and modify the output resource metadata</p><ul><li>Value is a dict containing mapping between source resource name to load and dict containing descriptor updates to apply to the loaded resource</li></ul></li><li><p><code>required</code> - if provided and set to false, will not fail if datapackage is not available or resource is missing</p></li></ul><p><em>Example</em>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> load_resource</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//example.com/my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">datapackage/datapackage.json</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">resource</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">resource</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> load_resource</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//example.com/my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">other</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">datapackage/datapackage.json</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">resource</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> load_resource</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//example.com/my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">datapackage/datapackage.json</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">my-resource</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">renamed</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">resource</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">renamed</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">resource.csv</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="concatenate"></a><strong><em><code>concatenate</code></em></strong><a class="hash-link" href="#concatenate" title="Direct link to heading">#</a></h3><p>Concatenates a number of streamed resources and converts them to a single resource.</p><p><em>Parameters</em>:</p><ul><li><p><code>sources</code> - Which resources to concatenate. Same semantics as <code>resources</code> in <code>stream_remote_resources</code>.</p><p>If omitted, all resources in datapackage are concatenated.</p><p>Resources to concatenate must appear in consecutive order within the data-package.</p></li><li><p><code>target</code> - Target resource to hold the concatenated data. Should define at least the following properties:</p><ul><li><code>name</code> - name of the resource</li><li><code>path</code> - path in the data-package for this file.</li></ul><p>If omitted, the target resource will receive the name <code>concat</code> and will be saved at <code>data/concat.csv</code> in the datapackage.</p></li><li><p><code>fields</code> - Mapping of fields between the sources and the target, so that the keys are the <em>target</em> field names, and values are lists of <em>source</em> field names.</p><p>This mapping is used to create the target resources schema.</p><p>Note that the target field name is <em>always</em> assumed to be mapped to itself.</p></li></ul><p><em>Example</em>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> concatenate</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">target</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> multi</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">year</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">report</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> data/multi</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">year</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">report.csv</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">sources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;report-year-20[0-9]{2}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">fields</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">activity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">amount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;2009_amount&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Amount&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;AMOUNT [USD]&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;$$$&#x27;</span><span class="token punctuation" style="color:#393A34">]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>In this example we concatenate all resources that look like <code>report-year-&lt;year&gt;</code>, and output them to the <code>multi-year-report</code> resource.</p><p>The output contains two fields:</p><ul><li><code>activity</code> , which is called <code>activity</code> in all sources</li><li><code>amount</code>, which has varying names in different resources (e.g. <code>Amount</code>, <code>2009_amount</code>, <code>amount</code> etc.)</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="join"></a><strong><em><code>join</code></em></strong><a class="hash-link" href="#join" title="Direct link to heading">#</a></h3><p>Joins two streamed resources.</p><p>&quot;Joining&quot; in our case means taking the <em>target</em> resource, and adding fields to each of its rows by looking up data in the <em>source</em> resource.</p><p>A special case for the join operation is when there is no target stream, and all unique rows from the source are used to create it.
This mode is called <em>deduplication</em> mode - The target resource will be created and  deduplicated rows from the source will be added to it.</p><p><em>Parameters</em>:</p><ul><li><p><code>source</code> - information regarding the <em>source</em> resource</p><ul><li><code>name</code> - name of the resource</li><li><code>key</code> - One of<ul><li>List of field names which should be used as the lookup key</li><li>String, which would be interpreted as a Python format string used to form the key (e.g. <code>{&lt;field_name_1&gt;}:{field_name_2}</code>)</li></ul></li><li><code>delete</code> - delete from data-package after joining (<code>False</code> by default)</li></ul></li><li><p><code>target</code> - Target resource to hold the joined data. Should define at least the following properties:</p><ul><li><code>name</code> - as in <code>source</code></li><li><code>key</code> - as in <code>source</code>, or <code>null</code> for creating the target resource and performing <em>deduplication</em>.</li></ul></li><li><p><code>fields</code> - mapping of fields from the source resource to the target resource.
Keys should be field names in the target resource.
Values can define two attributes:</p><ul><li><p><code>name</code> - field name in the source (by default is the same as the target field name)</p></li><li><p><code>aggregate</code> - aggregation strategy (how to handle multiple <em>source</em> rows with the same key). Can take the following options:</p><ul><li><p><code>sum</code> - summarise aggregated values.
For numeric values it&#x27;s the arithmetic sum, for strings the concatenation of strings and for other types will error.</p></li><li><p><code>avg</code> - calculate the average of aggregated values.</p><p>For numeric values it&#x27;s the arithmetic average and for other types will err.</p></li><li><p><code>max</code> - calculate the maximum of aggregated values.</p><p>For numeric values it&#x27;s the arithmetic maximum, for strings the dictionary maximum and for other types will error.</p></li><li><p><code>min</code> - calculate the minimum of aggregated values.</p><p>For numeric values it&#x27;s the arithmetic minimum, for strings the dictionary minimum and for other types will error.</p></li><li><p><code>first</code> - take the first value encountered</p></li><li><p><code>last</code> - take the last value encountered</p></li><li><p><code>count</code> - count the number of occurrences of a specific key
For this method, specifying <code>name</code> is not required. In case it is specified, <code>count</code> will count the number of non-null values for that source field.</p></li><li><p><code>counters</code> - count the number of occurrences of distinct values
Will return an array of 2-tuples of the form <code>[value, count-of-value]</code>.</p></li><li><p><code>set</code> - collect all distinct values of the aggregated field, unordered</p></li><li><p><code>array</code> - collect all values of the aggregated field, in order of appearance</p></li><li><p><code>any</code> - pick any value.</p></li></ul><p>By default, <code>aggregate</code> takes the <code>any</code> value.</p></li></ul><p>If neither <code>name</code> or <code>aggregate</code> need to be specified, the mapping can map to the empty object <code>{}</code> or to <code>null</code>.</p></li><li><p><code>full</code>  - Boolean,</p><ul><li>If <code>True</code> (the default), failed lookups in the source will result in &quot;null&quot; values at the source.</li><li>if <code>False</code>, failed lookups in the source will result in dropping the row from the target.</li></ul></li></ul><p><em>Important: the &quot;source&quot; resource <strong>must</strong> appear before the &quot;target&quot; resource in the data-package.</em></p><p><em>Examples</em>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> join</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">source</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> world_population</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;country_code&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">delete</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> yes</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">target</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> country_gdp_2015</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;CC&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">fields</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">population</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;census_2015&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">full</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The above example aims to create a package containing the GDP and Population of each country in the world.</p><p>We have one resource (<code>world_population</code>) with data that looks like:</p><table><thead><tr><th>country_code</th><th>country_name</th><th>census_2000</th><th>census_2015</th></tr></thead><tbody><tr><td>UK</td><td>United Kingdom</td><td>58857004</td><td>64715810</td></tr><tr><td>...</td><td></td><td></td><td></td></tr></tbody></table><p>And another resource (<code>country_gdp_2015</code>) with data that looks like:</p><table><thead><tr><th>CC</th><th>GDP (Â£m)</th><th>Net Debt (Â£m)</th></tr></thead><tbody><tr><td>UK</td><td>1832318</td><td>1606600</td></tr><tr><td>...</td><td></td><td></td></tr></tbody></table><p>The <code>join</code> command will match rows in both datasets based on the <code>country_code</code> / <code>CC</code> fields, and then copying the value in the <code>census_2015</code> field into a new <code>population</code> field.</p><p>The resulting data package will have the <code>world_population</code> resource removed and the <code>country_gdp_2015</code> resource looking like:</p><table><thead><tr><th>CC</th><th>GDP (Â£m)</th><th>Net Debt (Â£m)</th><th>population</th></tr></thead><tbody><tr><td>UK</td><td>1832318</td><td>1606600</td><td>64715810</td></tr><tr><td>...</td><td></td><td></td><td></td></tr></tbody></table><p>A more complex example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> join</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">source</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> screen_actor_salaries</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{production} ({year})&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">target</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mgm_movies</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{title}&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">fields</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">num_actors</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">aggregate</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;count&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">average_salary</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> salary</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">aggregate</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;avg&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">total_salaries</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> salary</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">aggregate</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;sum&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">full</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This example aims to analyse salaries for screen actors in the MGM studios.</p><p>Once more, we have one resource (<code>screen_actor_salaries</code>) with data that looks like:</p><table><thead><tr><th>year</th><th>production</th><th>actor</th><th>salary</th></tr></thead><tbody><tr><td>2016</td><td>Vertigo 2</td><td>Mr. T</td><td>15000000</td></tr><tr><td>2016</td><td>Vertigo 2</td><td>Robert Downey Jr.</td><td>7000000</td></tr><tr><td>2015</td><td>The Fall - Resurrection</td><td>Jeniffer Lawrence</td><td>18000000</td></tr><tr><td>2015</td><td>Alf - The Return to Melmack</td><td>The Rock</td><td>12000000</td></tr><tr><td>...</td><td></td><td></td><td></td></tr></tbody></table><p>And another resource (<code>mgm_movies</code>) with data that looks like:</p><table><thead><tr><th>title</th><th>director</th><th>producer</th></tr></thead><tbody><tr><td>Vertigo 2 (2016)</td><td>Lindsay Lohan</td><td>Lee Ka Shing</td></tr><tr><td>iRobot - The Movie (2018)</td><td>Mr. T</td><td>Mr. T</td></tr><tr><td>...</td><td></td><td></td></tr></tbody></table><p>The <code>join</code> command will match rows in both datasets based on the movie name and production year. Notice how we overcome incompatible fields by using different key patterns.</p><p>The resulting dataset could look like:</p><table><thead><tr><th>title</th><th>director</th><th>producer</th><th>num_actors</th><th>average_salary</th><th>total_salaries</th></tr></thead><tbody><tr><td>Vertigo 2 (2016)</td><td>Lindsay Lohan</td><td>Lee Ka Shing</td><td>2</td><td>11000000</td><td>22000000</td></tr><tr><td>...</td><td></td><td></td><td></td><td></td><td></td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="filter"></a><strong><em><code>filter</code></em></strong><a class="hash-link" href="#filter" title="Direct link to heading">#</a></h3><p>Filter streamed resources.</p><p><code>filter</code> accepts equality and inequality conditions and tests each row in the selected resources. If none of the conditions validate, the row will be discarded.</p><p><em>Parameters</em>:</p><ul><li><code>resources</code> - Which resources to apply the filter on. Same semantics as <code>resources</code> in <code>stream_remote_resources</code>.</li><li><code>in</code> - Mapping of keys to values which translate to <code>row[key] == value</code> conditions</li><li><code>out</code> - Mapping of keys to values which translate to <code>row[key] != value</code> conditions</li></ul><p>Both <code>in</code> and <code>out</code> should be a list of objects. However, <code>out</code> should only ever have one element.</p><p><em>Examples</em>:</p><p>Filtering just American and European countries, leaving out countries whose main language is English:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> filter</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> world_population</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">in</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">continent</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> america</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">continent</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> europe</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> filter</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> world_population</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">out</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">language</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> english</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>To filter <code>out</code> by multiple values, you need multiple filter processors, not multiple <code>out</code> elements. Otherwise some condition will always validate and no rows will be discareded:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">- run: filter</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  parameters:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    resources: world_population</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    out:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      - language: english</span></div><div class="token-line" style="color:#393A34"><span class="token plain">- run: filter</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  parameters:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    resources: world_population</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    out:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      - language: swedish</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="sort"></a><strong><em><code>sort</code></em></strong><a class="hash-link" href="#sort" title="Direct link to heading">#</a></h3><p>Sort streamed resources by key.</p><p><code>sort</code> accepts a list of resources and a key (as a Python format string on row fields).
It will output the rows for each resource, sorted according to the key (in ascending order by default).</p><p><em>Parameters</em>:</p><ul><li><code>resources</code> - Which resources to sort. Same semantics as <code>resources</code> in <code>stream_remote_resources</code>.</li><li><code>sort-by</code> - String, which would be interpreted as a Python format string used to form the key (e.g. <code>{&lt;field_name_1&gt;}:{field_name_2}</code>)</li><li><code>reverse</code> - Optional boolean, if set to true - sorts in reverse order</li></ul><p><em>Examples</em>:</p><p>Filtering just American and European countries, leaving out countries whose main language is English:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sort</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> world_population</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">sort-by</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{country_name}&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="deduplicate"></a><strong><em><code>deduplicate</code></em></strong><a class="hash-link" href="#deduplicate" title="Direct link to heading">#</a></h3><p>Deduplicates rows in resources based on the resources&#x27; primary key</p><p><code>deduplicate</code> accepts a resource specifier - for each resource, it will output only unique rows (based on the values in the primary key fields). Rows with duplicate primary keys will be ignored.</p><p><em>Parameters</em>:</p><ul><li><code>resources</code> - Which resources to sort. Same semantics as <code>resources</code> in <code>stream_remote_resources</code>.</li></ul><p><em>Examples</em>:</p><p>Deduplicating rows in the <code>world-population</code> resource.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> deduplicate</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> world_population</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="duplicate"></a><strong><em><code>duplicate</code></em></strong><a class="hash-link" href="#duplicate" title="Direct link to heading">#</a></h3><p>Duplicate a resource.</p><p><code>duplicate</code> accepts the name of a single resource in the datapackage.
It will then duplicate it in the output datapackage, with a different name and path.
The duplicated resource will appear immediately after its original.</p><p><em>Parameters</em>:</p><ul><li><code>source</code> - Which resources to duplicate. The name of the resource.</li><li><code>target-name</code> - Name of the new, duplicated resource.</li><li><code>target-path</code> - Path for the new, duplicated resource.</li><li><code>duplicate_to_end</code> - Make the duplicate resource appear at the end, rather than immediately after its original.</li></ul><p><em>Examples</em>:</p><p>Filtering just American and European countries, leaving out countries whose main language is English:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> duplicate</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">source</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> original</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">resource</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">target-name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> copy</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">of</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">resource</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">target-path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> data/duplicate.csv</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="delete_fields"></a><strong><em><code>delete_fields</code></em></strong><a class="hash-link" href="#delete_fields" title="Direct link to heading">#</a></h3><p>Delete fields (columns) from streamed resources</p><p><code>delete_fields</code> accepts a list of resources and list of fields to remove</p><p><em>Note: if multiple resources provided, all of them should contain all fields to delete</em></p><p><em>Parameters</em>:</p><ul><li><code>resources</code> - Which resources to delete columns from. Same semantics as <code>resources</code> in <code>stream_remote_resources</code>.</li><li><code>fields</code> - List of field (column) names to be removed (exact names or regular expressions for matching field names)</li><li><code>regex</code> - if set to <code>False</code> field names will be interpreted as strings not as regular expressions (<code>True</code> by default)</li></ul><p><em>Examples</em>:</p><p>Deleting <code>country_name</code> and <code>census_2000</code> columns from <code>world_population</code> resource:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> delete_fields</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> world_population</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">fields</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> country_name</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> census_2000</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="add_computed_field"></a><strong><em><code>add_computed_field</code></em></strong><a class="hash-link" href="#add_computed_field" title="Direct link to heading">#</a></h3><p>Add field(s) to streamed resources</p><p><code>add_computed_field</code> accepts a list of resources and fields to add to existing resource. It will output the rows for each resource with new field(s) (columns) in it. <code>add_computed_field</code> allows to perform various operations before inserting value into targeted field.</p><p><em>Parameters</em>:</p><ul><li><code>resources</code> - Resources to add field. Same semantics as <code>resources</code> in <code>stream_remote_resources</code>.</li><li><code>fields</code> - List of operations to be performed on the targeted fields.<ul><li><code>operation</code>: operation to perform on values of pre-defined columns of the same row. available operation:<ul><li><code>constant</code> - add a constant value</li><li><code>sum</code> - summed value for given columns in a row.</li><li><code>avg</code> - average value from given columns in a row.</li><li><code>min</code> - minimum value among given columns in a row.</li><li><code>max</code> - maximum value among given columns in a row.</li><li><code>multiply</code> - product of given columns in a row.</li><li><code>join</code> - joins two or more column values in a row.</li><li><code>format</code> - Python format string used to form the value Eg:  <code>my name is {first_name}</code>.</li></ul></li><li><code>target</code> - name of the new field.</li><li><code>source</code> - list of columns the operations should be performed on (Not required in case of <code>format</code> and <code>constant</code>).</li><li><code>with</code> - String passed to <code>constant</code>, <code>format</code> or <code>join</code> operations<ul><li>in <code>constant</code> - used as constant value</li><li>in <code>format</code> - used as Python format string with existing column values Eg: <code>{first_name} {last_name}</code></li><li>in <code>join</code> - used as delimiter</li></ul></li></ul></li></ul><p><em>Examples</em>:</p><p>Following example adds 4 new field to <code>salaries</code> resource</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> add_computed_field</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> salaries</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">fields</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">operation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sum</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">target</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> total</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">source</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> jan</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> feb</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> may</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">operation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> avg</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">target</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> average</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">source</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> jan</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> feb</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> may</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">operation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> format</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">target</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> full_name</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;{first_name} {last_name}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">operation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> constant</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">target</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> status</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> single</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>We have one resource (<code>salaries</code>) with data that looks like:</p><table><thead><tr><th>first_name</th><th>last_name</th><th>jan</th><th>feb</th><th>mar</th></tr></thead><tbody><tr><td>John</td><td>Doe</td><td>100</td><td>200</td><td>300</td></tr><tr><td>...</td><td></td><td></td><td></td><td></td></tr></tbody></table><p>The resulting dataset could look like:</p><table><thead><tr><th>first_name</th><th>last_name</th><th>last_name</th><th>jan</th><th>feb</th><th>mar</th><th>average</th><th>total</th><th>status</th></tr></thead><tbody><tr><td>John</td><td>Doe</td><td>John Doe</td><td>100</td><td>200</td><td>300</td><td>200</td><td>600</td><td>single</td></tr><tr><td>...</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="find_replace"></a><strong><em><code>find_replace</code></em></strong><a class="hash-link" href="#find_replace" title="Direct link to heading">#</a></h3><p>find and replace string or pattern from field(s) values</p><p><em>Parameters</em>:</p><ul><li><p><code>resources</code> - Resources to clean the field values. Same semantics as <code>resources</code> in <code>stream_remote_resources</code></p></li><li><p><code>fields</code>- list of fields to replace values</p><ul><li><code>name</code> - name of the field to replace value</li><li><code>patterns</code> - list of patterns to find and replace from field<ul><li><code>find</code> - String, interpreted as a regular expression to match field value</li><li><code>replace</code> - String, interpreted as a regular expression to replace matched pattern</li></ul></li></ul></li></ul><p><em>Examples</em>:</p><p>Following example replaces field values using regular expression and exact string patterns</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> find_replace</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> dates</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">fields</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> year</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">patterns</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">find</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> (</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">0</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">9</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">)( \(\w+\))</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">replace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> \1</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> quarter</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">patterns</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">find</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Q1</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">replace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;03-31&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">find</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Q2</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">replace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;06-31&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">find</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Q3</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">replace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;09-30&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">find</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Q4</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">replace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;12-31&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>We have one resource (<code>dates</code>) with data that looks like:</p><table><thead><tr><th>year</th><th>quarter</th></tr></thead><tbody><tr><td>2000 (1)</td><td>2000-Q1</td></tr><tr><td>...</td><td></td></tr></tbody></table><p>The resulting dataset could look like:</p><table><thead><tr><th>year</th><th>quarter</th></tr></thead><tbody><tr><td>2000</td><td>2000-03-31</td></tr><tr><td>...</td><td></td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="unpivot"></a><strong><em><code>unpivot</code></em></strong><a class="hash-link" href="#unpivot" title="Direct link to heading">#</a></h3><p>Unpivots, transposes tabular data so that there&#x27;s only one record per row.</p><p><em>Parameters</em>:</p><ul><li><code>resources</code> - Resources to unpivot. Same semantics as <code>resources</code> in <code>stream_remote_resources</code>.</li><li><code>extraKeyFields</code> - List of target field definitions, each definition is an object containing at least these properties (unpivoted column values will go here)<ul><li><code>name</code> - Name of the target field</li><li><code>type</code> - Type of the target field</li></ul></li><li><code>extraValueField</code> - Target field definition - an object containing at least these properties (unpivoted cell values will go here)<ul><li><code>name</code> - Name of the target field</li><li><code>type</code> - Type of the target field</li></ul></li><li><code>unpivot</code> - List of source field definitions, each definition is an object containing at least these properties<ul><li><code>name</code> - Either simply the name, or a regular expression matching the name of original field to unpivot.</li><li><code>keys</code> - A Map between target field name and values for original field<ul><li>Keys should be target field names from <code>extraKeyFields</code></li><li>Values may be either simply the constant value to insert, or a regular expression matching the <code>name</code>.</li></ul></li></ul></li></ul><p><em>Examples</em>:</p><p>Following example will unpivot data into 3 new fields: <code>year</code>, <code>direction</code> and <code>amount</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> balance</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">extraKeyFields</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> year</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> integer</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> direction</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> string</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">constraints</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">enum</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> In</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Out</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">extraValueField</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> amount</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> number</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">unpivot</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 2015 incomes</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">keys</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">year</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2015</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">direction</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> In</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 2015 expenses</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">keys</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">year</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2015</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">direction</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Out</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 2016 incomes</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">keys</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">year</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2016</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">direction</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> In</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 2016 expenses</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">keys</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">year</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2016</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">direction</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Out</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>We have one resource (<code>balance</code>) with data that looks like:</p><table><thead><tr><th>company</th><th>2015 incomes</th><th>2015 expenses</th><th>2016 incomes</th><th>2016 expenses</th></tr></thead><tbody><tr><td>Inc</td><td>1000</td><td>900</td><td>2000</td><td>1700</td></tr><tr><td>Org</td><td>2000</td><td>800</td><td>3000</td><td>2000</td></tr><tr><td>...</td><td></td><td></td><td></td><td></td></tr></tbody></table><p>The resulting dataset could look like:</p><table><thead><tr><th>company</th><th>year</th><th>direction</th><th>amount</th></tr></thead><tbody><tr><td>Inc</td><td>2015</td><td>In</td><td>1000</td></tr><tr><td>Inc</td><td>2015</td><td>Out</td><td>900</td></tr><tr><td>Inc</td><td>2016</td><td>In</td><td>2000</td></tr><tr><td>Inc</td><td>2016</td><td>Out</td><td>1700</td></tr><tr><td>Org</td><td>2015</td><td>In</td><td>2000</td></tr><tr><td>Org</td><td>2015</td><td>Out</td><td>800</td></tr><tr><td>Org</td><td>2016</td><td>In</td><td>3000</td></tr><tr><td>Org</td><td>2016</td><td>Out</td><td>2000</td></tr><tr><td>...</td><td></td><td></td><td></td></tr></tbody></table><p>Similar result can be accomplished by defining regular expressions instead of constant values</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> balance</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">extraKeyFields</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> year</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> integer</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> direction</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> string</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">constraints</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">enum</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> In</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Out</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">extraValueField</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> amount</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> number</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">unpivot</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> (</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">0</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">9</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">) (\\w+)  </span><span class="token comment" style="color:#999988;font-style:italic"># regex for original column</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">keys</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">year</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> \\1  </span><span class="token comment" style="color:#999988;font-style:italic"># First member of group from above</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">direction</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> \\2  </span><span class="token comment" style="color:#999988;font-style:italic"># Second member of group from above</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="dump_to_sql"></a><strong><em><code>dump_to_sql</code></em></strong><a class="hash-link" href="#dump_to_sql" title="Direct link to heading">#</a></h3><p>Saves the datapackage to an SQL database.</p><p><em>Parameters</em>:</p><ul><li><code>engine</code> - Connection string for connecting to the SQL Database (URL syntax)
Also supports <code>env://&lt;environment-variable&gt;</code>, which indicates that the connection string should be fetched from the indicated environment variable.
If not specified, assumes a default of <code>env://DPP_DB_ENGINE</code></li><li><code>tables</code> - Mapping between resources and DB tables. Keys are table names, values are objects with the following attributes:<ul><li><code>resource-name</code> - name of the resource that should be dumped to the table</li><li><code>mode</code> - How data should be written to the DB.
Possible values:<ul><li><code>rewrite</code> (the default) - rewrite the table, all previous data (if any) will be deleted.</li><li><code>append</code> - write new rows without changing already existing data.</li><li><code>update</code> - update the table based on a set of &quot;update keys&quot;.
For each new row, see if there already an existing row in the DB which can be updated (that is, an existing row
with the same values in all of the update keys).
If so - update the rest of the columns in the existing row. Otherwise - insert a new row to the DB.</li></ul></li><li><code>update_keys</code> - Only applicable for the <code>update</code> mode. A list of field names that should be used to check for row existence.
If left unspecified, will use the schema&#x27;s <code>primaryKey</code> as default.</li><li><code>indexes</code> - TBD</li></ul></li><li><code>updated_column</code> - Optional name of a column that will be added to the spewed data with boolean value<ul><li><code>true</code> - row was updated</li><li><code>false</code> - row was inserted</li></ul></li><li><code>updated_id_column</code> - Optional name of a column that will be added to the spewed data and contain the id of the updated row in DB.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="dump_to_path"></a><strong><em><code>dump_to_path</code></em></strong><a class="hash-link" href="#dump_to_path" title="Direct link to heading">#</a></h3><p>Saves the datapackage to a filesystem path.</p><p><em>Parameters</em>:</p><ul><li><p><code>out-path</code> - Name of the output path where <code>datapackage.json</code> will be stored.</p><p>This path will be created if it doesn&#x27;t exist, as well as internal data-package paths.</p><p>If omitted, then <code>.</code> (the current directory) will be assumed.</p></li><li><p><code>force-format</code> - Specifies whether to force all output files to be generated with the same format</p><ul><li>if <code>True</code> (the default), all resources will use the same format</li><li>if <code>False</code>, format will be deduced from the file extension. Resources with unknown extensions will be discarded.</li></ul></li><li><p><code>format</code> - Specifies the type of output files to be generated (if <code>force-format</code> is true): <code>csv</code> (the default) or <code>json</code></p></li><li><p><code>add-filehash-to-path</code>: Specifies whether to include file md5 hash into the resource path. Defaults to <code>False</code>. If <code>True</code> Embeds hash in path like so:</p><ul><li>If original path is <code>path/to/the/file.ext</code></li><li>Modified path will be <code>path/to/the/HASH/file.ext</code></li></ul></li><li><p><code>counters</code> - Specifies whether to count rows, bytes or md5 hash of the data and where it should be stored. An object with the following properties:</p><ul><li><code>datapackage-rowcount</code>: Where should a total row count of the datapackage be stored (default: <code>count_of_rows</code>)</li><li><code>datapackage-bytes</code>: Where should a total byte count of the datapackage be stored (default: <code>bytes</code>)</li><li><code>datapackage-hash</code>: Where should an md5 hash of the datapackage be stored (default: <code>hash</code>)</li><li><code>resource-rowcount</code>: Where should a total row count of each resource be stored (default: <code>count_of_rows</code>)</li><li><code>resource-bytes</code>: Where should a total byte count of each resource be stored (default: <code>bytes</code>)</li><li><code>resource-hash</code>: Where should an md5 hash of each resource be stored (default: <code>hash</code>)
Each of these attributes could be set to null in order to prevent the counting.
Each property could be a dot-separated string, for storing the data inside a nested object (e.g. <code>stats.rowcount</code>)</li></ul></li><li><p><code>pretty-descriptor</code>: Specifies how datapackage descriptor (<code>datapackage.json</code>) file will look like:</p><ul><li><code>False</code> (default) - descriptor will be written in one line.</li><li><code>True</code> - descriptor will have indents and new lines for each key, so it becomes more human-readable.</li></ul></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="dump_to_zip"></a><strong><em><code>dump_to_zip</code></em></strong><a class="hash-link" href="#dump_to_zip" title="Direct link to heading">#</a></h3><p>Saves the datapackage to a zipped archive.</p><p><em>Parameters</em>:</p><ul><li><code>out-file</code> - Name of the output file where the zipped data will be stored</li><li><code>force-format</code> and <code>format</code> - Same as in <code>dump_to_path</code></li><li><code>add-filehash-to-path</code> - Same as in <code>dump_to_path</code></li><li><code>counters</code> - Same as in <code>dump_to_path</code></li><li><code>pretty-descriptor</code> - Same as in <code>dump_to_path</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="deprecated-processors"></a>Deprecated Processors<a class="hash-link" href="#deprecated-processors" title="Direct link to heading">#</a></h2><p>These processors will be removed in the next major version.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="add_metadata"></a><strong><em><code>add_metadata</code></em></strong><a class="hash-link" href="#add_metadata" title="Direct link to heading">#</a></h3><p>Alias for <code>update_package</code>, is kept for backward compatibility reasons.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="add_resource"></a><strong><em><code>add_resource</code></em></strong><a class="hash-link" href="#add_resource" title="Direct link to heading">#</a></h3><p>Adds a new external tabular resource to the data-package.</p><p><em>Parameters</em>:</p><p>You should provide a <code>name</code> and <code>url</code> attributes, and other optional attributes as defined in the <a href="/docs/other-libraries/[http://specs.frictionlessdata.io/data-packages/#resource-information">spec</a>.</p><p><code>url</code> indicates where the data for this resource resides. Later on, when <code>stream_remote_resources</code> runs, it will use the <code>url</code> (which is stored in the resource in the <code>dpp:streamedFrom</code> property) to read the data rows and push them into the pipeline.</p><p>Note that <code>url</code> also supports <code>env://&lt;environment-variable&gt;</code>, which indicates that the resource url should be fetched from the indicated environment variable.  This is useful in case you are supplying a string with sensitive information (such as an SQL connection string for streaming from a database table).</p><p>Parameters are basically arguments that are passed to a <code>tabulator.Stream</code> instance (see the <a href="https://github.com/frictionlessdata/tabulator-py#api-reference" target="_blank" rel="noopener noreferrer">API</a>).
Other than those, you can pass a <code>constants</code> parameter which should be a mapping of headers to string values.
When used in conjunction with <code>stream_remote_resources</code>, these constant values will be added to each generated row
(as well as to the default schema).</p><p>You may also provide a schema here, or use the default schema generated by the <code>stream_remote_resources</code> processor.
In case <code>path</code> is specified, it will be used. If not, the <code>stream_remote_resources</code> processor will assign a <code>path</code> for you with a <code>csv</code> extension.</p><p><em>Example</em>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> add_resource</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//example.com/my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">excel</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">file.xlsx</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">sheet</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">headers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> add_resource</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//example.com/my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">csv</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">file.csv</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">encoding</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;iso-8859-2&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="stream_remote_resources"></a><strong><em><code>stream_remote_resources</code></em></strong><a class="hash-link" href="#stream_remote_resources" title="Direct link to heading">#</a></h3><p>Converts external resources to streamed resources.</p><p>External resources are ones that link to a remote data source (url or file path), but are not processed by the pipeline and are kept as-is.</p><p>Streamed resources are ones that can be processed by the pipeline, and their output is saved as part of the resulting datapackage.</p><p>In case a resource has no schema, a default one is generated automatically here by creating a <code>string</code> field from each column in the data source.</p><p><em>Parameters</em>:</p><ul><li><p><code>resources</code> - Which resources to stream. Can be:</p><ul><li>List of strings, interpreted as resource names to stream</li><li>String, interpreted as a regular expression to be used to match resource names</li></ul><p>If omitted, all resources in datapackage are streamed.</p></li><li><p><code>ignore-missing</code> - if true, then missing resources won&#x27;t raise an error but will be treated as &#x27;empty&#x27; (i.e. with zero rows).
Resources with empty URLs will be treated the same (i.e. will generate an &#x27;empty&#x27; resource).</p></li><li><p><code>limit-rows</code> - if provided, will limit the number of rows fetched from the source. Takes an integer value which specifies how many rows of the source to stream.</p></li></ul><p><em>Example</em>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> stream_remote_resources</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;2014-data&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;2015-data&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> stream_remote_resources</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;201[67]-data&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This processor also supports loading plain-text resources (e.g. html pages) and handling them as tabular data - split into rows with a single &quot;data&quot; column.
To enable this behavior, add the following attribute to the resource: <code>&quot;format&quot;: &quot;txt&quot;</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="dumpto_sql"></a><strong><em><code>dump.to_sql</code></em></strong><a class="hash-link" href="#dumpto_sql" title="Direct link to heading">#</a></h3><p>Alias for <code>dump_to_sql</code>, is kept for backward compatibility reasons.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="dumpto_path"></a><strong><em><code>dump.to_path</code></em></strong><a class="hash-link" href="#dumpto_path" title="Direct link to heading">#</a></h3><p>Saves the datapackage to a filesystem path.</p><p><em>Parameters</em>:</p><ul><li><p><code>out-path</code> - Name of the output path where <code>datapackage.json</code> will be stored.</p><p>This path will be created if it doesn&#x27;t exist, as well as internal data-package paths.</p><p>If omitted, then <code>.</code> (the current directory) will be assumed.</p></li><li><p><code>force-format</code> - Specifies whether to force all output files to be generated with the same format</p><ul><li>if <code>True</code> (the default), all resources will use the same format</li><li>if <code>False</code>, format will be deduced from the file extension. Resources with unknown extensions will be discarded.</li></ul></li><li><p><code>format</code> - Specifies the type of output files to be generated (if <code>force-format</code> is true): <code>csv</code> (the default) or <code>json</code></p></li><li><p><code>handle-non-tabular</code> - Specifies whether non tabular resources (i.e. resources without a <code>schema</code>) should be dumped as well to the resulting datapackage.
(See note below for more details)</p></li><li><p><code>add-filehash-to-path</code>: Specifies whether to include file md5 hash into the resource path. Defaults to <code>False</code>. If <code>True</code> Embeds hash in path like so:</p><ul><li>If original path is <code>path/to/the/file.ext</code></li><li>Modified path will be <code>path/to/the/HASH/file.ext</code></li></ul></li><li><p><code>counters</code> - Specifies whether to count rows, bytes or md5 hash of the data and where it should be stored. An object with the following properties:</p><ul><li><code>datapackage-rowcount</code>: Where should a total row count of the datapackage be stored (default: <code>count_of_rows</code>)</li><li><code>datapackage-bytes</code>: Where should a total byte count of the datapackage be stored (default: <code>bytes</code>)</li><li><code>datapackage-hash</code>: Where should an md5 hash of the datapackage be stored (default: <code>hash</code>)</li><li><code>resource-rowcount</code>: Where should a total row count of each resource be stored (default: <code>count_of_rows</code>)</li><li><code>resource-bytes</code>: Where should a total byte count of each resource be stored (default: <code>bytes</code>)</li><li><code>resource-hash</code>: Where should an md5 hash of each resource be stored (default: <code>hash</code>)
Each of these attributes could be set to null in order to prevent the counting.
Each property could be a dot-separated string, for storing the data inside a nested object (e.g. <code>stats.rowcount</code>)</li></ul></li><li><p><code>pretty-descriptor</code>: Specifies how datapackage descriptor (<code>datapackage.json</code>) file will look like:</p><ul><li><code>False</code> (default) - descriptor will be written in one line.</li><li><code>True</code> - descriptor will have indents and new lines for each key, so it becomes more human-readable.</li></ul></li><li><p><code>file-formatters</code>: Specifies custom file format handlers. An object with mapping of format name to Python module and class name.</p><ul><li>Allows to override the existing <code>csv</code> and <code>json</code> format handlers or add support for new formats.</li><li>Note that such changes may make the resulting datapackage incompatible with the frictionlessdata specs and may cause interoperability problems.</li><li>Example usage: <a href="/docs/other-libraries/tests/cli/pipeline-spec.yaml">pipeline-spec.yaml</a> (under the <code>custom-formatters</code> pipeline), <a href="/docs/other-libraries/tests/cli/custom_formatters/xlsx_format.py">XLSXFormat class</a></li></ul></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="dumpto_zip"></a><strong><em><code>dump.to_zip</code></em></strong><a class="hash-link" href="#dumpto_zip" title="Direct link to heading">#</a></h3><p>Saves the datapackage to a zipped archive.</p><p><em>Parameters</em>:</p><ul><li><code>out-file</code> - Name of the output file where the zipped data will be stored</li><li><code>force-format</code> and <code>format</code> - Same as in <code>dump_to_path</code></li><li><code>handle-non-tabular</code> - Same as in <code>dump_to_path</code></li><li><code>add-filehash-to-path</code> - Same as in <code>dump_to_path</code></li><li><code>counters</code> - Same as in <code>dump_to_path</code></li><li><code>pretty-descriptor</code> - Same as in <code>dump_to_path</code></li><li><code>file-formatters</code> - Same as in <code>dump_to_path</code></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="note"></a><em>Note</em><a class="hash-link" href="#note" title="Direct link to heading">#</a></h4><p><code>dump.to_path</code> and <code>dump.to_zip</code> processors will handle non-tabular resources as well.
These resources must have both a <code>url</code> and <code>path</code> properties, and <em>must not</em> contain a <code>schema</code> property.
In such cases, the file will be downloaded from the <code>url</code> and placed in the provided <code>path</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="custom-processors"></a>Custom Processors<a class="hash-link" href="#custom-processors" title="Direct link to heading">#</a></h2><p>It&#x27;s quite reasonable that for any non-trivial processing task, you might encounter a problem that cannot be solved using the standard library processors.</p><p>For that you might need to write your own processor - here&#x27;s how it&#x27;s done.</p><p>There are two APIs for writing processors - the high level API and the low level API.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="high-level-processor-api"></a>High Level Processor API<a class="hash-link" href="#high-level-processor-api" title="Direct link to heading">#</a></h3><p>The high-level API is quite useful for most processor kinds:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> datapackage_pipelines</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">wrapper </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> process</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">modify_datapackage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">datapackage</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> parameters</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stats</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Do something with datapackage</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> datapackage</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">process_row</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">row</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> row_index</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                resource_descriptor</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> resource_index</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                parameters</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stats</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Do something with row</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> row</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">process</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">modify_datapackage</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">modify_datapackage</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        process_row</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">process_row</span><span class="token punctuation" style="color:#393A34">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The high level API consists of one method, <code>process</code> which takes two functions:</p><ul><li><p><code>modify_datapackage</code> - which makes changes (if necessary) to the data-package descriptor, e.g. adds metadata, adds resources, modifies resources&#x27; schema etc.</p><p>Can also be used for initialization code when needed.</p><p>It has these arguments:</p><ul><li><code>datapackage</code> is the current data-package descriptor that needs to be modified.
The modified data-package descriptor needs to be returned.</li><li><code>parameters</code> is a dict containing the processor&#x27;s parameters, as provided in the <code>pipeline-spec.yaml</code> file.</li><li><code>stats</code> is a dict which should be modified in order to collect metrics and measurements in the process (e.g. validation checks, row count etc.)</li></ul></li><li><p><code>process_row</code> - which modifies a single row in the stream. It receives these arguments:</p><ul><li><code>row</code> is a dictionary containing the row to process</li><li><code>row_index</code> is the index of the row in the resource</li><li><code>resource_descriptor</code> is the descriptor object of the current resource being processed</li><li><code>resource_index</code> is the index of the resource in the data-package</li><li><code>parameters</code> is a dict containing the processor&#x27;s parameters, as provided in the <code>pipeline-spec.yaml</code> file.</li><li><code>stats</code> is a dict which should be modified in order to collect metrics and measurements in the process (e.g. validation checks, row count etc.)</li></ul><p>and yields zero or more processed rows.</p></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="a-few-examples"></a>A few examples<a class="hash-link" href="#a-few-examples" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Add license information</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> datapackage_pipelines</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">wrapper </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> process</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">modify_datapackage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">datapackage</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> parameters</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stats</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    datapackage</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;license&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;CC-BY-SA&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> datapackage</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">process</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">modify_datapackage</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">modify_datapackage</span><span class="token punctuation" style="color:#393A34">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Add new column with constant value to first resource</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Column name and value are taken from the processor&#x27;s parameters</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> datapackage_pipelines</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">wrapper </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> process</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">modify_datapackage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">datapackage</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> parameters</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stats</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    datapackage</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;resources&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;schema&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;fields&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&#x27;name&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> parameters</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;column-name&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&#x27;type&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;string&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> datapackage</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">process_row</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">row</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> row_index</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> resource_descriptor</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> resource_index</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> parameters</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stats</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> resource_index </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        row</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">parameters</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;column-name&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> parameters</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;value&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> row</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">process</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">modify_datapackage</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">modify_datapackage</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        process_row</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">process_row</span><span class="token punctuation" style="color:#393A34">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Row counter</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> datapackage_pipelines</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">wrapper </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> process</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">modify_datapackage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">datapackage</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> parameters</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stats</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    stats</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;row-count&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> datapackage</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">process_row</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">row</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> row_index</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> resource_descriptor</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> resource_index</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> parameters</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stats</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    stats</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;row-count&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> row</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">process</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">modify_datapackage</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">modify_datapackage</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        process_row</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">process_row</span><span class="token punctuation" style="color:#393A34">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="low-level-processor-api"></a>Low Level Processor API<a class="hash-link" href="#low-level-processor-api" title="Direct link to heading">#</a></h3><p>In some cases, the high-level API might be too restricting. In these cases you should consider using the low-level API.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> datapackage_pipelines</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">wrapper </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> ingest</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> spew</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;__main__&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> ingest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Initialisation code, if needed</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Do stuff with datapackage</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    stats </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># and resources:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">new_resource_iterator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resource_iterator_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">resource_processor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resource_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># resource_.spec is the resource descriptor</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> row </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> resource_</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic"># Do something with row</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic"># Perhaps collect some stats here as well</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">yield</span><span class="token plain"> row</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> resource </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> resource_iterator_</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">yield</span><span class="token plain"> resource_processor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resource</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    spew</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">datapackage</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">         new_resource_iterator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">resource_iterator</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">         ctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stats</span><span class="token punctuation" style="color:#393A34">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The above code snippet shows the structure of most low-level processors.</p><p>We always start with calling <code>ingest()</code> - this method gives us the context, containing the execution parameters, the data-package descriptor (as outputed from the previous step) and an iterator on all streamed resources&#x27; rows.</p><p>We finish the processing by calling <code>spew()</code>, which sends the processed data to the next processor in the pipeline. <code>spew</code> receives:</p><ul><li>A modified data-package descriptor;</li><li>A (possibly new) iterator on the resources;</li><li>A stats object which will be added to stats from previous steps and returned to the user upon completion of the pipeline, and;</li><li>Optionally, a <code>finalizer</code> function that will be called after it has finished iterating on the resources, but before signalling to other processors that it&#x27;s finished. You could use it to close any open files, for example.</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="a-more-in-depth-explanation"></a>A more in-depth explanation<a class="hash-link" href="#a-more-in-depth-explanation" title="Direct link to heading">#</a></h4><p><code>spew</code> writes the data it receives in the following order:</p><ul><li>First, the <code>datapackage</code> parameter is written to the stream.
This means that all modifications to the data-package descriptor must be done <em>before</em> <code>spew</code> is called.
One common pitfall is to modify the data-package descriptor inside the resource iterator - try to avoid that, as the descriptor that the next processor will receive will be wrong.</li><li>Then it starts iterating on the resources. For each resource, it iterates on its rows and writes each row to the stream.
This iteration process eventually causes an iteration on the original resource iterator (the one that&#x27;s returned from <code>ingest</code>). In turn, this causes the process&#x27; input stream to be read. Because of the way buffering in operating systems work, &quot;slow&quot; processors will read their input slowly, causing the ones before them to sleep on IO while their more CPU intensive counterparts finish their processing. &quot;quick&quot; processors will not work aimlessly, but instead will either sleep while waiting for incoming data or while waiting for their output buffer to drain.
What is achieved here is that all rows in the data are processed more or less at the same time, and that no processor works too &quot;far ahead&quot; on rows that might fail in subsequent processing steps.</li><li>Then the stats are written to the stream. This means that stats can be modified during the iteration, and only the value after the iteration finishes will be used.</li><li>Finally, the <code>finalizer</code> method is called (if we received one).</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="a-few-examples-1"></a>A few examples<a class="hash-link" href="#a-few-examples-1" title="Direct link to heading">#</a></h4><p>We&#x27;ll start with the same processors from above, now implemented with the low level API.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Add license information</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> datapackage_pipelines</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">wrapper </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> ingest</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> spew</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;__main__&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> ingest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    ctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">datapackage</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;license&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;MIT&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    spew</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">datapackage</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">resource_iterator</span><span class="token punctuation" style="color:#393A34">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Add new column with constant value to first resource</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Column name and value are taken from the processor&#x27;s parameters</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> datapackage_pipelines</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">wrapper </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> ingest</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> spew</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">parameters</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> datapackage</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> resource_iterator </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ingest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">datapackage</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;resources&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;schema&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;fields&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token string" style="color:#e3116c">&#x27;name&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> parameters</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;column-name&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token string" style="color:#e3116c">&#x27;type&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;string&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">new_resource_iterator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resource_iterator_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">resource_processor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resource_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> row </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> resource_</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            row</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">parameters</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;column-name&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> parameters</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;value&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">yield</span><span class="token plain"> row</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    first_resource </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resource_iterator_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">yield</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resource_processor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">first_resource</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> resource </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> resource_iterator_</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">yield</span><span class="token plain"> resource</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">spew</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">datapackage</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> new_resource_iterator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resource_iterator</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Row counter</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> datapackage_pipelines</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">wrapper </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> ingest</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> spew</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> datapackage</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> resource_iterator </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ingest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">stats </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&#x27;row-count&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">new_resource_iterator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resource_iterator_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">resource_processor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resource_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> row </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> resource_</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            stats</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;row-count&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">yield</span><span class="token plain"> row</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> resource </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> resource_iterator_</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">yield</span><span class="token plain"> resource_processor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resource</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">spew</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">datapackage</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> new_resource_iterator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resource_iterator</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stats</span><span class="token punctuation" style="color:#393A34">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This next example shows how to implement a simple web scraper. Although not strictly required, web scrapers are usually the first processor in a pipeline. Therefore, they can ignore the incoming data-package and resource iterator, as there&#x27;s no previous processor generating data:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Web Scraper</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> requests</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> datapackage_pipelines</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">wrapper </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> ingest</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> spew</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> datapackage_pipelines</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">utilities</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">resources </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> PROP_STREAMING</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">parameters</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ingest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">host </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> parameters</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;ckan-instance&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">package_list_api </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;https://{host}/api/3/action/package_list&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">package_show_api </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;https://{host}/api/3/action/package_show&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">scrape_ckan</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">host_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    all_packages </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">package_list_api</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">host</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">host_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">\</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                           </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">\</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                           </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;result&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> package_id </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> all_packages</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      params </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">package_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      package_info </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">package_show_api</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">host</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">host_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                                  params</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">params</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">\</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                             </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">\</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                             </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;result&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> result </span><span class="token keyword" style="color:#00009f">is</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">yield</span><span class="token plain"> </span><span class="token builtin">dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            package_id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">package_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            author</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">package_info</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;author&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            title</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">package_info</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;title&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">datapackage </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;resources&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      PROP_STREAMING</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># You must set this property for resources being streamed in the pipeline!</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&#x27;name&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;package-list&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&#x27;schema&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;fields&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&#x27;name&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;package_id&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;type&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;string&#x27;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&#x27;name&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;author&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">     </span><span class="token string" style="color:#e3116c">&#x27;type&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;string&#x27;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&#x27;name&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;title&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">      </span><span class="token string" style="color:#e3116c">&#x27;type&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;string&#x27;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">spew</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">datapackage</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">scrape_ckan</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">host</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>In this example we can see that the initial datapackage is generated from scratch, and the resource iterator is in fact a scraper, yielding rows as they are received from the CKAN instance API.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="plugins-and-source-descriptors"></a>Plugins and Source Descriptors<a class="hash-link" href="#plugins-and-source-descriptors" title="Direct link to heading">#</a></h2><p>When writing pipelines in a specific problem domain, one might discover that the processing pipelines that are developed follow a certain pattern. Scraping, or fetching source data tends to be similar to one another. Processing, data cleaning, validation are often the same.</p><p>In order to ease maintenance and avoid boilerplate, a <em><code>datapackage-pipelines</code> <strong>plugin</strong></em> can be written.</p><p>Plugins are Python modules named <code>datapackage_pipelines_&lt;plugin-name&gt;</code>. Plugins can provide two facilities:</p><ul><li>Processor packs - you can pack processors revolving a certain theme or for a specific purpose in a plugin. Any processor <code>foo</code> residing under the <code>datapackage_pipelines_&lt;plugin-name&gt;.processors</code> module can be used from within a pipeline as <code>&lt;plugin-name&gt;.foo</code>.</li><li>Pipeline templates - if the class <code>Generator</code> exists in the <code>datapackage_pipelines_&lt;plugin-name&gt;</code> module, it will be used to generate pipeline based on templates - which we call &quot;source descriptors&quot;.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="source-descriptors"></a>Source Descriptors<a class="hash-link" href="#source-descriptors" title="Direct link to heading">#</a></h3><p>A source descriptor is a yaml file containing information which is used to create a full pipeline.</p><p><code>dpp</code> will look for files named <code>&lt;plugin-name&gt;.source-spec.yaml</code> , and will treat them as input for the pipeline generating code - which should be implemented in a class called <code>Generator</code> in the <code>datapackage_pipelines_&lt;plugin-name&gt;</code> module.</p><p>This class should inherit from <code>GeneratorBase</code> and should implement two methods:</p><ul><li><code>generate_pipeline</code> -
which receives the source description and returns an iterator of tuples of the form <code>(id, details)</code>.
<code>id</code> might be a pipeline id, in which case details would be an object containing the pipeline definition.
If <code>id</code> is of the form <code>:module:</code>, then the details are treated as a source spec from the specified module. This way a generator might generate other source specs.</li><li><code>get_schema</code> - which should return a JSON Schema for validating the source description&#x27;s structure</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="example"></a>Example<a class="hash-link" href="#example" title="Direct link to heading">#</a></h4><p>Let&#x27;s assume we write a <code>datapackage_pipelines_ckan</code> plugin, used to pull data out of <a href="https://ckan.org" target="_blank" rel="noopener noreferrer">CKAN</a> instances.</p><p>Here&#x27;s how such a hypothetical generator would look like:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> os</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> json</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> datapackage_pipelines</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">generators </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> \</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    GeneratorBase</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> slugify</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> steps</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> SCHEDULE_MONTHLY</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">SCHEMA_FILE </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dirname</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">__file__</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;schema.json&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Generator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">GeneratorBase</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@classmethod</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get_schema</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cls</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SCHEMA_FILE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@classmethod</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">generate_pipeline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cls</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> source</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        pipeline_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dataset_name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> slugify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">source</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;name&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        host </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> source</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;ckan-instance&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        action </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> source</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;data-kind&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> action </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;package-list&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            schedule </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> SCHEDULE_MONTHLY</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            pipeline_steps </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> steps</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;ckan.scraper&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                   </span><span class="token string" style="color:#e3116c">&#x27;ckan-instance&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> host</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;metadata&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token string" style="color:#e3116c">&#x27;name&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> dataset_name</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;dump_to_zip&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                   </span><span class="token string" style="color:#e3116c">&#x27;out-file&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ckan-datapackage.zip&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            pipeline_details </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&#x27;pipeline&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pipeline_steps</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&#x27;schedule&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&#x27;crontab&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> schedule</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">yield</span><span class="token plain"> pipeline_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pipeline_details</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>In this case, if we store a <code>ckan.source-spec.yaml</code> file looking like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">ckan-instance</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> example.com</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> example</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">com</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">list</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">of</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">packages</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">data-kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> package</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">list</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Then when running <code>dpp</code> we will see an available pipeline named <code>./example-com-list-of-packages</code></p><p>This pipeline would internally be composed of 3 steps: <code>ckan.scraper</code>, <code>metadata</code> and <code>dump_to_zip</code>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="validating-source-descriptors"></a>Validating Source Descriptors<a class="hash-link" href="#validating-source-descriptors" title="Direct link to heading">#</a></h4><p>Source descriptors can have any structure that best matches the parameter domain of the output pipelines. However, it must have a consistent structure, backed by a JSON Schema file. In our case, the Schema might look like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><div tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;$schema&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;http://json-schema.org/draft-04/schema#&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;object&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;properties&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;string&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;ckan-instance&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;string&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;data-kind&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;string&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;required&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;name&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ckan-instance&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;data-kind&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><code>dpp</code> will ensure that source descriptor files conform to that schema before attempting to convert them into pipelines using the <code>Generator</code> class.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="providing-processor-code"></a>Providing Processor Code<a class="hash-link" href="#providing-processor-code" title="Direct link to heading">#</a></h4><p>In some cases, a generator would prefer to provide the processor code as well (alongside the pipeline definition).
In order to to that, the generator can add a <code>code</code> attribute to any step containing the processor&#x27;s code. When executed, this step won&#x27;t try to resolve the processor as usual but will the provided code instead.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="running-on-a-schedule"></a>Running on a schedule<a class="hash-link" href="#running-on-a-schedule" title="Direct link to heading">#</a></h2><p><code>datapackage-pipelines</code> comes with a celery integration, allowing for pipelines to be run at specific times via a <code>crontab</code> like syntax.</p><p>In order to enable that, you simply add a <code>schedule</code> section to your <code>pipeline-spec.yaml</code> file (or return a schedule from the generator class, see above), like so:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">co2-information-cdiac</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">pipeline</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">schedule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># minute hour day_of_week day_of_month month_of_year</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">crontab</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;0 * * * *&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>In this example, this pipeline is set to run every hour, on the hour.</p><p>To run the celery daemon, use <code>celery</code>&#x27;s command line interface to run <code>datapackage_pipelines.app</code>. Here&#x27;s one way to do it:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">$ python -m celery worker -B -A datapackage_pipelines.app</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Running this server will start by executing all &quot;dirty&quot; tasks, and continue by executing tasks based on their schedules.</p><p>As a shortcut for starting the scheduler and the dashboard (see below), you can use a prebuilt <em>Docker</em> image:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">$ docker run -v </span><span class="token variable" style="color:#36acaa">`</span><span class="token variable builtin class-name" style="color:#36acaa">pwd</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain">:/pipelines:rw -p </span><span class="token number" style="color:#36acaa">5000</span><span class="token plain">:5000 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        frictionlessdata/datapackage-pipelines server</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>And then browse to <code>http://&lt;docker machine&#x27;s IP address&gt;:5000/</code> to see the current execution status dashboard.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="pipeline-dashboard--status-badges"></a>Pipeline Dashboard &amp; Status Badges<a class="hash-link" href="#pipeline-dashboard--status-badges" title="Direct link to heading">#</a></h2><p>When installed on a server or running using the task scheduler, it&#x27;s often very hard to know exactly what&#x27;s running and what the status is of each pipeline.</p><p>To make things easier, you can spin up the web dashboard to provide an overview of each pipeline&#x27;s status, its basic info and the result of it latest execution.</p><p>To start the web server run <code>dpp serve</code> from the command line and browse to http://localhost:5000</p><p>The environment variable <code>DPP_BASE_PATH</code> will determine whether dashboard will be served from root or from another base path (example value: <code>/pipelines/</code>).</p><p>The dashboard endpoints can be made to require authentication by adding a username and password with the environment variables <code>DPP_BASIC_AUTH_USERNAME</code> and <code>DPP_BASIC_AUTH_PASSWORD</code>.</p><p>Even simpler pipeline status is available with a status badge, both for individual pipelines, and for pipeline collections. For a single pipeline, add the full pipeline id to the badge endpoint:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">http://localhost:5000/badge/path_to/pipelines/my-pipeline-id</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><img src="https://img.shields.io/badge/pipeline-succeeded%20(30756%20records)-brightgreen.svg"></p><p><img src="https://img.shields.io/badge/pipeline-invalid-lightgrey.svg"></p><p><img src="https://img.shields.io/badge/pipeline-failed-red.svg"></p><p><img src="https://img.shields.io/badge/pipeline-not%20found-lightgray.svg"></p><p>Or for a collection of pipelines:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">http://localhost:5000/badge/collection/path_to/pipelines/</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><img src="https://img.shields.io/badge/pipelines-22%20succeeded-brightgreen.svg"></p><p><img src="https://img.shields.io/badge/pipelines-4%20running%2C%20%201%20succeeded%2C%205%20queued-yellow.svg"></p><p><img src="https://img.shields.io/badge/pipelines-11%20succeeded%2C%207%20failed%2C%201%20invalid-red.svg"></p><p><img src="https://img.shields.io/badge/pipelines-not%20found-lightgray.svg"></p><p>Note that these badge endpoints will always be exposed regardless of <code>DPP_BASIC_AUTH_PASSWORD</code> and <code>DPP_BASIC_AUTH_USERNAME</code> settings.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="integrating-with-other-services"></a>Integrating with other services<a class="hash-link" href="#integrating-with-other-services" title="Direct link to heading">#</a></h2><p>Datapackage-pipelines can call a predefined webhook on any pipeline event. This might allow for potential integrations with other applications.</p><p>In order to add a webhook in a specific pipeline, add a <code>hooks</code> property in the pipeline definition, which should be a list of URLs.
Whenever that pipeline is queued, starts running or finishes running, all the urls will be POSTed with this payload:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><div tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;pipeline&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;pipeline-id&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;event&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;queue/start/progress/finish&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;success&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain">/</span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"> (when applicable)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;errors&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">list-of-errors</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> when applicable</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="known-issues"></a>Known Issues<a class="hash-link" href="#known-issues" title="Direct link to heading">#</a></h2><ul><li>loading a resource which has a lot of data in a single cell raises an exception (<a href="https://github.com/frictionlessdata/datapackage-pipelines/pull/112#issue-160766294" target="_blank" rel="noopener noreferrer">#112</a>)</li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/frictionlessdata/libraries/edit/master/docs/docs/other-libraries/data-package-pipelines.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2021-09-03T07:08:59.000Z" class="lastUpdatedDate_1WI_">9/3/2021</time> by <strong>roll</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/other-libraries/frictionless-ckan-mapper"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« frictionless-ckan-mapper</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/other-libraries/data-package-render"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">datapackage-render-js Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-basics" class="table-of-contents__link">The Basics</a><ul><li><a href="#what-is-it" class="table-of-contents__link">What is it?</a></li><li><a href="#pipelines" class="table-of-contents__link">Pipelines</a></li><li><a href="#pipeline-specyaml-file" class="table-of-contents__link"><code>pipeline-spec.yaml</code> file</a></li><li><a href="#mechanics" class="table-of-contents__link">Mechanics</a></li><li><a href="#quick-start" class="table-of-contents__link">Quick Start</a></li><li><a href="#the-command-line-interface---dpp" class="table-of-contents__link">The Command Line Interface - <code>dpp</code></a></li></ul></li><li><a href="#deeper-look-into-pipelines" class="table-of-contents__link">Deeper look into pipelines</a><ul><li><a href="#processor-resolution" class="table-of-contents__link">Processor Resolution</a></li><li><a href="#excluding-directories-form-scanning-for-pipeline-specs" class="table-of-contents__link">Excluding directories form scanning for pipeline specs</a></li><li><a href="#caching" class="table-of-contents__link">Caching</a></li><li><a href="#dirty-tasks-and-keeping-state" class="table-of-contents__link">Dirty tasks and keeping state</a></li><li><a href="#pipeline-dependencies" class="table-of-contents__link">Pipeline Dependencies</a></li><li><a href="#validating" class="table-of-contents__link">Validating</a></li><li><a href="#dataflows-integration" class="table-of-contents__link">Dataflows integration</a></li></ul></li><li><a href="#the-standard-processor-library" class="table-of-contents__link">The Standard Processor Library</a><ul><li><a href="#update_package" class="table-of-contents__link"><strong><em><code>update_package</code></em></strong></a></li><li><a href="#update_resource" class="table-of-contents__link"><strong><em><code>update_resource</code></em></strong></a></li><li><a href="#load" class="table-of-contents__link"><strong><em><code>load</code></em></strong></a></li><li><a href="#printer" class="table-of-contents__link"><strong><em><code>printer</code></em></strong></a></li><li><a href="#set_types" class="table-of-contents__link"><strong><em><code>set_types</code></em></strong></a></li><li><a href="#load_metadata" class="table-of-contents__link"><strong><em><code>load_metadata</code></em></strong></a></li><li><a href="#load_resource" class="table-of-contents__link"><strong><em><code>load_resource</code></em></strong></a></li><li><a href="#concatenate" class="table-of-contents__link"><strong><em><code>concatenate</code></em></strong></a></li><li><a href="#join" class="table-of-contents__link"><strong><em><code>join</code></em></strong></a></li><li><a href="#filter" class="table-of-contents__link"><strong><em><code>filter</code></em></strong></a></li><li><a href="#sort" class="table-of-contents__link"><strong><em><code>sort</code></em></strong></a></li><li><a href="#deduplicate" class="table-of-contents__link"><strong><em><code>deduplicate</code></em></strong></a></li><li><a href="#duplicate" class="table-of-contents__link"><strong><em><code>duplicate</code></em></strong></a></li><li><a href="#delete_fields" class="table-of-contents__link"><strong><em><code>delete_fields</code></em></strong></a></li><li><a href="#add_computed_field" class="table-of-contents__link"><strong><em><code>add_computed_field</code></em></strong></a></li><li><a href="#find_replace" class="table-of-contents__link"><strong><em><code>find_replace</code></em></strong></a></li><li><a href="#unpivot" class="table-of-contents__link"><strong><em><code>unpivot</code></em></strong></a></li><li><a href="#dump_to_sql" class="table-of-contents__link"><strong><em><code>dump_to_sql</code></em></strong></a></li><li><a href="#dump_to_path" class="table-of-contents__link"><strong><em><code>dump_to_path</code></em></strong></a></li><li><a href="#dump_to_zip" class="table-of-contents__link"><strong><em><code>dump_to_zip</code></em></strong></a></li></ul></li><li><a href="#deprecated-processors" class="table-of-contents__link">Deprecated Processors</a><ul><li><a href="#add_metadata" class="table-of-contents__link"><strong><em><code>add_metadata</code></em></strong></a></li><li><a href="#add_resource" class="table-of-contents__link"><strong><em><code>add_resource</code></em></strong></a></li><li><a href="#stream_remote_resources" class="table-of-contents__link"><strong><em><code>stream_remote_resources</code></em></strong></a></li><li><a href="#dumpto_sql" class="table-of-contents__link"><strong><em><code>dump.to_sql</code></em></strong></a></li><li><a href="#dumpto_path" class="table-of-contents__link"><strong><em><code>dump.to_path</code></em></strong></a></li><li><a href="#dumpto_zip" class="table-of-contents__link"><strong><em><code>dump.to_zip</code></em></strong></a></li></ul></li><li><a href="#custom-processors" class="table-of-contents__link">Custom Processors</a><ul><li><a href="#high-level-processor-api" class="table-of-contents__link">High Level Processor API</a></li><li><a href="#low-level-processor-api" class="table-of-contents__link">Low Level Processor API</a></li></ul></li><li><a href="#plugins-and-source-descriptors" class="table-of-contents__link">Plugins and Source Descriptors</a><ul><li><a href="#source-descriptors" class="table-of-contents__link">Source Descriptors</a></li></ul></li><li><a href="#running-on-a-schedule" class="table-of-contents__link">Running on a schedule</a></li><li><a href="#pipeline-dashboard--status-badges" class="table-of-contents__link">Pipeline Dashboard &amp; Status Badges</a></li><li><a href="#integrating-with-other-services" class="table-of-contents__link">Integrating with other services</a></li><li><a href="#known-issues" class="table-of-contents__link">Known Issues</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/table-schema/python">Table Schema</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/data-package/python">Data Package</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/other-libraries/frictionless-ckan-mapper">Other Libraries</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://frictionlessdata.io/blog/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/frictionlessdata/project/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum</a></li><li class="footer__item"><a href="https://discordapp.com/invite/Sewv6av" target="_blank" rel="noopener noreferrer" class="footer__link-item">Chat</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Social</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/frictionlessdata/frictionless-py" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://twitter.com/frictionlessd8a" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://okfn.org" target="_blank" rel="noopener noreferrer" class="footerLogoLink_MyFc"><img src="https://a.okfn.org/img/oki/landscape-white-468x122.png" alt="Open Knowledge Foundation" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="https://a.okfn.org/img/oki/landscape-white-468x122.png" alt="Open Knowledge Foundation" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">Copyright Â© 2021 Frictionless Data</div></div></div></footer></div>
<script src="/assets/js/styles.983af374.js"></script>
<script src="/assets/js/runtime~main.e908f028.js"></script>
<script src="/assets/js/main.3ba2a6ed.js"></script>
<script src="/assets/js/1.3c60d086.js"></script>
<script src="/assets/js/2.5d9923d7.js"></script>
<script src="/assets/js/36.2003ba02.js"></script>
<script src="/assets/js/935f2afb.e2d480c1.js"></script>
<script src="/assets/js/17896441.059d815c.js"></script>
<script src="/assets/js/ceb5abcf.3d03dab8.js"></script>
</body>
</html>